import unittest
from typing import List, Union
from parameterized import parameterized
from iqrfpy.utils.dpa import FrcCommands
from iqrfpy.utils.frc_parser import FrcParser


class FrcParserTestCase(unittest.TestCase):

    @parameterized.expand([
        [
            '2bit',
            [14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 0,
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            FrcCommands.FRC_2BIT_FROM,
            [0, 3, 3, 3] + [0] * 236,
        ],
        [
            '1byte',
            [0, 102, 38, 249, 52, 190, 90, 55, 245, 210, 235, 123, 156, 199, 250, 160, 221, 98, 91, 178, 153, 95, 254,
             205, 99, 46, 223, 119, 37, 171, 68, 11, 167, 106, 203, 85, 31, 77, 84, 149, 188, 218, 187, 19, 113, 140,
             79, 196, 72, 215, 49, 124, 86, 162, 108],
            [21, 127, 96, 179, 82, 104, 248, 231, 111],
            0xA0,
            [0, 102, 38, 249, 52, 190, 90, 55, 245, 210, 235, 123, 156, 199, 250, 160, 221, 98, 91, 178, 153, 95, 254,
             205, 99, 46, 223, 119, 37, 171, 68, 11, 167, 106, 203, 85, 31, 77, 84, 149, 188, 218, 187, 19, 113, 140,
             79, 196, 72, 215, 49, 124, 86, 162, 108, 21, 127, 96, 179, 82, 104, 248, 231, 111],
        ],
        [
            '2byte',
            [0, 0, 38, 249, 52, 190, 90, 55, 245, 210, 235, 123, 156, 199, 250, 160, 221, 98, 91, 178, 153, 95, 254,
             205, 99, 46, 223, 119, 37, 171, 68, 11, 167, 106, 203, 85, 31, 77, 84, 149, 188, 218, 187, 19, 113, 140,
             79, 196, 72, 215, 49, 124, 86, 162, 108],
            [21, 127, 96, 179, 82, 104, 248, 231, 111],
            233,
            [0, 63782, 48692, 14170, 54005, 31723, 51100, 41210, 25309, 45659, 24473, 52734, 11875, 30687, 43813, 2884,
             27303, 21963, 19743, 38228, 55996, 5051, 35953, 50255, 55112, 31793, 41558, 5484, 24703, 21171, 63592, 28647],
        ],
        [
            '4byte',
            [0, 0, 0, 0, 52, 190, 90, 55, 245, 210, 235, 123, 156, 199, 250, 160, 221, 98, 91, 178, 153, 95, 254,
             205, 99, 46, 223, 119, 37, 171, 68, 11, 167, 106, 203, 85, 31, 77, 84, 149, 188, 218, 187, 19, 113, 140,
             79, 196, 72, 215, 49, 124, 86, 162, 108],
            [21, 127, 96, 179, 82, 104, 248, 231, 111],
            249,
            [0, 928693812, 2079052533, 2700789660, 2992333533, 3455999897, 2011115107, 189049637, 1439394471,
             2505329951, 331078332, 3293547633, 2083641160, 359440982, 1387487359, 1877473384],
        ]
    ])
    def test_values_from_data(self, _, data: List[int], extra_data: List[int], frc_command: Union[int, FrcCommands], values: List[int]):
        self.assertEqual(
            FrcParser.values_from_data(data=data, extra_data=extra_data, frc_command=frc_command),
            values
        )

    def test_values_from_data_invalid(self):
        with self.assertRaises(ValueError):
            FrcParser.values_from_data(data=[], extra_data=[], frc_command=FrcCommands.FRC_2BYTE_TO)
