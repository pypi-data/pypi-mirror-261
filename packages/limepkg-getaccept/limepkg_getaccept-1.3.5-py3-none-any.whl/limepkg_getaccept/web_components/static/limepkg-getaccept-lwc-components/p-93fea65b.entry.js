import{r as t,c as i,h as e,g as s}from"./p-8dda2fd8.js";import{E as o}from"./p-ee719000.js";import{f as n,a as l,b as a,r as h}from"./p-6832e5af.js";import{w as r}from"./p-b4d8730e.js";const c=class{constructor(e){t(this,e),this.errorHandler=i(this,"errorHandler",7),this.isOpen=!1,this.entities=[],this.activeView=o.login,this.errorMessage="",this.documents=[],this.isSending=!1,this.openDialog=this.openDialog.bind(this),this.handleLogoClick=this.handleLogoClick.bind(this),this.renderLayout=this.renderLayout.bind(this),this.loadInitialData=this.loadInitialData.bind(this),this.loadSentDocuments=this.loadSentDocuments.bind(this),this.showWorkflow=this.showWorkflow.bind(this)}componentWillLoad(){this.externalId=`${this.context.limetype}_${this.context.id}`,this.activeView=this.checkIfSessionExists?o.home:o.login,this.session&&this.loadInitialData(),this.setDefaultDocumentData()}async loadInitialData(){this.loadSentDocuments();try{const{user:t,entities:i}=await n(this.platform,this.session);this.user=t,this.entities=i}catch(t){this.errorHandler.emit("Could not load user session. Try relogging")}this.loadEntityDetails()}async loadEntityDetails(){try{const{entity:t}=await l(this.platform,this.session);this.session.entity_id=t.id,this.documentData.email_send_message=""!==t.email_send_message?t.email_send_message:t.default_email_send_message,this.documentData.email_send_subject=""!==t.email_send_subject?t.email_send_subject:t.default_email_send_subject}catch(t){this.errorHandler.emit("Could not load user session. Try relogging")}}render(){return[e("limel-flex-container",{class:"actionpad-container"},e("button",{class:"getaccept-button",onClick:this.openDialog},e("img",{src:"https://static-vue-rc.getaccept.com/img/integrations/logo_only.png"}),e("span",{class:"button-text"},"Send document"),this.renderDocumentCount(!!this.session))),e("limel-dialog",{open:this.isOpen,closingActions:{escapeKey:!0,scrimClick:!1},onClose:()=>{this.isOpen=!1},class:{aside:this.checkIsAside()}},e("div",{class:"ga-top-bar"},this.renderLogo(this.showWorkflow()),e("limel-icon",{class:"close",name:"cancel",size:"small",onClick:()=>{this.isOpen=!1}}),(()=>{if(this.activeView!==o.login)return[e("layout-menu",{activeView:this.activeView,isSending:this.isSending}),e("workflow-progress-bar",{isVisible:this.showWorkflow(),activeView:this.activeView})]})()),e("div",{class:"ga-body"},this.renderLayout()),e("div",{class:"ga-version"},e("span",null,"Version: 1.3.5")),e("limel-button-group",{slot:"button"},e("limel-button",{label:"Cancel",onClick:()=>{this.isOpen=!1}})),e("error-message",{error:this.errorMessage}))]}checkIsAside(){var t,i,e,s,o,n,l,a,h,r,c,d;return"ASIDE"===(null===(d=null===(c=null===(r=null===(h=null===(a=null===(l=null===(n=null===(o=null===(s=null===(e=null===(i=null===(t=this.element.parentNode)||void 0===t?void 0:t.parentNode)||void 0===i?void 0:i.parentNode)||void 0===e?void 0:e.parentNode)||void 0===s?void 0:s.host)||void 0===o?void 0:o.parentNode)||void 0===n?void 0:n.parentNode)||void 0===l?void 0:l.host)||void 0===a?void 0:a.parentNode)||void 0===h?void 0:h.parentNode)||void 0===r?void 0:r.host)||void 0===c?void 0:c.parentNode)||void 0===d?void 0:d.tagName)}renderDocumentCount(t){return t?e("span",{class:"document-count"},e("limel-icon",{name:"file",size:"small"}),e("span",null,this.documents.length)):[]}renderLogo(t){return e("div",{class:"logo-container "+(t?"compact":"")},e("img",{onClick:this.handleLogoClick,src:"https://static-vue-rc.getaccept.com/img/integrations/logo-inverted.png",class:"logo"}))}showWorkflow(){return!this.isSending&&!this.isSealed&&r.some((t=>t.currentView===this.activeView))}renderLayout(){switch(this.activeView){case o.home:return e("layout-overview",{platform:this.platform,session:this.session,externalId:this.externalId,documents:this.documents,isAside:this.checkIsAside()});case o.login:return e("layout-login",{platform:this.platform});case o.selectFile:return e("layout-select-file",{platform:this.platform,session:this.session,context:this.context,selectedLimeDocument:this.limeDocument,selectedTemplate:this.template,customFields:this.templateFields,templateRoles:this.templateRoles});case o.templateRoles:return e("layout-template-roles",{platform:this.platform,session:this.session,context:this.context,document:this.documentData,limeDocument:this.limeDocument,template:this.template,templateRoles:this.templateRoles});case o.recipient:return e("layout-select-recipient",{platform:this.platform,document:this.documentData,context:this.context,isAside:this.checkIsAside()});case o.settings:return e("layout-settings",{user:this.user,entities:this.entities,session:this.session,platform:this.platform});case o.help:return e("layout-help",null);case o.sendDocument:return e("layout-send-document",{context:this.context,document:this.documentData,limeDocument:this.limeDocument,template:this.template,session:this.session,platform:this.platform});case o.videoLibrary:return e("layout-video-library",{platform:this.platform,session:this.session});case o.documentDetail:return e("layout-document-details",{platform:this.platform,session:this.session,documentId:this.documentId});case o.documentValidation:return e("layout-validate-document",{platform:this.platform,session:this.session,document:this.documentData,limeDocument:this.limeDocument,template:this.template,fields:this.templateFields,isSealed:this.isSealed,isSending:this.isSending,templateRoles:this.templateRoles});default:return e("layout-overview",null)}}logout(){localStorage.removeItem("getaccept_session"),this.documents=[],this.activeView=o.login}openDialog(){this.isOpen=!0,this.checkIsPreviewView&&this.element.shadowRoot.lastElementChild.classList.add("preview-view")}handleLogoClick(){this.activeView=this.checkIfSessionExists?o.home:o.login}async loadSentDocuments(){this.isLoadingDocuments=!0;try{this.documents=await a(this.platform,this.externalId,this.session)}catch(t){this.errorHandler.emit("Something went wrong while documents from GetAccept...")}this.isLoadingDocuments=!1}changeViewHandler(t){t.detail===o.logout?this.logout():this.isSealed?(this.activeView=o.home,this.setDefaultDocumentData()):this.activeView=t.detail}loadRealtedDocumentsHandler(){this.loadSentDocuments()}setTemplate(t){this.template=t.detail,this.documentData.name=t.detail.text,this.limeDocument=null,this.templateFields=[]}setLimeDocument(t){this.limeDocument=t.detail,this.template=null,this.templateFields=[]}setCustomFields(t){this.templateFields=t.detail}setTemplateRoles(t){this.templateRoles=t.detail,this.documentData=Object.assign(Object.assign({},this.documentData),{recipients:this.documentData.recipients.map((t=>Object.assign(Object.assign({},t),{role_id:""})))})}updateDocumentRecipientHandler(t){this.documentData.recipients=t.detail}documentTypeHandler(t){this.documentData.is_signing=t.detail}setSessionHandler(t){this.setSessionData(t.detail),this.activeView=o.home,this.loadInitialData()}setDocumentName(t){this.documentData=Object.assign(Object.assign({},this.documentData),{name:t.detail})}setDocumentValue(t){this.documentData=Object.assign(Object.assign({},this.documentData),{value:t.detail})}setDocumentSmartReminder(t){this.documentData.is_reminder_sending=t.detail}setDocumentIsSmsSending(t){this.documentData.is_sms_sending=t.detail}setDocumentEmailSubject(t){this.documentData.email_send_subject=t.detail}setDocumentEmailMessage(t){this.documentData.email_send_message=t.detail}validateDocumentHandler(){this.activeView=o.documentValidation}openDocumentDetails(t){this.activeView=o.documentDetail,this.documentId=t.detail.id}updateRecipientRole(t){const i=[...this.documentData.recipients],e=i.findIndex((i=>i.email===t.detail.recipient.email&&i.lime_id===t.detail.recipient.lime_id));i[e].role_id=t.detail.role.role_id,this.documentData=Object.assign(Object.assign({},this.documentData),{recipients:[...i]})}setDocumentVideo(t){this.documentData.video_id=t.detail,this.documentData.is_video=!0}removeDocumentVideo(){this.documentData.video_id="",this.documentData.is_video=!1}setIsSending(t){this.isSending=t.detail}documentCompleted(t){this.setDefaultDocumentData(),this.loadEntityDetails(),this.isSealed=t.detail,this.isSealed||(this.activeView=o.home),this.loadSentDocuments()}onError(t){this.errorMessage=t.detail,setTimeout((()=>this.errorMessage=""),100)}get checkIfSessionExists(){const t=window.localStorage.getItem("getaccept_session");if(t){const i=JSON.parse(t);this.validateToken(i),this.session=i}return!!t}get checkIsPreviewView(){var t;return null===(t=document.querySelector("limec-related-view").shadowRoot.firstElementChild)||void 0===t?void 0:t.classList.contains("related-view")}async validateToken(t){try{const{data:i,success:e}=await h(this.platform,t);if(e){const t=window.localStorage.getItem("getaccept_session");if(t){const e=JSON.parse(t);e.expires_in=i.expires_in,e.access_token=i.access_token,this.setSessionData(e)}}else this.errorMessage="Could not refresh token.",setTimeout((()=>this.errorMessage=""))}catch(t){this.errorMessage="Could not refresh token.",setTimeout((()=>this.errorMessage="")),this.logout()}return!0}setSessionData(t){window.localStorage.setItem("getaccept_session",JSON.stringify(t)),this.session=t}setDefaultDocumentData(){this.documentData={is_signing:!1,name:"",recipients:[],template_id:"",custom_fields:[],is_reminder_sending:!1,is_sms_sending:!1,email_send_subject:"",email_send_message:"",video_id:"",is_video:!1,external_id:this.externalId,value:0},this.templateFields=[],this.isSealed=!1,this.template=null,this.limeDocument=null}get element(){return s(this)}};c.style="limel-dialog{--dialog-heading-icon-background-color:#f49132}limel-dialog.preview-view{--dialog-width:40rem;--dialog-height:45rem}limel-dialog.aside{--dialog-width:34rem}limel-dialog .ga-version{position:absolute;top:0;right:50px}limel-dialog .ga-body{overflow:auto;min-height:100%;margin-top:1rem}limel-dialog .ga-top-bar{position:sticky;top:0;height:5rem;background-color:#fff;z-index:4;display:flex;align-items:center;z-index:9}@media (min-width: 1074px){limel-dialog{--dialog-width:65rem;--dialog-height:40rem}}@media (max-width: 1075px){limel-dialog{--dialog-width:55rem;--dialog-height:40rem}}@media (min-width: 1800px){limel-dialog{--dialog-width:70rem;--dialog-height:60rem}}limel-button{--lime-primary-color:#f49132}.logo-container{height:2.2rem;width:15rem;margin-bottom:1rem;cursor:pointer;transition:width 0.5s;overflow:hidden}.logo-container.compact{width:2.5rem}.logo-container:hover{opacity:0.8}.logo-container .logo{height:2.2rem}.close{display:block;position:absolute;right:-1rem;top:0rem;cursor:pointer}.close:hover{color:#eee}.actionpad-container{width:100%}.getaccept-button{width:100%;display:flex;justify-content:start;align-items:center;padding:0.425rem 0.875rem 0.425rem 0.875rem;border:none;border-radius:2rem;cursor:pointer;transition:background 0.8s;background-position:center;font-size:0.8rem;font-weight:bold;color:#444;background:#eee}.getaccept-button:focus{outline:0}.getaccept-button:hover{background:#f5f5f5 radial-gradient(circle, transparent 1%, #f5f5f5 1%) center/15000%}.getaccept-button:active{background-color:white;background-size:100%;transition:background 0s}.getaccept-button img{height:2rem;flex:0}.getaccept-button .button-text{margin-left:0.5rem;flex:2;text-align:left}.getaccept-button .document-count{margin-left:auto;display:flex;align-items:center}.getaccept-button .document-count limel-icon{margin-right:0.3rem}workflow-progress-bar{position:absolute;top:1.5rem;left:4rem;right:4rem}";export{c as lwc_getaccept_root}