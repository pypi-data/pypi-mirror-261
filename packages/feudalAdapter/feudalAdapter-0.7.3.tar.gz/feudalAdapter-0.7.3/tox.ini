[tox]
minversion = 3.10.0
envlist =
  clean
  pylint,
  py37,
  py38,
  py39,
  py310,
  py311,
  pyright,
  black,
  report

[base]
deps =
       -rrequirements.txt
       -rdevel-requirements.txt
module = ldf_adapter

[testenv]
deps = {[base]deps}
setenv = LDF_ADAPTER_CONFIG = {toxinidir}/tests/feudal_adapter.conf
commands =
    pytest -v --cov={[base]module} --cov-append --cov-report=term-missing
usedevelop = true

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:report]
deps =
       {[base]deps}
       coverage
skip_install = true
commands =
    pytest -v --cov={[base]module} --cov-append --cov-report=term-missing
    coverage report
    coverage html

[testenv:pylint]
deps = pylint>=2.6
commands =
    pylint -E {[base]module}

[testenv:black]
deps = black
commands = black --check --diff {[base]module}

[testenv:pyright]
deps =
        {[base]deps}
        pyright
commands = pyright {[base]module}

[testenv:docs]
deps =
	sphinx
commands =
	sphinx-build "{toxinidir}/doc/source" "{toxinidir}/doc/build"
	python -c 'import pathlib; print("Documentation available under file://\{0\}".format(pathlib.Path(r"{toxinidir}") / "doc" / "build" / "index.html"))'
