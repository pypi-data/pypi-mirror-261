{% load columns %}
{% load filer_image_tags %}
{% load filer_tags %}
{% load thumbnail %}

{% spaceless %}
  {% comment %}
        You may change the image size for special cases in your project by overriding
        this template. There are a few size manipulation filters for this in
        `filer_image_tags`:

        {% if placeholder == 'my_special_sidebar' %}
            {% thumbnail instance.image opts.size|extra_padding_y:10 crop=opts.crop upscale=opts.upscale as thumbnail %}
        {% else %}
            {% thumbnail instance.image opts.size crop=opts.crop upscale=opts.upscale as thumbnail %}
        {% endif %}
        {% if link %}<a href="{{ link }}"{% if instance.target_blank %} target="_blank"{% endif %}>{% endif %}<img{% if instance.alignment %} class="img-fluid {{ instance.alignment }}"{% else %} class="img-fluid"{% endif %} alt="{% if instance.alt %}{{ instance.alt }}{% endif %}" src="{{ thumbnail.url }}"{% if instance.caption %} title="{{ instance.caption }}"{% endif %} />{% if link %}</a>{% endif %}
    {% endcomment %}


  {% if link %}
    <a href="{{ link }}"{% if instance.target_blank %} target="_blank"{% endif %} class="img-thumbnail-wrapper {% if instance.alignment == "left" %}img-align-left{% elif instance.alignment == "right" %}img-align-right{% elif instance.alignment == "center" %}img-align-center{% endif %}">
  {% else %}
    <div class="img-thumbnail-wrapper {% if instance.alignment == "left" %}img-align-left{% elif instance.alignment == "right" %}img-align-right{% elif instance.alignment == "center" %}img-align-center{% endif %}" >
  {% endif %}

  <div class="img-thumbnail-img">
    {% if instance.image %}
      {% if instance.use_original_image %}
        <img class="img-fluid" alt="{% if instance.alt %}{{ instance.alt }}{% endif %}" src="{{ instance.image.url }}"{% if instance.width %} width="{{ instance.width }}"{% endif %}{% if instance.height %} height="{{ instance.height }}"{% endif %}{% if instance.caption %} title="{{ instance.caption }}"{% endif %} loading="lazy" />
      {% elif srcset_enabled %}
        {% if size.0 <= default_img_width.0 %}
          {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as default_thumbnail %}
        {% else %}
          {% heightratio size.1 size.0 default_img_width.0 as default_img_size %}
          {% thumbnail instance.image default_img_size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as default_thumbnail %}
        {% endif %}

        {% if size.0 <= xs_img_width.0 %}
          {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as xs_thumbnail %}
        {% else %}
          {% heightratio size.1 size.0 xs_img_width.0 as xs_img_size %}
          {% thumbnail instance.image xs_img_size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as xs_thumbnail %}
        {% endif %}

        {% if size.0 <= sm_img_width.0 %}
          {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as sm_thumbnail %}
        {% else %}
          {% heightratio size.1 size.0 sm_img_width.0 as sm_img_size %}
          {% thumbnail instance.image sm_img_size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as sm_thumbnail %}
        {% endif %}

        {% if size.0 <= md_img_width.0 %}
          {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as md_thumbnail %}
        {% else %}
          {% heightratio size.1 size.0 md_img_width.0 as md_img_size %}
          {% thumbnail instance.image md_img_size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as md_thumbnail %}
        {% endif %}

        {% if size.0 <= lg_img_width.0 %}
          {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as lg_thumbnail %}
        {% else %}
          {% heightratio size.1 size.0 lg_img_width.0 as lg_img_size %}
          {% thumbnail instance.image lg_img_size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as lg_thumbnail %}
        {% endif %}

        <img
          class="img-fluid"
          alt="{% if instance.alt %}{{ instance.alt }}{% endif %}"
          src="{{ xs_thumbnail.url }}"
          srcset="
                  {{ lg_thumbnail.url }} {{ lg_img_width.0 }}w,
                  {{ md_thumbnail.url }} {{ md_img_width.0 }}w,
                  {{ sm_thumbnail.url }} {{ sm_img_width.0 }}w,
                  {{ xs_thumbnail.url }} {{ xs_img_width.0 }}w,
                  {{ default_thumbnail.url }} {{ default_img_width.0 }}w"
          sizes="
                 (min-width: {{ screen_lg }}px) {{ lg_img_width.0 }}px,
                 (min-width: {{ screen_md }}px) {{ md_img_width.0 }}px,
                 (min-width: {{ screen_sm }}px) {{ sm_img_width.0 }}px,
                 100vw"
          {% if instance.caption %}title="{{ instance.caption }}"{% endif %} loading="lazy" />
      {% else %}
        {% thumbnail instance.image size crop=opts.crop upscale=opts.upscale subject_location=opts.subject_location as thumbnail %}
        <img class="img-fluid" alt="{% if instance.alt %}{{ instance.alt }}{% endif %}" src="{{ thumbnail.url }}"{% if thumbnail.width %} width="{{ thumbnail.width }}"{% endif %}{% if thumbnail.height %} height="{{ thumbnail.height }}"{% endif %}{% if instance.caption %} title="{{ instance.caption }}"{% endif %} loading="lazy" />
      {% endif %}
    {% else %}
      {# just a plain link to some external image #}
      <img{% if instance.alignment %} class="{% if instance.alignment == "left" %}img-align-left{% elif instance.alignment == "right" %}img-align-right{% elif instance.alignment == "center" %}img-align-center{% endif %} img-fluid"{% else %} class="img-fluid"{% endif %} alt="{% if instance.alt %}{{ instance.alt }}{% endif %}" src="{{ instance.image_url }}"{% if size.0 %} width="{{ size.0 }}"{% endif %}{% if size.1 %} height="{{ size.1 }}"{% endif %}{% if instance.caption %} title="{{ instance.caption }}"{% endif %} loading="lazy" />
    {% endif %}
    {% if instance.image.author %}
      <i class="img-author-icon" title="{{ instance.image.author }}" data-toggle="tooltip"></i>
    {% endif %}
  </div>

  {% if instance.caption or instance.description %}
    <div class="img-info" {% if thumbnail.width %}style="max-width: {{ thumbnail.width }}px;"{% endif %}>
      {% if instance.caption %}<span class="img-title">{{ instance.caption }}</span>{% endif %}
      {% if instance.description %}<p class="img-desc">{{ instance.description }}</p>{% endif %}
    </div>
  {% endif %}


  {% if link %}
    </a>
  {% else %}
    </div>
  {% endif %}
{% endspaceless %}
