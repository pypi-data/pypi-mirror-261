var It=Object.defineProperty;var Pt=(o,t,e)=>t in o?It(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var J=(o,t,e)=>(Pt(o,typeof t!="symbol"?t+"":t,e),e);import{d as R,f as U,B as w,C as pe,D as Y,E as v,G as a,c as x,H as T,a as _,w as ee,o as me,F as W,I as X,z as I,J as j,K as z,L as q,M as it,N as L,O as Tt,P as Ut,Q as ae,R as ne,S as ut,U as ct,V as _e,W as Z,X as At,Y as Q,Z as We,_ as Fe,$ as De,a0 as Ze,a1 as Bt,n as Rt,a2 as Lt,a3 as qt,a4 as et,a5 as tt,a6 as Et}from"./@vue-DPHSssWQ.js";import{d as Ee,c as Mt}from"./pinia-CbIFgsx0.js";import{u as ve,a as Ot,c as zt,b as Ft}from"./vue-router-CghHGLO4.js";import{M as Ht}from"./async-mutex-CU-bp9PP.js";import{f as dt}from"./fast-xml-parser-CsTlKMm8.js";import{P as He}from"./plotly.js-dist-C0_iSaLp.js";import{E as Nt,M as Wt}from"./md-editor-v3-BgQk5NVw.js";import{M as Zt}from"./markdown-it-CSHr2ckj.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-CupmGcto.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-BZjNfiAe.js";import"./@codemirror-DpI7LW4o.js";import"./@lezer-CFjD8eT9.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-CHfgT04g.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BxuSizwB.js";import"./markdown-it-xss-DwZvMPOe.js";import"./xss-DnjGkJ2-.js";import"./cssfilter-BjxKUPhv.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-CZJq6mYU.js";import"./entities-C20TfXL6.js";import"./linkify-it-Bd7inMSv.js";import"./punycode.js-Dj65hjkv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();const jt=R({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(o){const t=o,e=U(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),n=U(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(r,s)=>(v(),w("div",{id:"popup",style:Y({...e.value,...n.value})},[pe(r.$slots,"default",{},void 0,!0)],4))}}),E=(o,t)=>{const e=o.__vccOpts||o;for(const[n,r]of t)e[n]=r;return e},at=E(jt,[["__scopeId","data-v-e0ba6b84"]]),oe="->";class O extends Set{static removeSpaces(t){const e=t.split(oe);for(let n=0;n<e.length;n++)e[n]=e[n].trim();return t=e.join(oe),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(n=>O.removeSpaces(n)),super(e)}copy(){return new O(this)}add(t){return super.add(O.removeSpaces(t))}has(t){return super.has(O.removeSpaces(t))}union(t){const e=new O(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new O(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return ke.isSubset(this,t)}withParents(){const t=new O(this);return this.forEach(e=>t.union_(ke.allParentsOf(e))),t}withChildsFrom(t){const e=new O(this);return this.forEach(n=>e.union_(ke.allChildsOf(n,t))),e}allParents(){const t=new O;return this.forEach(e=>t.union_(ke.allParentsOf(e))),t}toArray(){return Array.from(this)}}class ke{static allParentsOf(t){const e=t.split(oe);if(e.length===1)return new O([]);const n=[],r=[];for(let s=0;s<e.length-1;s++)n.push(e[s]),r.push(n.join(oe));return new O(r)}static allChildsOf(t,e){const n=new O;for(const r of e)r.startsWith(t)&&r.length>t.length+oe.length&&r.substring(t.length,t.length+oe.length)===`${oe}`&&n.add(r);return n}static tagHierarchy(t){const e=oe;function n(l,i){const d=l.split(i);return d.length===1?[l]:[d[0],d.slice(1).join(i)]}function r(l,i=e){const d={},y=l.map(f=>n(f,i));for(const f of y)f[0]in d||(d[f[0]]=[]),f.length===2&&d[f[0]].push(f[1]);const p={};for(const f in d)p[f]=r(d[f],i);return p}function s(l,i=e){for(const d in l){const y=l[d];for(const p in y){const f=[d,p].join(e);y[f]=y[p],delete y[p]}s(y,i)}return l}return s(r(Array.from(t)))}static isSubset(t,e){let n=!0;for(const r of t)if(!e.has(r)){n=!1;break}return n}}class Ce{constructor(t,e){J(this,"summary");J(this,"supp");J(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get tags(){return new O(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(n=>{this.supp.abstract=n,t(n)}).catch(n=>{e(n)})})}uploadAbstract(t){return new Promise((e,n)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.reqDatapointAbstractUpdate(this.summary.uuid,t).then(r=>{this.supp.abstract=t,e(r)}).catch(r=>{n(r)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(n=>{this.supp.note=n,t(n)}).catch(n=>{e(n)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):(t=t.replace(new RegExp(`${this.backendUrl}/img/${this.summary.uuid}\\?fname=`,"g"),"./misc/"),new Promise((e,n)=>{this.conn.reqDatapointNoteUpdate(this.summary.uuid,t).then(r=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(s=>s.trim()==""?0:1).reduce((s,l)=>s+l,0),e(r)}).catch(r=>{n(r)})}))}uploadImages(t){return new Promise((e,n)=>{this.conn.uploadImages(this.summary.uuid,t).then(r=>{e(r.map(s=>`./misc/${s}`))},r=>{n(r)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(n=>{this.summary=n}),e}destory(){this.summary=qe}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===qe.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}`:!this.summary.has_file&&this.summary.url?this.summary.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const n=`${this.backendUrl}/pdfjs/web/viewer.html`;function r(i,d=n){const y=new URLSearchParams;d===n&&y.append("key",H().encKey),y.append("file",`${i}`);for(const p in t)y.append(p,t[p]);return`${d}?${y.toString()}`}function s(i){return e?(new URL(i).hash&&(i=i.slice(0,i.indexOf("#"))),`${i}#${e}`):i}let l="about:blank";if(this.isDummy()&&(l="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const i=this.getRawDocURL();l=r(s(i))}if(this.summary.has_file&&this.summary.file_type==".html"){const i=this.getRawDocURL();l=s(i)}return!this.summary.has_file&&this.summary.url&&(l=s(this.summary.url)),console.log("Open doc url: ",l),l}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const qe={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Vt{constructor(t){J(this,"cache");J(this,"tags");J(this,"uids");J(this,"dataInfoAcquireMutex",new Ht);J(this,"conn");J(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new O,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){await this.updateKeyCache(),await this.updateTagCache(),this._initliazed=!0,console.log("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new O(await this.conn.reqAllTags())}async update(t){return t.uuid in this.cache?this.cache[t.uuid].update(t):this.cache[t.uuid]=new Ce(this.conn,t),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new O([]),this._initliazed=!1}delete(t){delete this.cache[t],this.uids.includes(t)&&(this.uids=this.uids.filter(e=>e!==t))}hasCache(t){return t in this.cache}getDummy(){return new Ce(this.conn,qe)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new Ce(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new Ce(this.conn,qe)}return this.cache[t]}async agetMany(t,e=!0,n=!0){const r=async()=>{this.dataInfoAcquireMutex.acquire();try{const i=Object.keys(this.cache),d=t.filter(f=>!i.includes(f));if(d.length===0)return t.map(f=>this.cache[f]);const y=await this.conn.reqDatapointSummaries(d);console.log("DEBUG: get data points of size: ",y.length),y.map(f=>new Ce(this.conn,f)).forEach(f=>{this.cache[f.uid]=f})}catch(i){throw i}finally{this.dataInfoAcquireMutex.release()}return t.map(i=>this.cache[i])},s=async()=>await Promise.all(t.map(i=>this.aget(i)));if(e)try{return await r()}catch(l){if(n)return console.warn("Caught error in agetMany: ",l),await s();throw l}return await s()}async agetByAuthor(t){const e=await this.conn.filter({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new O(t);const e=[];for(const n in this.cache){const r=this.cache[n],s=new O(r.summary.tags);t.issubset(s.withParents())&&e.push(r)}return e}}class nt{constructor(t,e){J(this,"conn");J(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let n;return e===null?n="":e<0?n=`&t=${Date.now()}`:n=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${n}`}}class Kt{constructor(t){J(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new nt(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new nt(this.conn,e)}}var ce=function o(t){function e(se,ue){return se>>>ue|se<<32-ue}for(var n=Math.pow,r=n(2,32),s="length",l,i,d="",y=[],p=t[s]*8,f=o.h=o.h||[],h=o.k=o.k||[],u=h[s],m={},k=2;u<64;k++)if(!m[k]){for(l=0;l<313;l+=k)m[l]=k;f[u]=n(k,.5)*r|0,h[u++]=n(k,1/3)*r|0}for(t+="";t[s]%64-56;)t+="\0";for(l=0;l<t[s];l++){if(i=t.charCodeAt(l),i>>8)throw new Error("ASCII check failed");y[l>>2]|=i<<(3-l)%4*8}for(y[y[s]]=p/r|0,y[y[s]]=p,i=0;i<y[s];){var b=y.slice(i,i+=16),g=f;for(f=f.slice(0,8),l=0;l<64;l++){var c=b[l-15],C=b[l-2],D=f[0],S=f[4],$=f[7]+(e(S,6)^e(S,11)^e(S,25))+(S&f[5]^~S&f[6])+h[l]+(b[l]=l<16?b[l]:b[l-16]+(e(c,7)^e(c,18)^c>>>3)+b[l-7]+(e(C,17)^e(C,19)^C>>>10)|0),A=(e(D,2)^e(D,13)^e(D,22))+(D&f[1]^D&f[2]^f[1]&f[2]);f=[$+A|0].concat(f),f[4]=f[4]+$|0}for(l=0;l<8;l++)f[l]=f[l]+g[l]|0}for(l=0;l<8;l++)for(i=3;i+1;i--){var N=f[l]>>i*8&255;d+=(N<16?0:"")+N.toString(16)}return d};class Gt{constructor(){this._baseUrlGetter=()=>"",this._tokenGetter=()=>""}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}setBaseUrlGetter(t){this._baseUrlGetter=t}setCredentialGetter(t){this._tokenGetter=t}async get(t,e={}){const n=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(r=>n.searchParams.append(r,e[r])),await this._fetch(n.toString(),{method:"GET"})}async post(t,e={}){const n=new FormData;for(const r in e){let s=e[r];s instanceof Array&&(s=JSON.stringify(s)),n.append(r,s)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:n})}async put(t,e){const n=new FormData;return n.append("key",this._tokenGetter()),n.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:n})}async delete(t){const e=new FormData;return e.append("key",this._tokenGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:e})}async _fetch(t,e){if((e==null?void 0:e.method)==="GET"&&(t+=t.includes("?")?"&":"?",t+=`key=${this._tokenGetter()}`),(e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(e.body===void 0)e.body=JSON.stringify({key:this._tokenGetter()});else if(typeof e.body=="string")e.body=JSON.stringify({key:this._tokenGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("key")||e.body.append("key",this._tokenGetter());else throw new Error("Not implemented body type");const n=await fetch(t,e);if(!n.ok)throw new Error(`Request failed with status ${n.status}`);return n}}class Qt{constructor(t,e){this.fetcher=new Gt,this.fetcher.setBaseUrlGetter(t),this.fetcher.setCredentialGetter(e)}get baseURL(){return this.fetcher.baseUrl}async authUsr(t){return await this.fetcher.post("/api/auth",{key:t}).then(e=>e.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqFileListStream(t=[],e=()=>{}){const n=await this.fetcher.get("/api/filelist-stream",{tags:t.join("&&")}),r=n.headers.get("totalDataCount"),s=r?parseInt(r):-1;let l=0;const i=n.body.getReader();let d="";const y=({value:p,done:f})=>{const u=(d+new TextDecoder().decode(p)).split("\\N");for(let m=0;m<u.length-1;m++){const k=u[m];try{const b=JSON.parse(k);l+=1,e(b,l,s)}catch(b){console.error(b)}}if(u.length>0&&(d=u[u.length-1]),f){if(d)try{const m=JSON.parse(d);l+=1,e(m,l,s)}catch(m){console.error(m)}return}return i.read().then(y)};return i.read().then(y)}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,n=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:n.toString()}).then(r=>r.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async reqReloadDB(){return await this.fetcher.post("/api/reload-db").then(t=>!0)}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async reqDatapointAbstractUpdate(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(n=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async reqDatapointNoteUpdate(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(n=>!0)}async search(t,e){return await this.fetcher.post("/api/search",{method:t,kwargs:JSON.stringify(e)}).then(n=>n.json())}async filter({tags:t=[],searchBy:e="title",searchContent:n="",max_results:r=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:n,top_k:r}).then(s=>s.json())}async featurize(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(n=>n.json())}reqAISummary(t,e,n=()=>{},r=!0,s="DEFAULT"){this.fetcher.post("/api/summary",{force:r,uuid:t,model:s}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const i=l.body.getReader(),d=({value:y,done:p})=>{if(p){n();return}let f=new TextDecoder().decode(y);return e(f),i.read().then(d)};return i.read().then(d)})}async deleteData(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async editData(t,e=null,n=null,r=null){if(!t&&(e===null||n===null||r===null))throw new Error("uid is null, other fields should be complete");const s={};return t!==null&&(s.uuid=JSON.stringify(t)),e!==null&&(s.bibtex=e),n!==null&&(s.tags=JSON.stringify(n)),r!==null&&(s.url=r),await this.fetcher.post("/api/dataman/update",s).then(l=>l.json())}async uploadImages(t,e){return(await Promise.all(e.map(r=>new Promise((s,l)=>{this.fetcher.put(`/img/${t}`,r).then(i=>i.json()).then(s).catch(l)})))).map(r=>r.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(n=>n.json())}async freeDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTag(t,e){return await this.fetcher.post("/api/dataman/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTag(t){return await this.fetcher.post("/api/dataman/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:ce(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(n=>n.json())}async setUserAccess(t,e,n){const r={};return r.username=t,e!==null&&(r.is_admin=e.toString()),n!==null&&(r.mandatory_tags=JSON.stringify(n)),await this.fetcher.post("/api/userman/modify",r).then(s=>s.json())}async createUser(t,e,n,r,s){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:ce(n),is_admin:r.toString(),mandatory_tags:JSON.stringify(s)}).then(l=>l.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const Se={};window.g_eventHooks=Se;function re(o,t){if(Array.isArray(o)){for(const e of o)re(e,t);return}Se[o]===void 0&&(Se[o]=[]),Se[o].push(t)}class Jt{constructor(t,e){J(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});J(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});J(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);J(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=ce(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:n=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=s=>{},oncloseCallback:n=()=>{},onfailedToConnectCallback:r=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:r};const s=new URLSearchParams(window.location.search);s.append("key",this.__tokenGetter()),s.append("session_id",this.sessionID);const l=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+s.toString();return console.log("connecting to server websocket at: ",l),this.ws=new WebSocket(l),this.ws.onmessage=i=>{console.log(i);const d=JSON.parse(i.data);if(d.type==="event"){const y=d.content;if(console.log(y),Object.keys(Se).includes(y.type))for(const p of Se[y.type])p(y)}e(i)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),n(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(i=>setTimeout(i,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:r})})):r()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}reset(){this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}async function ht(o){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(o),!0;{const t=document.createElement("textarea");t.value=o,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(n){console.log(n),e=!0}finally{t.remove()}return!e}}function Le(o){window.open(o,"_blank")}function pt(o,t){let e=null;return function(...n){e&&window.clearTimeout(e),e=window.setTimeout(()=>{o(...n),e=null},t)}}const F=Ee("uiStatus",{state:()=>({tagStatus:{checked:new O,all:new O,unfolded:new O},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const o=K();this.tagStatus.all=o.allTags,console.log("DEBUG: updateShownData() is called."),G().conn.filter({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(o){this.recentlyReadDataUIDs.includes(o)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(o),1),this.recentlyReadDataUIDs.unshift(o),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(o,t="info",e=3e3){const n=Math.random().toString();this.popupValues[n]={content:o,styleType:t},setTimeout(()=>{delete this.popupValues[n]},e)},reloadDatabase(o=!1){K().reload(o,()=>{this.databaseLoadingStatus.nCurrent=0,K().database.clear(),this.updateShownData()},()=>{F().databaseLoadingStatus.nTotal=-1,F().tagStatus.all=K().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${G().conn.baseURL}`,"alert"),F().databaseLoadingStatus.nTotal=-1})}}}),G=Ee("connection",{state:()=>({conn:new Qt(H().backend,()=>H().encKey),wsConn:new Jt(H().backend,()=>H().encKey)})}),K=Ee("data",{state:()=>({database:new Vt(G().conn),userPool:new Kt(G().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}},reload(o=!1,t=()=>{this.database.clear()},e=()=>{},n=()=>{}){t();function r(s){s.database.init().then(l=>{e()},l=>{n(l)})}o?G().conn.reqReloadDB().then(s=>{console.log("Reload: ",s),s?r(this):n(new Error("Failed to reload database from backend"))},s=>{n(s)}):r(this)}}}),H=Ee("settings",{state:()=>({__encKey:sessionStorage.getItem("encKey")||localStorage.getItem("encKey")||"",__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||Yt(),__backendPort:sessionStorage.getItem("backendPort")||Xt(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(o,t){this.__encKey=o,t===!0?localStorage.setItem("encKey",o):(localStorage.getItem("encKey")&&localStorage.removeItem("encKey"),sessionStorage.setItem("encKey",o))},setBackendHost(o){this.__backendHost=o,sessionStorage.setItem("backendUrl",o)},setBackendPort(o){this.__backendPort=o,sessionStorage.setItem("backendPort",o)},setShowTagPanel(o){this.__showTagPanel=o,localStorage.setItem("showTagPanel",o.toString())},setShow3DScatterPlot(o){this.__show3DScatterPlot=o,localStorage.setItem("show3DScatterPlot",o.toString())},setReaderLayoutType(o){this.__readerLayoutType=o.toString(),localStorage.setItem("readerLayoutType",o.toString())},setNumItemsPerPage(o){this.__numItemsPerPage=o.toString(),localStorage.setItem("numItemsPerPage",o.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function Yt(){let o=window.location.protocol,t=window.location.hostname;return`${o}//${t}`}function Xt(){const o=window.location.port;return o==="1420"?"8080":o}function je(o,t,e){H().setEncKey(o,e),t!==null?K().user=t:K().clearUserInfo(),t?H().loggedIn=!0:H().loggedIn=!1}function ea(){je("",null,!0)}async function ta(){const o=G().conn,t=H().encKey;try{const e=await o.authUsr(t);return je(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function aa(o,t){return ce(o+ce(t))}const na={class:"loading-widget"},sa=R({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(o){const t=o,e=U(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(n,r)=>(v(),w("div",na,[a("div",{class:"loading-widget__spinner",style:Y(e.value)},null,4)]))}}),Me=E(sa,[["__scopeId","data-v-1d6933bb"]]),oa={class:"loading-popout"},ra=R({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(o){const t=o;return(e,n)=>(v(),w("div",oa,[x(Me,{size:"25px"}),a("label",null,T(t.text),1)]))}}),ft=E(ra,[["__scopeId","data-v-95a13423"]]),st=[];class V{static registerThemeChangeCallback(t){st.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?V.setDarkMode(!0):document.documentElement.classList.contains("dark")?V.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,V.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?V.setDarkMode(!0):t=="light"?V.setDarkMode(!1):V.isDefaultDarkMode()&&!V.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let n of st)n(t);if(e){const n=t?"dark":"light";localStorage.getItem("themeMode")!==n&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function ot(o,t){let e=o.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function xe(o){if(o===null||typeof o!="object")return o;let t=Array.isArray(o)?[]:{};for(let e in o)t[e]=xe(o[e]);return t}function mt(o,t,e=!1){if(o.length!==t.length)throw new Error("arr.length !== scores.length");const n=new Array;for(let i=0;i<o.length;i++)n.push([o[i],t[i]]);let r;e?r=n.sort((i,d)=>i[1]-d[1]):r=n.sort((i,d)=>d[1]-i[1]);const s=new Array,l=new Array;for(const i of r)s.push(i[0]),l.push(i[1]);return[s,l]}const la=o=>(ae("data-v-f60262df"),o=o(),ne(),o),ia={id:"popups"},ua=la(()=>a("div",null,[a("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),a("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),ca={id:"app"},da=R({__name:"App",setup(o){const t=ve(),e=F(),n=H();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&H().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&H().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&H().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const u=()=>{n.loggedIn?n.loggedIn=!1:f()};ta().then(m=>{m||u()},()=>{u()})}});const r=G().wsConn,s=_(!1),l=_(!1),i=_(window.location.hash.split("?")[0]==="#/login");t.afterEach((u,m)=>{i.value=u.path==="/login"});const d=U(()=>!s.value&&!i.value&&!l.value),y=U(()=>l.value&&!i.value);function p(){console.log("Logged in."),r.connect({onopenCallback:()=>{s.value=!0,l.value=!1},oncloseCallback:()=>s.value=!1,onfailedToConnectCallback:()=>l.value=!0}),e.reloadDatabase()}function f(){console.log("Logged out from: ",t.currentRoute.value.fullPath),r.isOpen()&&r.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}ee(()=>n.loggedIn,(u,m)=>{u?p():f()}),re("add_entry",u=>{const m=K(),k=u.datapoint_summary;m.database.update(k).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),re("update_entry",u=>{const m=K(),k=u.datapoint_summary;m.database.update(k).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),re("delete_entry",u=>{const m=K(),k=u.uuid;m.database.delete(k),console.log("DEBUG: delete entry update UI"),e.updateShownData()}),re(["delete_tag","update_tag"],u=>{const m=new O([u.src_tag]),k=K();(async function(){await k.database.updateTagCache();const g=k.database.getCacheByTags(m);await Promise.all(g.map(c=>c.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),re("update_user",u=>{if(u.username===K().user.username){if(u.user_info===null)throw new Error("assertion failed: User info is null");for(const m of Object.keys(K().user))m!=="enc_key"&&(K().user[m]=u.user_info[m])}});const h=()=>{window.location.reload()};return me(()=>{V.setDefaultDarkMode()}),(u,m)=>{const k=it("router-view");return v(),w(W,null,[a("div",ia,[(v(!0),w(W,null,X(Object.keys(I(e).popupValues),(b,g)=>(v(),j(at,{key:g,styleType:I(e).popupValues[b].styleType,style:Y({transform:`translate(-50%, ${-50+110*g}%) scale(0.9)`})},{default:q(()=>[L(T(I(e).popupValues[b].content),1)]),_:2},1032,["styleType","style"]))),128))]),d.value?(v(),j(ft,{key:0,text:"connecting..."})):z("",!0),y.value?(v(),j(at,{key:1,styleType:"info",position:"center"},{default:q(()=>[a("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[ua,a("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[L(" Please check if the server is running, make sure your network is working properly, and try to "),a("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:h},"reload the page"),L(". ")])])]),_:1})):z("",!0),a("div",ca,[x(k,null,{default:q(({Component:b})=>[(v(),j(Ut,{exclude:"Reader"},[(v(),j(Tt(b)))],1024))]),_:1})])],64)}}}),ha=E(da,[["__scopeId","data-v-f60262df"]]),pa={for:"chk"},fa={id:"checkCircle"},ma={key:0,id:"checkStatus"},va=R({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(o,{emit:t}){const e=t,n=o;function r(s){e("onCheck",n.identifier)}return(s,l)=>(v(),w("div",{class:"toggle",onClick:r},[a("label",pa,[pe(s.$slots,"default",{},void 0,!0)]),a("div",fa,[s.checked?(v(),w("div",ma)):z("",!0)])]))}}),de=E(va,[["__scopeId","data-v-582ee950"]]),ga={class:"toggleText"},ya={class:"children slideInDown"},_a=R({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.tagStatus,set:m=>n("update:tagStatus",m)}),s=U(()=>{let m="collapseButton";return Object.keys(e.children).length!==0&&(m+=" collapsible"),m}),l=_(null),i=U(()=>!e.tagStatus.unfolded.has(e.identifier)),d=U(()=>i.value?"triangle-right":"triangle-down rotate90in");function y(m){let k=r.value.unfolded;k.has(e.identifier)?k.delete(e.identifier):k.add(e.identifier)}const p=U(()=>e.tagStatus.checked.has(e.identifier));function f(m){if(m===void 0)return;let k=r.value.checked;k.has(m)?k.delete(m):k.add(m)}const h=_(null),u=m=>{m.button===2&&(y(),m.preventDefault())};return ut(()=>{var m;(m=h.value)==null||m.addEventListener("contextmenu",u)}),ct(()=>{var m;(m=h.value)==null||m.removeEventListener("contextmenu",u)}),(m,k)=>(v(),w(W,null,[a("div",{class:"row",ref_key:"rowDiv",ref:h},[a("div",{id:"button",class:_e(s.value),ref_key:"button",ref:l,onClick:y},[Object.keys(e.children).length!==0?(v(),w("div",{key:0,class:_e(d.value)},null,2)):z("",!0)],2),a("div",ga,[x(de,{checked:p.value,identifier:e.identifier,onOnCheck:f},{default:q(()=>[pe(m.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),Z(a("div",ya,[(v(!0),w(W,null,X(m.children,(b,g)=>(v(),j(vt,{identifier:String(g),children:b,"tag-status":r.value,"onUpdate:tagStatus":k[0]||(k[0]=c=>r.value=c)},{default:q(()=>[L(T(String(g).split(I(oe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[At,!i.value]])],64))}}),vt=E(_a,[["__scopeId","data-v-505f8e28"]]),wa={id:"tagSelector-main",class:"scrollable"},ba=R({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,n=t,r=U(()=>ke.tagHierarchy(e.tagStatus.all)),s=U(()=>Object.keys(r.value).sort()),l=U({get:()=>e.tagStatus,set:i=>n("update:tagStatus",i)});return(i,d)=>(v(),w("div",wa,[(v(!0),w(W,null,X(s.value,y=>(v(),j(vt,{identifier:String(y),children:r.value[y],tagStatus:l.value,"onUpdate:tagStatus":d[0]||(d[0]=p=>l.value=p)},{default:q(()=>[L(T(String(y).split(I(oe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),gt=E(ba,[["__scopeId","data-v-46f6be6a"]]),ka={key:0,class:"prefix"},Sa=R({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(o,{emit:t}){const e=o,n=t,r=U(()=>{const s=e.tag.split(oe);return s.length==1?["",s[0]]:[s.slice(0,s.length-1).join("·"),s[s.length-1]]});return(s,l)=>(v(),w("div",{class:_e(`bubble${s.tStyle?" "+s.tStyle:""}`),onClick:l[0]||(l[0]=()=>n("click"))},[r.value[0]?(v(),w("div",ka,T(r.value[0]),1)):z("",!0),L(" "+T(r.value[1]),1)],2))}}),$a=E(Sa,[["__scopeId","data-v-f454bc70"]]),Ca=R({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(o,{emit:t}){const e=o,n=t,r=U(()=>{const s={};for(const l of e.tags)e.highlightTags&&e.highlightTags.has(l)?s[l]="highlight":e.mutedTags&&e.mutedTags.has(l)?s[l]="muted":s[l]="";return s});return(s,l)=>(v(),w("div",{id:"bubbleContainer",class:"scrollable",style:Y({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(v(!0),w(W,null,X(e.tags,i=>(v(),j($a,{onClick:()=>n("clickOnBubble",i),tag:i,"t-style":r.value[i]},null,8,["onClick","tag","t-style"]))),256))],4))}}),yt=E(Ca,[["__scopeId","data-v-4c853b20"]]),Ve=o=>(ae("data-v-86105994"),o=o(),ne(),o),xa=Ve(()=>a("h3",{class:"green"},"Tags",-1)),Da=Ve(()=>a("hr",null,null,-1)),Ia=Ve(()=>a("hr",null,null,-1)),Pa=R({__name:"FileTags",emits:["onCheck"],setup(o,{emit:t}){const e=t,n=F(),r=K(),s=_(null),l=_(null);ee(()=>n.unfoldedDataUIDs,()=>{n.unfoldedDataUIDs.length==0?l.value=null:n.shownDataUIDs.includes(n.unfoldedDataUIDs[0])&&r.database.aget(n.unfoldedDataUIDs[0]).then(h=>{l.value=h})});const i=U(()=>l.value==null?null:n.tagStatus.checked.withChildsFrom(l.value.tags)),d=U(()=>{const h=n.tagStatus.checked.copy();return l.value!==null&&h.pop_ifcontains_(l.value.tags),h});function y(){n.tagStatus.checked=new O,n.updateShownData()}ee(n.tagStatus,()=>e("onCheck",n.tagStatus),{deep:!0});function p(){const h=prompt("Old tag");if(h&&r.database.allTags().has(h)){const u=prompt("New tag");u&&G().conn.renameTag(h,u).then(()=>{n.showPopup("Tag renamed","success")},()=>{n.showPopup("Failed to rename tag","error")})}else n.showPopup("Invalid tag","warning")}function f(){const h=prompt("Tag to delete");if(h&&r.database.allTags().has(h)){if(!confirm(`Are you sure to delete tag "${h}"?`))return;G().conn.deleteTag(h).then(()=>{n.showPopup("Tag deleted","success")},()=>{n.showPopup("Failed to delete tag","error")})}else n.showPopup("Invalid tag","warning")}return(h,u)=>(v(),w("div",{id:"file-tags-main",ref_key:"ftPanel",ref:s},[a("div",{class:"title"},[a("div",{id:"title-title"},[xa,a("div",{id:"title-buttons"},[a("div",{class:"button",onClick:p},"rename"),a("div",{class:"button",onClick:f},"delete")])]),Da]),x(gt,{onOnCheck:u[0]||(u[0]=m=>e("onCheck",m)),tagStatus:I(n).tagStatus,"onUpdate:tagStatus":u[1]||(u[1]=m=>I(n).tagStatus=m)},null,8,["tagStatus"]),Ia,x(yt,{onClickOnBubble:u[2]||(u[2]=m=>{I(n).tagStatus.checked.has(m)?I(n).tagStatus.checked.delete(m):I(n).tagStatus.checked.add(m),I(n).updateShownData()}),tags:l.value?l.value.tags:I(n).tagStatus.checked,"highlight-tags":i.value,"muted-tags":d.value,"max-width":s.value?s.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),a("div",{class:"buttons"},[a("button",{id:"btnClear",class:"green",onClick:y},"CLEAR SELECTION")])],512))}}),Ta=E(Pa,[["__scopeId","data-v-86105994"]]),Ua="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Ke="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",Aa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Ba="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Ra="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",La="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",qa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Ea=o=>(ae("data-v-c6dbcdc2"),o=o(),ne(),o),Ma={key:0,id:"window"},Oa={class:"header"},za=Ea(()=>a("span",{class:"close-icon"},"✕",-1)),Fa=[za],Ha=R({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.show,set:i=>{n("update:show",i)}});function s(){r.value=!1,n("onClose"),n("close")}function l(i){i.target===i.currentTarget&&s()}return window.addEventListener("keydown",i=>{i.key===e.closeKey&&(s(),i.preventDefault())}),(i,d)=>r.value?(v(),w("div",Ma,[a("div",{id:"blocker",onClick:l,style:Y({"z-index":i.zIndex-1})},[a("div",{class:"floating-window",style:Y({"z-index":i.zIndex})},[a("div",Oa,[a("label",null,T(e.title),1),a("button",{class:"close-button",onClick:s},Fa)]),a("div",{class:"window-content scrollable",style:Y({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[pe(i.$slots,"default",{},void 0,!0)],4)],4)],4)])):z("",!0)}}),$e=E(Ha,[["__scopeId","data-v-c6dbcdc2"]]),Na={id:"query-dialog-main"},Wa={class:"content"},Za={id:"buttons"},ja=R({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.show,set:s=>{n("update:show",s)}});return(s,l)=>(v(),j($e,{show:r.value,"onUpdate:show":l[2]||(l[2]=i=>r.value=i),title:s.title,compact:!0,"z-index":s.zIndex,onOnClose:l[3]||(l[3]=()=>n("onClose"))},{default:q(()=>[a("div",Na,[a("div",Wa,[pe(s.$slots,"default",{},void 0,!0)]),a("div",Za,[a("div",{class:"button ok-button",onClick:l[0]||(l[0]=()=>n("onAccept"))},"OK"),s.showCancel?(v(),w("div",{key:0,class:"button cancel-button last-button",onClick:l[1]||(l[1]=()=>n("onCancel"))},"Cancel")):z("",!0)])])]),_:3},8,["show","title","z-index"]))}}),ye=E(ja,[["__scopeId","data-v-81948a9f"]]),Va=o=>(ae("data-v-8779a0ab"),o=o(),ne(),o),Ka={id:"tag-selector-with-entry-main"},Ga={style:{textAlign:"left"}},Qa=Va(()=>a("label",{for:"tagSelector"},"Tags",-1)),Ja={id:"tagSelector",class:"scrollable"},Ya={class:"entry"},Xa=R({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.tagStatus,set:d=>n("update:tagStatus",d)}),s=_(e.tagInputValue);ee(()=>e.tagInputValue,d=>{s.value=d});const l=U({get:()=>s.value,set:d=>{n("update:tagInputValue",d),s.value=d}}),i=()=>{const d=l.value.trim();d!==""&&(r.value.all.add(d),r.value.checked.add(d),r.value.unfolded.union_(ke.allParentsOf(d)),l.value="")};return(d,y)=>(v(),w("div",Ka,[a("div",Ga,[Qa,a("div",Ja,[x(gt,{tagStatus:r.value,"onUpdate:tagStatus":y[0]||(y[0]=p=>r.value=p)},null,8,["tagStatus"])])]),a("div",Ya,[Z(a("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":y[1]||(y[1]=p=>l.value=p),onKeyup:We(i,["enter"])},null,544),[[Q,l.value]]),a("button",{class:_e(`green${l.value?" to-be-confirmed":""}`),onClick:i},"ADD",2)])]))}}),en=E(Xa,[["__scopeId","data-v-8779a0ab"]]);async function tn(o=10,t="cat:cs.AI OR cat:cs.CV",e="submittedDate",n="descending"){const s=`https://export.arxiv.org/api/query?${`search_query=${encodeURIComponent(t)}&sortBy=${e}&sortOrder=${n}&max_results=${o}`}`,i=await(await fetch(s,{method:"GET"})).text();let p=new dt.XMLParser().parse(i).feed.entry;Array.isArray(p)||(p=[p]);function f(h){return Array.isArray(h.author)?h.author.map(u=>u.name):h.author?[h.author.name]:[]}if(p&&Array.isArray(p))return p.map(u=>{const m=u.id.split("/").pop().split("v")[0],k=u.id,b=u.title,g=u.summary,c=f(u),C=u.updated,D=u.published;return{id:m,link:k,title:b,abstract:g,authors:c,updatedTime:C,publishedTime:D}});throw new Error("Invalid feed data")}async function an(o){const t=`https://export.arxiv.org/api/query?id_list=${o}`,n=await(await fetch(t,{method:"GET"})).text();let l=new dt.XMLParser().parse(n).feed.entry;function i(d){return Array.isArray(d.author)?d.author.map(y=>y.name):d.author?[d.author.name]:[]}if(l){const d=l.id.split("/").pop().split("v")[0],y=l.id,p=l.title,f=l.summary,h=i(l),u=l.updated,m=l.published;return{id:d,link:y,title:p,abstract:f,authors:h,updatedTime:u,publishedTime:m}}else throw new Error("Failed to fetch paper from arxiv")}function _t(o){return`@article{${o.id},
  author = {${o.authors.join(" and ")}},
  title = {${o.title}},
  journal = {arXiv preprint arXiv:${o.id}},
  year = {${o.publishedTime.split("-")[0]}},
  abstract = {${o.abstract}}
  }`.replace(/  /g,"")}const rt=(o,{entry:t="",title:e="",authors:n=[""],year:r=new Date().getFullYear()}={})=>(t||(t=`${r}_${Math.random().toString(36).substring(7)}`),o=="article"?`@article{${t},
        author = {${n.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${r}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):o=="inproceedings"?`@inproceedings{${t},
        author = {${n.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${r}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):o=="webpage"?`@misc{${t},
        title = "{${e}}",
        author = "{${n.join(" and ")}}",
        year = {${r}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):o=="misc"?`@misc{${t},
        author = {${n.join(" and ")}},
        title = {${e}},
        year = {${r}},
        url = {},
        }`.replace(/  /g,""):"");class Ne{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const n=await an(e);return{bibtex:_t(n),url:n.link}}static async fromWebpage(t){var d;const n=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),l=(d=new DOMParser().parseFromString(n,"text/html").querySelector("title"))==null?void 0:d.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${l}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const nn={key:0,id:"arrow"},sn=["onKeydown","onClick"],on=R({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.show,set:l=>{n("update:show",l)}});function s(){r.value=!1}return(l,i)=>(v(),w(W,null,[l.blocker?(v(),w("div",{key:0,id:"blocker",onClick:s,style:Y({zIndex:e.zIndex-1})},null,4)):z("",!0),a("div",{id:"floatingMenu",style:Y({left:e.position.x+"px",top:e.position.y+"px",visibility:r.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(v(),w("div",nn)):z("",!0),(v(!0),w(W,null,X(e.menuItems,(d,y)=>(v(),w("div",{class:_e(`non-selectable floatingMenuItem${y!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:We(p=>{d.action(),s()},["enter"]),onClick:p=>{d.action(),s()}},T(d.name),43,sn))),256))],4)],64))}}),rn=E(on,[["__scopeId","data-v-c6b659c7"]]),Te=R({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(o,t){const e=_(null),n=s=>{const l=s.target;if(l.files&&l.files.length>0){const i=l.files[0];o.action(i)}};function r(){e.value.click()}return t.expose({click:r}),()=>x(W,null,[x("input",{type:"file",id:"upload-file",onChange:n,ref:e,style:{display:"none"}},null),o.asLink?x("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:o.style},[o.text]):x("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:o.style},[o.text])])}}),Ge=R({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(o,t){const e=_(null),n=h=>{e.value.innerText=h},r=h=>{e.value.contentEditable=h.toString()},s=h=>e.value.contains(h),l=function(){return document.activeElement===e.value},i=U({get(){return e.value.innerText},set(h){e.value.innerText=h}});t.expose({setText:n,setEditable:r,contains:s,innerText:i,hasFocus:l});const d=()=>{t.emit("change",e.value.innerText)},y=()=>{t.emit("finish",e.value.innerText)},p=h=>{if(h.key==="Enter")if(h.ctrlKey||h.metaKey){h.preventDefault();const u=window.getSelection(),m=u==null?void 0:u.getRangeAt(0);if(m){const k=document.createElement("br");m.insertNode(k),m.setStartAfter(k),m.setEndAfter(k),u==null||u.removeAllRanges(),u==null||u.addRange(m)}}else e.value.blur()},f=h=>{var m;h.preventDefault();const u=(m=h.clipboardData)==null?void 0:m.getData("text/plain");document.execCommand("insertText",!1,u)};return()=>x("p",{class:"editable-paragraph",contenteditable:o.contentEditable,ref:e,onInput:d,onBlur:y,onKeydown:p,style:o.style,onPaste:f},[t.slots.default&&t.slots.default()])}}),wt=R({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(o,t){const e=_(!1),n=_(null),r=_({x:0,y:0});return ee(e,s=>{if(s){const l=n.value.getBoundingClientRect();r.value={x:l.left+l.width/2,y:l.bottom+5}}else r.value={x:0,y:0}}),()=>x("div",null,[x("div",{ref:n,onClick:()=>e.value=!e.value,onKeydown:s=>{s.key==="Enter"&&(s.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),x(rn,{show:e.value,"onUpdate:show":s=>e.value=s,menuItems:o.menuItems,position:r.value,middleTop:!0,arrow:!0},null)])}}),ln=R({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(o,t){const e={width:`${o.size}`,height:`${o.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>x("img",{src:o.href,alt:o.alt,style:e,onClick:()=>t.emit("click")},null)}});function lt(o){function t(p,f){var u;const h=(u=p.split(".").pop())==null?void 0:u.toLowerCase();for(const m of f)if(h===m)return!0;return!1}function e(p){return!!(p.type.startsWith("image/")||t(p.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function n(p){return!!(p.type==="application/pdf"||t(p.name,["pdf"]))}function r(p){return!!(p.type==="text/html"||t(p.name,["html"]))}function s(p){return!!(p.type==="text/plain"||t(p.name,["txt","bib","bibtex","nbib","enw","ris"]))}function l(p){return!!(n(p)||r(p)||e(p))}const i=[],d=[],y=[];for(let p=0;p<o.length;p++)s(o[p])?i.push(o[p]):l(o[p])?d.push(o[p]):y.push(o[p]);return{citation:i,document:d,unknown:y}}const fe=o=>(ae("data-v-7e655268"),o=o(),ne(),o),un={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},cn={style:{margin:"10px"}},dn=fe(()=>a("legend",null,"Source",-1)),hn={class:"bibsource-container"},pn=fe(()=>a("legend",{for:"bibsource-arxiv"},"arxiv",-1)),fn={class:"bibsource-container"},mn=fe(()=>a("legend",{for:"bibsource-doi"},"doi",-1)),vn={class:"bibsource-container"},gn=fe(()=>a("legend",{for:"bibsource-webpage"},"webpage",-1)),yn=["placeholder"],_n={key:0},wn={id:"inputDiv"},bn={id:"inputLeft"},kn={id:"bibtexArea"},Sn={class:"horizontal"},$n=fe(()=>a("label",{for:"bibtex"},"Bibtex",-1)),Cn={id:"bibtexSource",class:"horizontal"},xn={id:"urlArea"},Dn=fe(()=>a("label",{for:"url"},"URL: ",-1)),In={id:"inputRight"},Pn={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Tn=fe(()=>a("div",{class:"hr"},null,-1)),Un={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},An=fe(()=>a("div",{class:"hr"},null,-1)),Bn={key:1},Rn=fe(()=>a("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[a("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),a("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),Ln=[Rn],qn=R({__name:"DataEditor",setup(o,{expose:t}){const e=F(),n=G().conn,r=_(!1),s=_(null),l=_(""),i=_(""),d=_(null),y=_({all:new O,checked:new O,unfolded:new O});function p(){const M={uuid:s.value?s.value.summary.uuid:null,bibtex:l.value,tags:Array.from(y.value.checked),url:i.value,file:d.value};u(),e.showPopup("Saving entry...","info"),n.editData(M.uuid,M.bibtex,M.tags,M.url).then(P=>{M.file?(e.showPopup("Uploading document...","info"),n.uploadDocument(P.uuid,M.file).then(B=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const f=_("");function h({datapoint:M=null,bibtex:P=null,url:B=null,tags:te=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,M!==null&&(s.value=M,l.value=M.summary.bibtex,i.value=M.summary.url,te===null&&(te=new O(M.summary.tags))),P!==null&&(l.value=P),B!==null&&(i.value=B),te!==null?(Array.isArray(te)&&(te=new O(te)),y.value={all:new O(e.tagStatus.all).union(te),checked:te,unfolded:te.allParents()}):y.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},r.value=!0)}function u(){r.value=!1,s.value=null,l.value="",i.value="",y.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},d.value=null,f.value="",ue.value=!1,e.dataEditorOpened=!1}function m(){return r.value}function k(M){if(s.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!lt([M]).document)return e.showPopup("Unsupported file","error"),!1;if(d.value=M,console.log("file selected"),l.value.trim().length===0){console.log("try to extract bibtex from file");const P=M.name,B=M.lastModified,te=rt(c.value,{title:P,year:new Date(B).getFullYear()});l.value=te}return!0}function b(M){let P=!1;if(!M||M.length===0)return P;const B=lt(M);if((B.citation.length>1||B.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),B.citation.length==0&&B.document.length==0&&(console.log("[Error] Got files: ",M),e.showPopup("Unsupported file type","error")),B.citation.length>0){const te=B.citation[0];if(te.size<64*1024){const Ye=new FileReader;Ye.onload=xt=>{var Xe;const Dt=(Xe=xt.target)==null?void 0:Xe.result;l.value=Dt},Ye.readAsText(te),P=!0}else e.showPopup("Text file too large","error")}return B.document.length>0&&(P=k(B.document[0])),P}t({show:h,close:u,isShown:m,loadFiles:b});const g=_(!1),c=_("article"),C=U(()=>rt(c.value)),D=_(!1),S=_("arxiv"),$={arxiv:M=>Ne.fromArxiv(M),doi:M=>Ne.fromDoi(M),webpage:M=>Ne.fromWebpage(M)},A={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},N=_("");function se(M){e.showPopup("Fetching from BibTeX source...","info"),D.value=!1,N.value="",$[S.value](M).then(P=>{e.showPopup("Obtained bibtex from source","success"),l.value=P.bibtex,i.value=P.url},()=>{e.showPopup("Failed to fetch from source","error")})}const ue=_(!1),ze=_(null),Be=M=>{M.preventDefault(),ue.value=!0},be=M=>{M.preventDefault(),ue.value=!1},ge=M=>{var B;M.preventDefault();const P=(B=M.dataTransfer)==null?void 0:B.files;P&&b(P),ue.value=!1};return(M,P)=>(v(),w(W,null,[x(ye,{show:g.value,"onUpdate:show":P[4]||(P[4]=B=>g.value=B),onOnAccept:P[5]||(P[5]=()=>{l.value=C.value,g.value=!1}),onOnCancel:P[6]||(P[6]=B=>g.value=!1),"z-index":102,title:"Select template"},{default:q(()=>[a("div",un,[x(de,{onOnCheck:P[0]||(P[0]=B=>c.value="article"),checked:c.value=="article"},{default:q(()=>[L("Article")]),_:1},8,["checked"]),x(de,{onOnCheck:P[1]||(P[1]=B=>c.value="inproceedings"),checked:c.value=="inproceedings"},{default:q(()=>[L("Inproceedings")]),_:1},8,["checked"]),x(de,{onOnCheck:P[2]||(P[2]=B=>c.value="webpage"),checked:c.value=="webpage"},{default:q(()=>[L("Webpage")]),_:1},8,["checked"]),x(de,{onOnCheck:P[3]||(P[3]=B=>c.value="misc"),checked:c.value=="misc"},{default:q(()=>[L("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),x(ye,{show:D.value,"onUpdate:show":P[11]||(P[11]=B=>D.value=B),onOnCancel:P[12]||(P[12]=B=>D.value=!1),onOnAccept:P[13]||(P[13]=()=>{se(N.value)}),"z-index":102,title:"Source input"},{default:q(()=>[a("div",cn,[a("fieldset",{style:Y({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[dn,a("div",hn,[Z(a("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":P[7]||(P[7]=B=>S.value=B)},null,512),[[Fe,S.value]]),pn]),a("div",fn,[Z(a("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":P[8]||(P[8]=B=>S.value=B)},null,512),[[Fe,S.value]]),mn]),a("div",vn,[Z(a("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":P[9]||(P[9]=B=>S.value=B)},null,512),[[Fe,S.value]]),gn])],4),Z(a("input",{type:"text","onUpdate:modelValue":P[10]||(P[10]=B=>N.value=B),placeholder:A[S.value],style:{width:"100%",marginTop:"10px"}},null,8,yn),[[Q,N.value]])])]),_:1},8,["show"]),x(ye,{show:r.value,"onUpdate:show":P[21]||(P[21]=B=>r.value=B),title:s.value?s.value.authorAbbr():"new","show-cancel":!1,onOnAccept:p,onOnCance:u,onOnClose:u},{default:q(()=>[a("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:ze,onDragover:Be,onDrop:ge,onDragend:be},[ue.value?(v(),w("div",Bn,Ln)):(v(),w("div",_n,[a("div",wn,[a("div",bn,[a("div",kn,[a("div",Sn,[$n,a("div",Cn,[a("div",{class:"button",onClick:P[14]||(P[14]=B=>g.value=!0)},"template"),a("div",{class:"button",onClick:P[15]||(P[15]=B=>D.value=!0)},"from-source")])]),Z(a("textarea",{id:"bibtex","onUpdate:modelValue":P[16]||(P[16]=B=>l.value=B),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[Q,l.value]])]),a("div",xn,[Dn,Z(a("input",{id:"url","onUpdate:modelValue":P[17]||(P[17]=B=>i.value=B),placeholder:"url",type:"text"},null,512),[[Q,i.value]])])]),a("div",In,[x(en,{"tag-status":y.value,"onUpdate:tagStatus":P[18]||(P[18]=B=>y.value=B),"tag-input-value":f.value,"onUpdate:tagInputValue":P[19]||(P[19]=B=>f.value=B)},null,8,["tag-status","tag-input-value"])])]),s.value===null?(v(),w("div",Pn,[Tn,a("div",Un,[L(T(d.value?d.value.name:"")+" ",1),d.value?(v(),w("a",{key:1,onClick:P[20]||(P[20]=B=>d.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(v(),j(I(Te),{key:0,text:"Select document",action:k,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),An])):z("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),Qe=E(qn,[["__scopeId","data-v-7e655268"]]),we=o=>(ae("data-v-ac2fef91"),o=o(),ne(),o),En={class:"layout"},Mn={id:"info"},On=we(()=>a("td",null,[a("b",null,"Authors")],-1)),zn={id:"authorTD"},Fn=["onClick"],Hn={key:0,id:"otherPubTR"},Nn={colspan:"2"},Wn={id:"authorPapers"},Zn=we(()=>a("td",null,[a("b",null,"Publication")],-1)),jn=we(()=>a("td",null,[a("b",null,"Year")],-1)),Vn=we(()=>a("td",null,[a("b",null,"Tags")],-1)),Kn=we(()=>a("td",null,[a("b",null,"Type")],-1)),Gn={id:"shortSummary"},Qn={id:"shortSummaryTitle"},Jn=we(()=>a("b",null,"AI Summary",-1)),Yn=we(()=>a("summary",null,[a("b",null,"Related Articles")],-1)),Xn=R({__name:"DataSummary",props:{datapoint:{}},setup(o){const t=o,e=K(),n=_([]),r=_([]),s=U(()=>Object.fromEntries(n.value.map((c,C)=>[c.summary.uuid,r.value[C].toPrecision(3)]))),l=G().conn,i=_(null),d=_("");function y(c=!1){d.value="Loading...";let C="";l.reqAISummary(t.datapoint.summary.uuid,D=>{D.replace(/\\n/g,"<br>"),C+=D,d.value=C},()=>{p(),console.log("finished")},c)}async function p(){let c=null;if(t.datapoint.supp.abstract?c=t.datapoint.supp.abstract:c=await t.datapoint.fetchAbstract(),!c)if(d.value&&!d.value.startsWith("Error")&&!d.value.startsWith("Loading"))c=d.value;else throw new Error("No content to search for related articles");if(c=="")return;const C=await l.search("searchFeature",{pattern:c,n_return:9}),D=await e.database.agetMany(Object.keys(C),!1),S=new Array;for(const $ of D)if(C[$.summary.uuid]){const A=C[$.summary.uuid].score;S.push(A)}[n.value,r.value]=mt(D,S,!1),n.value&&n.value[0].summary.uuid==t.datapoint.summary.uuid&&(n.value.shift(),r.value.shift())}const f=_(""),h=_([]),u=_({});async function m(){const c=t.datapoint.authors,C=await Promise.all(c.map(D=>e.database.agetByAuthor(D)));u.value={};for(let D=0;D<c.length;D++)u.value[c[D]]=C[D]}const k=U(()=>{const c={};for(const C in u.value)u.value[C]&&u.value[C].length>1?c[C]=u.value[C].length-1:c[C]=null;return c});function b(c){h.value=u.value[c],h.value||(h.value=[]),h.value=h.value.filter(C=>C.summary.uuid!=t.datapoint.summary.uuid),f.value===c?f.value="":f.value=c}me(()=>{m(),y(!1)});const g=U(()=>{const $=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,A=(Math.sin($)+1)*.5*1200,N=Math.round(A);return`${window.innerWidth-N}px`});return(c,C)=>(v(),w("div",{id:"main",style:Y({width:g.value})},[a("h2",null,T(c.datapoint.summary.title),1),a("div",En,[a("div",Mn,[a("table",null,[a("tr",null,[On,a("td",zn,[(v(!0),w(W,null,X(c.datapoint.summary.authors,D=>(v(),w("div",null,[a("span",null,T(D),1),k.value[D]!==null?(v(),w("a",{key:0,onClick:()=>b(D)}," ("+T(k.value[D])+") ",9,Fn)):z("",!0)]))),256))])]),x(De,{name:"slideDown"},{default:q(()=>[f.value?(v(),w("tr",Hn,[a("td",Nn,[a("b",null,T(`Other publications from ${f.value.toUpperCase()}:`),1),a("div",Wn,[x(Ie,{uids:h.value.map(D=>D.summary.uuid)},null,8,["uids"])])])])):z("",!0)]),_:1}),a("tr",null,[Zn,a("td",null,T(c.datapoint.summary.publication),1)]),a("tr",null,[jn,a("td",null,T(c.datapoint.summary.year),1)]),a("tr",null,[Vn,a("td",null,T(c.datapoint.summary.tags.toString()),1)]),a("tr",null,[Kn,a("td",null,T(c.datapoint.docType()+`${c.datapoint.summary.has_file?" ("+c.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),a("div",Gn,[a("div",Qn,[Jn,a("div",{class:"button",onClick:C[0]||(C[0]=D=>y(!0))},"↻")]),a("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:i},T(d.value),513)]),a("details",null,[Yn,x(Ie,{uids:n.value.map(D=>D.summary.uuid),scores:s.value},null,8,["uids","scores"])])])],4))}}),es=E(Xn,[["__scopeId","data-v-ac2fef91"]]),ts=o=>(ae("data-v-11fed47f"),o=o(),ne(),o),as={id:"citations",style:{textAlign:"left"}},ns=["onClick"],ss={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},os={key:0},rs={key:0,id:"moreMain"},ls={class:"row",id:"buttons"},is={key:0,class:"row",id:"actions"},us={id:"abstract"},cs=ts(()=>a("summary",null,"Abstract",-1)),ds=R({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(o,{expose:t}){const e=o,n=F(),r=_(null),s=async c=>{c.target instanceof HTMLDetailsElement&&!c.target.open||(r.value.setEditable(!1),r.value.innerText="Loading...",e.datapoint.fetchAbstract().then(C=>{r.value.innerText=C,r.value.setEditable(!0)},()=>{r.value.innerText="Failed to load abstract."}))},l=async c=>{c&&(await e.datapoint.uploadAbstract(c),await e.datapoint.update())},i=_(!1);function d(c,C){return[c,`${C.length>80?C.slice(0,80)+"...":C}`,C]}function y(c){ht(c).then(C=>{C?n.showPopup("Copied to clipboard.","info"):n.showPopup("Failed to copy to clipboard.","error")})}const p=_(!1);function f(c){n.showPopup("uploading..."),e.datapoint.uploadDocument(c).then(C=>{e.datapoint.update(C),n.showPopup("Document uploaded","success")},()=>n.showPopup("Failed to upload document","error"))}function h(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(c=>{e.datapoint.update(c),n.showPopup("Document deleted","info")},()=>n.showPopup("Failed to free document","error"))}function u(){const c=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&G().conn.deleteData(c).then(C=>{n.showPopup("Deleted")})}const m=_(null);function k(){m.value.show({datapoint:e.datapoint})}const b=U(()=>r.value===null?!m.value.isShown():!m.value.isShown()&&!r.value.hasFocus());t({editThisDatapoint:k,shouldEnableEditDatapoint:b});const g=_(!1);return(c,C)=>{const D=it("router-link");return v(),w(W,null,[x($e,{show:g.value,"onUpdate:show":C[0]||(C[0]=S=>g.value=S),title:"Summary"},{default:q(()=>[x(es,{datapoint:c.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),x($e,{show:i.value,"onUpdate:show":C[1]||(C[1]=S=>i.value=S),title:"Citations"},{default:q(()=>[(v(!0),w(W,null,X([d("Title",`${c.datapoint.summary.title}`),d("Author-year",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})`),d("APA",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year}). ${c.datapoint.summary.title}. ${c.datapoint.summary.publication}.`),d("Bibtex",c.datapoint.summary.bibtex),d("DocURL",c.datapoint.getRawDocURL()),d("Markdown",`[${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})](${c.datapoint.getRawDocURL()})`),d("UUID",`${c.datapoint.summary.uuid}`)],(S,$)=>(v(),w("div",as,[a("div",{onClick:()=>{y(S[2]),i.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[a("div",{class:"citation-type",style:Y({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},T(S[0]),5),a("p",ss,T(S[1]),1)],8,ns),$!==6?(v(),w("hr",os)):z("",!0)]))),256))]),_:1},8,["show"]),x(Qe,{ref_key:"dataEditor",ref:m},null,512),x(De,{name:"expand-transition"},{default:q(()=>[c.show?(v(),w("div",rs,[a("div",ls,[x(D,{to:`/reader/${e.datapoint.summary.uuid}`},{default:q(()=>[L("Reader")]),_:1},8,["to"]),a("a",{rel:"noopener noreferrer",onClick:C[2]||(C[2]=()=>g.value=!g.value)},"Summary"),a("a",{rel:"noopener noreferrer",onClick:C[3]||(C[3]=()=>i.value=!i.value)},"Cite"),a("a",{rel:"noopener noreferrer",onClick:C[4]||(C[4]=()=>p.value=!p.value)},"Actions")]),x(De,{name:"actions"},{default:q(()=>[p.value?(v(),w("div",is,[a("a",{rel:"noopener noreferrer",class:"btn",onClick:k},"Edit"),c.datapoint.summary.has_file?(v(),w("a",{key:1,rel:"noopener noreferrer",onClick:h,class:"danger btn"},"Free document")):(v(),j(I(Te),{key:0,action:S=>f(S),text:"Upload document","as-link":!0},null,8,["action"])),a("a",{rel:"noopener noreferrer",onClick:u,class:"danger btn"},"Delete")])):z("",!0)]),_:1}),a("div",us,[a("details",{onToggle:s},[cs,x(I(Ge),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:r,style:{minHeight:"20px"},onFinish:C[5]||(C[5]=S=>l(S))},null,512)],32)])])):z("",!0)]),_:1})],64)}}}),hs=E(ds,[["__scopeId","data-v-11fed47f"]]),ps="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",fs="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",ms={class:"left row"},vs={id:"marks"},gs=["src"],ys=["src"],_s={id:"title",class:"text"},ws={class:"right row"},bs={id:"statusDiv"},ks={class:"status"},Ss={key:0,src:Ua,alt:"",class:"icon"},$s={key:1,src:Ke,alt:"",class:"icon placeholder"},Cs={class:"status"},xs={key:0,src:Aa,alt:"",class:"icon"},Ds={key:1,src:Ba,alt:"",class:"icon"},Is={key:2,src:Ra,alt:"",class:"icon"},Ps={key:3,src:Ke,alt:"",class:"icon placeholder"},Ts={class:"status"},Us={key:0,src:La,alt:"",class:"icon"},As={key:1,src:qa,alt:"",class:"icon"},Bs={key:2,src:Ke,alt:"",class:"icon placeholder"},Rs=12,Ls=1,qs=R({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0},compact:{type:Boolean,default:!1}},emits:["update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,n=t,r=U({get:()=>e.unfoldedIds,set:$=>n("update:unfoldedIds",$)}),s=U({get:()=>e.hoveredIds,set:$=>n("update:hoveredIds",$)}),l=U(()=>r.value.includes(e.datapoint.summary.uuid)),i=_(!1),d=_(null),y=_(null),p=_(null),f=_(null),h=_(null);let u=!1;function m($){if(ot($.target,d.value)){if($.target.id=="authorYear"){const A=e.datapoint.getOpenDocURL();A!==""&&Le(A),u=!0}if(!ot($.target,p.value)){if(u){u=!1;return}l.value?r.value=r.value.filter(A=>A!==e.datapoint.summary.uuid):r.value=[e.datapoint.summary.uuid]}}}function k(){i.value=!0}function b(){i.value=!1}const g=U(()=>{if(i.value){const A=e.datapoint.docType();return A===""?"_":A}else return e.datapoint.yearAuthor(" :: ")}),c=_(!1);ee(c,$=>{$?s.value.push(e.datapoint.summary.uuid):s.value=s.value.filter(A=>A!==e.datapoint.summary.uuid)});const C=U(()=>c.value?"var(--color-background-theme-highlight)":r.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":!e.compact||e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function D($){const A=e.datapoint.summary.tags.slice();$?A.push("* Bookmark"):A.splice(A.indexOf("* Bookmark"),1);const N=e.datapoint.summary.uuid;G().conn.editData(N,null,A).then(se=>{e.datapoint.update(se),F().updateShownData()},()=>F().showPopup("Failed to save","error")),u=!0}function S($){var A,N;$.code==="Space"&&r.value.includes(e.datapoint.summary.uuid)&&c.value&&document.activeElement===document.body&&(A=f.value)!=null&&A.shouldEnableEditDatapoint&&((N=f.value)==null||N.editThisDatapoint(),$.preventDefault())}return ee(()=>r.value,$=>{$.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",S):window.removeEventListener("keydown",S)}),($,A)=>(v(),w("div",{id:"fileRow",class:_e(`${e.compact&&!l.value?" compact":""}${l.value?" unfolded":""}`),onClick:m,onMouseover:A[2]||(A[2]=N=>c.value=!0),onMouseleave:A[3]||(A[3]=N=>c.value=!1),ref_key:"dataCard",ref:d,style:Y({backgroundColor:C.value})},[a("div",{id:"init",class:"row",ref_key:"initDiv",ref:y},[a("div",ms,[a("div",{id:"leadingStatus",class:"row",ref_key:"leadingStatus",ref:h},[a("div",{id:"authorYear",class:"row text",onMouseover:k,onMouseleave:b},T(g.value),33),a("div",vs,[$.datapoint.summary.tags.includes("* Bookmark")?(v(),w("img",{key:0,src:I(fs),alt:"",class:"icon redIcon",onClick:A[0]||(A[0]=()=>D(!1))},null,8,gs)):(v(),w("img",{key:1,src:I(ps),alt:"",class:"icon",onClick:A[1]||(A[1]=()=>D(!0))},null,8,ys))])],512),a("div",_s,T($.datapoint.summary.title),1),pe($.$slots,"default",{},void 0,!0)]),a("div",ws,[a("div",bs,[a("div",ks,[$.datapoint.summary.has_abstract?(v(),w("img",Ss)):(v(),w("img",$s))]),a("div",Cs,[$.datapoint.docType()=="pdf"?(v(),w("img",xs)):$.datapoint.docType()=="html"?(v(),w("img",Ds)):$.datapoint.docType()=="url"?(v(),w("img",Is)):(v(),w("img",Ps))]),a("div",Ts,[$.datapoint.summary.note_linecount>Rs?(v(),w("img",Us)):$.datapoint.summary.note_linecount>Ls?(v(),w("img",As)):(v(),w("img",Bs))])])])],512),a("div",{id:"more",ref_key:"moreDiv",ref:p},[x(hs,{datapoint:$.datapoint,show:l.value,ref_key:"moreComponent",ref:f},null,8,["datapoint","show"])],512)],38))}}),Es=E(qs,[["__scopeId","data-v-948ce801"]]),Ms={id:"datacard-container-main"},Os={key:0,class:"relatedArticleScore"},zs={key:1,id:"datacard-container-footer"},Fs=["disabled"],Hs={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},Ns=["disabled"],Ws=R({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,n=t,r=_([]),s=U({get:()=>e.unfoldedIds==null?r.value:e.unfoldedIds,set:c=>{e.unfoldedIds==null?r.value=c:n("update:unfoldedIds",c)}}),l=_([]),i=U({get:()=>e.hoveredIds==null?l.value:e.hoveredIds,set:c=>{e.hoveredIds==null?l.value=c:n("update:hoveredIds",c)}}),d=_(null),y=_(null),p=_(0),f=H(),h=_([]),u=_(!1);function m(){const c=p.value*f.numItemsPerPage,C=Math.min(c+f.numItemsPerPage,e.uids.length),D=e.uids.slice(c,C),S=K().database;let $=!0;(async()=>(await new Promise(A=>setTimeout(A,500)),$&&(u.value=!1)))(),S.agetMany(D).then(A=>{h.value=A,$=!1,u.value=!0})}ee([()=>e.uids,()=>p.value,()=>f.numItemsPerPage],()=>{e.uids.length<p.value*f.numItemsPerPage&&(p.value=0),m()}),m();const k=()=>{var c;p.value>=Math.ceil(e.uids.length/f.numItemsPerPage)-1||(p.value++,y.value.setText(""+(p.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},b=()=>{var c;p.value!=0&&(p.value--,y.value.setText(""+(p.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},g=c=>{const C=c.target;C.scrollTop==0||C.scrollTop+C.clientHeight>=C.scrollHeight};return(c,C)=>(v(),w("div",Ms,[a("div",{id:"datacard-container",style:Y({gap:c.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:d,onScroll:g,class:"scrollable"},[(v(!0),w(W,null,X(h.value,(D,S)=>(v(),j(Es,{datapoint:D,"unfolded-ids":s.value,"onUpdate:unfoldedIds":C[0]||(C[0]=$=>s.value=$),"hovered-ids":i.value,"onUpdate:hoveredIds":C[1]||(C[1]=$=>i.value=$),line_number:S,compact:c.compact},{default:q(()=>[e.scores!=null&&e.scores[D.summary.uuid]!=null?(v(),w("label",Os,T(e.scores[D.summary.uuid]),1)):z("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),u.value?z("",!0):(v(),j(De,{key:0,name:"fade"},{default:q(()=>[x(ft,{text:"Loading data..."})]),_:1})),c.uids.length>I(f).numItemsPerPage?(v(),w("div",zs,[a("button",{onClick:b,disabled:p.value==0},"Prev",8,Fs),a("span",Hs,[x(I(Ge),{ref_key:"pageIndicatorEditableParagrah",ref:y,onFinish:C[2]||(C[2]=D=>{parseInt(D)>0&&parseInt(D)<=Math.ceil(c.uids.length/I(f).numItemsPerPage)&&(p.value=parseInt(D)-1)})},{default:q(()=>[L(T(p.value+1),1)]),_:1},512),L(" / "),a("p",null,T(Math.ceil(c.uids.length/I(f).numItemsPerPage)),1)]),a("button",{onClick:k,disabled:p.value>=Math.ceil(c.uids.length/I(f).numItemsPerPage)-1},"Next",8,Ns)])):z("",!0)]))}}),Ie=E(Ws,[["__scopeId","data-v-703bfd64"]]),Zs=["title"],js=["src","alt"],Vs={for:"icon",class:"iconLabel non-selectable"},Ks=R({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(o,{expose:t,emit:e}){const n=o,r=U(()=>n.title+(n.shortcut===null?"":` (${n.shortcut})`)),s=e,l=_(null);t({getBoundingClientRect:()=>{var f;return(f=l.value)==null?void 0:f.getBoundingClientRect()}});function d(){s("onClick"),s("click")}function y(f){if(f===null)return null;const h=f.toLowerCase().split("+");return u=>{h.includes("ctrl")&&!u.ctrlKey||h.includes("alt")&&!u.altKey||h.includes("shift")&&!u.shiftKey||h.includes("meta")&&!u.metaKey||h.includes(u.key.toLowerCase())&&(console.log("shortcut triggered: "+f+" | "+n.labelText),d(),u.preventDefault())}}const p=y(n.shortcut);return ut(()=>{p!==null&&window.addEventListener("keydown",p)}),ct(()=>{p!==null&&window.removeEventListener("keydown",p)}),(f,h)=>(v(),w("span",{class:"hoverMaxout105 button non-selecable",onClick:d,onKeydown:We(d,["enter"]),tabindex:0,title:`${r.value}`,ref_key:"button",ref:l},[a("img",{id:"icon",class:"icon",src:f.iconSrc,alt:f.labelText.toUpperCase()+"_ICON"},null,8,js),a("label",Vs,T(f.labelText),1)],40,Zs))}}),he=E(Ks,[["__scopeId","data-v-a5274eaa"]]);let Gs=window.location.protocol,bt;bt=`${Gs}//${window.location.hostname}:${window.location.port}`;const Qs=`${bt}/docs/userManual_zh/index.html`;console.log("production mode");function Pe(){const o=H().backendPort;return`${H().backendHost}:${o}`}const Js={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Re=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],Ys="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",kt=o=>(ae("data-v-ac2e26f2"),o=o(),ne(),o),Xs={id:"usercard-main"},eo={id:"user-settings"},to=kt(()=>a("hr",null,null,-1)),ao=kt(()=>a("summary",null,"Change password",-1)),no={id:"password-container"},so={id:"info"},oo={id:"user-desc"},ro={id:"name-edit"},lo={id:"name"},io=["src"],uo={key:0,class:"admin_hint"},co=R({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(o,{emit:t}){const e=o,n=G().conn,r=t,s=U(()=>K().user.id===e.userInfo.id),l=_(null),i=_(d());function d(){return`${Pe()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function y(b){if(!b.type.startsWith("image/")){F().showPopup("Please select an image file","error");return}F().showPopup("Uploading avatar..."),n.uploadUserAvatar(e.userInfo.username,b).then(g=>{i.value=d(),r("update:userInfo",g)},g=>{F().showPopup(g,"error")})}const p=_(!1),f=_(""),h=_(""),u=_(""),m=_("");function k(){if(f.value===""||f.value===e.userInfo.name||f.value!==e.userInfo.name&&n.updateUserNickname(f.value).then(b=>{r("update:userInfo",b),p.value=!1},b=>{F().showPopup(b,"error")}),u.value!==""||m.value!==""){if(u.value===""){F().showPopup("Please enter the new password","error");return}if(u.value!==m.value){F().showPopup("The new passwords do not match","error");return}if(H().encKey!==ce(e.userInfo.username+ce(h.value))){F().showPopup("The old password is incorrect","error");return}n.updateUserPassword(u.value).then(b=>{const g=ce(e.userInfo.username+ce(u.value));H().setEncKey(g,!0),h.value="",u.value="",m.value="",p.value=!1},b=>{F().showPopup(b,"error")})}}return(b,g)=>(v(),w("div",Xs,[x(ye,{show:p.value,"onUpdate:show":g[4]||(g[4]=c=>p.value=c),title:"User settings",onOnCancel:g[5]||(g[5]=c=>p.value=!1),onOnAccept:k},{default:q(()=>[a("div",eo,[a("b",null,T(e.userInfo.username),1),Z(a("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=c=>f.value=c),placeholder:"Nickname",class:"input"},null,512),[[Q,f.value]]),to,a("details",null,[ao,a("div",no,[Z(a("input",{type:"password","onUpdate:modelValue":g[1]||(g[1]=c=>h.value=c),placeholder:"Old password",class:"input"},null,512),[[Q,h.value]]),Z(a("input",{type:"password","onUpdate:modelValue":g[2]||(g[2]=c=>u.value=c),placeholder:"New password",class:"input"},null,512),[[Q,u.value]]),Z(a("input",{type:"password","onUpdate:modelValue":g[3]||(g[3]=c=>m.value=c),placeholder:"Confirm new password",class:"input"},null,512),[[Q,m.value]])])])])]),_:1},8,["show"]),a("div",so,[a("div",{id:"avatar",style:Y(s.value?{cursor:"pointer",borderRadius:"50%"}:{})},[x(I(ln),{href:i.value,size:b.avatarSize,onClick:g[6]||(g[6]=c=>{var C;return s.value?(C=l.value)==null?void 0:C.click():()=>{}})},null,8,["href","size"]),x(I(Te),{text:"Change avatar",action:y,ref_key:"avatarUploadBtn",ref:l,style:{display:"none"}},null,512)],4),a("div",oo,[a("div",ro,[a("h1",lo,T(e.userInfo.name),1),s.value?(v(),w("img",{key:0,src:I(Ys),alt:"",class:"icon",id:"edit-settings-icon",onClick:g[7]||(g[7]=c=>p.value=!0)},null,8,io)):z("",!0)]),a("p",null,[L(T(e.userInfo.username)+" ",1),e.userInfo.is_admin?(v(),w("label",uo,"admin")):z("",!0)]),a("p",{id:"credential",onClick:g[8]||(g[8]=()=>{I(ht)(I(H)().encKey).then(()=>{I(F)().showPopup("Secret copied to clipboard","info")})})},"Credential:"+T(I(H)().encKey.substring(0,8)),1)])])]))}}),ho=E(co,[["__scopeId","data-v-ac2e26f2"]]),po={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},fo={class:"settings-container"},mo={class:"settings-header"},vo={class:"widget"};function go(o,t,e,n,r,s){return v(),w("div",fo,[a("div",mo,[a("label",null,T(e.title),1),a("p",null,T(e.description),1)]),a("div",vo,[pe(o.$slots,"default",{},void 0,!0)])])}const Oe=E(po,[["render",go],["__scopeId","data-v-f00f1fc8"]]),yo=a("option",{value:"auto"},"Auto",-1),_o=a("option",{value:"light"},"Light",-1),wo=a("option",{value:"dark"},"Dark",-1),bo=[yo,_o,wo],ko=R({__name:"ConfigTheme",setup(o){const t=_("auto");function e(){t.value=V.getThemeMode()}function n(r){r==="auto"?(V.clear(),V.setDefaultDarkMode()):r==="light"?V.setDarkMode(!1):r==="dark"&&V.setDarkMode(!0),e()}return e(),(r,s)=>(v(),j(Oe,{title:"Theme",description:"Change the theme of the app"},{default:q(()=>[Z(a("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.value=l),onChange:s[1]||(s[1]=l=>n(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},bo,544),[[Ze,t.value]])]),_:1}))}}),So={class:"switch-toggle"},$o=R({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(o,{emit:t}){const n=_(o.checked),r=t,s=_(null);return(l,i)=>(v(),w("div",So,[Z(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":i[0]||(i[0]=d=>n.value=d),onChange:i[1]||(i[1]=()=>{r("update:checked",n.value)}),ref_key:"checkerRef",ref:s},null,544),[[Bt,n.value]]),a("label",{class:"switch",onClick:i[2]||(i[2]=d=>{var y;return(y=s.value)==null?void 0:y.click()})})]))}}),Je=E($o,[["__scopeId","data-v-58ea3d44"]]),Co=R({__name:"ConfigShowTags",setup(o){const t=H(),e=U({get:()=>t.showTagPanel,set:n=>t.setShowTagPanel(n)});return(n,r)=>(v(),j(Oe,{title:"Tag Display",description:"Show tag panel on the home page"},{default:q(()=>[x(Je,{checked:e.value,"onUpdate:checked":r[0]||(r[0]=s=>e.value=s)},null,8,["checked"])]),_:1}))}}),xo=R({__name:"ConfigShowScatterPlot",setup(o){const t=H(),e=U({get:()=>t.show3DScatterPlot,set:n=>t.setShow3DScatterPlot(n)});return(n,r)=>(v(),j(Oe,{title:"Scatter Plot",description:"Show scatter plot on the home page"},{default:q(()=>[x(Je,{checked:e.value,"onUpdate:checked":r[0]||(r[0]=s=>e.value=s)},null,8,["checked"])]),_:1}))}}),Do=["value"],Io=R({__name:"ConfigPageCapacity",setup(o){const t=U({get:()=>H().numItemsPerPage,set:n=>H().setNumItemsPerPage(n)}),e=[10,20,50,100,200,500];return(n,r)=>(v(),j(Oe,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:q(()=>[Z(a("select",{"onUpdate:modelValue":r[0]||(r[0]=s=>t.value=s),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(v(),w(W,null,X(e,s=>a("option",{value:s,key:s},T(s),9,Do)),64))],512),[[Ze,t.value]])]),_:1}))}}),Po={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},To={style:{display:"flex",justifyContent:"center",alignItems:"center"}},Uo=R({__name:"SettingsWindow",setup(o){const t=K().user;return(e,n)=>(v(),w("div",Po,[a("div",To,[x(ho,{"user-info":I(t),"avatar-size":"120px"},null,8,["user-info"])]),x(ko),x(Io),x(Co),x(xo)]))}}),Ao="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Bo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Ro="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Lo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",qo={class:"button"},Eo=R({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0}},setup(o){const t=o,e=ve();function n(){ea()}const r=_(null);let s=0;window.addEventListener("scroll",function(){const i=window.scrollY||document.documentElement.scrollTop;i<=s||s<10?r.value&&r.value.classList.contains("hidden")&&r.value.classList.remove("hidden"):r.value&&!r.value.classList.contains("hidden")&&r.value.classList.add("hidden"),s=i});const l=_(!1);return(i,d)=>(v(),w(W,null,[x($e,{show:l.value,"onUpdate:show":d[0]||(d[0]=y=>l.value=y),title:"Settings"},{default:q(()=>[x(Uo)]),_:1},8,["show"]),a("div",{class:"main-toolbar shadow",ref_key:"mainDiv",ref:r},[a("div",qo,[t.returnHome?(v(),j(he,{key:0,iconSrc:I(Ro),labelText:"Home",shortcut:"ctrl+h",onOnClick:d[1]||(d[1]=()=>{I(e).push("/")}),title:"home"},null,8,["iconSrc"])):(v(),j(he,{key:1,iconSrc:I(Ao),labelText:"Logout",shortcut:"ctrl+q",onOnClick:n,title:"logout"},null,8,["iconSrc"])),x(he,{iconSrc:I(Lo),labelText:"Settings",shortcut:"ctrl+c",onOnClick:d[2]||(d[2]=()=>{l.value=!0}),title:"Open settings"},null,8,["iconSrc"]),x(I(wt),{menuItems:[{name:"Home",action:()=>{I(e).push("/")}},{name:"Dashboard",action:()=>{I(e).push(`/dashboard/${I(K)().user.username}`)}},{name:"Arxiv daily",action:()=>{I(e).push("/feed")}},{name:"About",action:()=>{I(e).push("/about")}}]},{default:q(()=>[x(he,{iconSrc:I(Bo),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"])]),pe(i.$slots,"default",{},void 0,!0)],512)],64))}}),Ue=E(Eo,[["__scopeId","data-v-7de4c0f5"]]),Mo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",St="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",Oo=R({__name:"Plot3d",props:{data:{}},setup(o,{expose:t}){const e=_(null),n=o,r=U(()=>n.data.map(m=>({x:m.x,y:m.y,z:m.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:m.text,marker:{size:3.5,opacity:m.opacity,color:m.color}}))),s={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},l={...s,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},i=_(V.isDarkMode()?"dark":"light");V.registerThemeChangeCallback(()=>{i.value=V.isDarkMode()?"dark":"light",f()});const d=U(()=>i.value==="dark"?l:s),y={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let p=null;function f(){if(!e.value)return;He.react(e.value,r.value,d.value,y),e.value.layout.scene&&p&&He.relayout(e.value,"scene.camera",p)}return t({update:f}),me(()=>{He.newPlot(e.value,r.value,d.value,y).then(()=>{e.value.on("plotly_relayout",h=>{if(console.log("plotly_relayout",h),!h["scene.camera"])return;const u=h["scene.camera"];p=xe(u)})}),e.value.on("plotly_click",function(h){h.points||console.log("Not clicking on any data.");const u=h.points[0].x,m=h.points[0].y,k=h.points[0].z,b=h.points[0].pointNumber;console.log(`You clicked on ${u}, ${m}, ${k} (point ${b})}`)}),ee(r,()=>{f()})}),(h,u)=>(v(),w("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),zo=E(Oo,[["__scopeId","data-v-e21cc654"]]),Fo={id:"main-filtervis"},Ho={key:0,id:"plot3dDiv"},No={key:0,id:"loadingDiv",class:"full"},Wo={key:1,class:"status"},Zo=R({__name:"FilterVis",setup(o){const t=K(),e=_(null),n=F(),r=H(),s=_(null),l=U(()=>{if(s.value===null)return{};const h=t.database.allKeys(),u={};for(const m of h)s.value[m]&&(u[m]=s.value[m]);return u});async function i(h,u="rgb(100, 100, 200)"){const m=l.value;if(!m)h=[];else for(let $=h.length-1;$>=0;$--)m[h[$]]===void 0&&h.splice($,1);const k=h.length,b=await t.database.agetMany(h),g=new Float32Array(k),c=new Float32Array(k),C=new Float32Array(k),D=new Array(k);for(const[$,A]of h.entries()){let N=m[A];if(N==null)throw new Error("uid not found in feats: "+A);g[$]=N[0],c[$]=N[1],C[$]=N[2];const se=b[$];D[$]=`${se.authorYear()}<br>${se.summary.title}`}let S;if(typeof u=="string")S=u;else if(u instanceof Array)if(typeof u[0]=="string")S=u;else{const $=u,A=Math.max(...$),N=Math.min(...$),se={0:V.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};S=$.map(ze=>{const Be=(ze-N)/(A-N),be=Array(3);for(let ge=0;ge<3;ge++)be[ge]=Math.round(se[0][ge]*(1-Be)+se[1][ge]*Be);return`rgb(${be[0]}, ${be[1]}, ${be[2]})`})}else throw new Error("Invalid color type");return{x:g,y:c,z:C,opacity:.75,color:S,text:D}}const d=_(null);async function y(){const h=n.shownDataScores;let u;h?u=await i(xe(n.shownDataUIDs),h):u=await i(xe(n.shownDataUIDs));const k=t.database.allKeys().filter(c=>n.shownDataUIDs.indexOf(c)==-1),b=await i(k,V.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),g=await i(xe(n.unfoldedDataUIDs),"rgb(255, 0, 0)");d.value=[u,b,g]}const p=U(()=>Object.keys(l.value).length>0);async function f(){s.value=null;const h=G().conn,u=(await h.status()).n_data;let m;u<50?m=-1:u<100?m=5:u<300?m=8:u<500?m=12:m=15,console.log("dataset size: ",u,"perp: ",m),s.value=await h.reqDatabaseFeatureTSNE("doc_feature",3,m)}return ee(()=>[n.shownDataUIDs,n.unfoldedDataUIDs],()=>{y()}),ee(()=>r.show3DScatterPlot,h=>{h&&f().then(()=>{y()})}),me(()=>{r.show3DScatterPlot&&f().then(()=>{y()})}),(h,u)=>(v(),w("div",Fo,[I(r).show3DScatterPlot?(v(),w("div",Ho,[x(zo,{data:d.value?d.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!p.value||!l.value?(v(),w("div",No,[s.value===null?(v(),j(Me,{key:0})):(v(),w("p",Wo,"Data not ready"))])):z("",!0)])):z("",!0)]))}}),jo=E(Zo,[["__scopeId","data-v-c39fb024"]]),Vo=o=>(ae("data-v-b1985dcb"),o=o(),ne(),o),Ko={id:"toolbarAddons"},Go={class:"searchbar"},Qo=["value"],Jo={id:"main-home",class:"gradIn"},Yo={class:"horizontal fullHeight"},Xo={key:0,id:"left-panel"},er={id:"right-panel",class:"panel1"},tr={class:"fullWidth"},ar={key:1,id:"blankPlaceholder"},nr={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},sr=Vo(()=>a("br",null,null,-1)),or={name:"Home",inheritAttrs:!1,customOptions:{}},rr=R({...or,setup(o){const t=F(),e=K(),n=H();window.innerWidth<768&&n.setShowTagPanel(!1);const s=ve().currentRoute.value.query.tags;s!=null&&(t.tagStatus.checked=new O(s.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const l=["title","author","note","publication","feature","uuid"],i=_(""),d=_(null);function y(){const k={searchBy:d.value.value,content:i.value};t.searchState=k,console.log(k),t.updateShownData()}const p=pt(y,300),f=_(null);function h(){f.value.show({datapoint:null})}function u(k){var g;k.preventDefault();const b=(g=k.dataTransfer)==null?void 0:g.files;b&&(h(),f.value.loadFiles(b)||f.value.close())}function m(){t.reloadDatabase(),G().wsConn.reset()}return(k,b)=>(v(),w(W,null,[x(Qe,{ref_key:"dataEditor",ref:f},null,512),x(Ue,{"return-home":!1},{default:q(()=>[a("div",Ko,[x(he,{iconSrc:I(Mo),labelText:"New",title:"Add new data to database",onClick:h,shortcut:"ctrl+n"},null,8,["iconSrc"]),x(he,{iconSrc:I(St),labelText:"Reload",title:"Reload database",onClick:m},null,8,["iconSrc"]),L(" | "),a("div",Go,[a("select",{ref_key:"searchSelector",ref:d,name:"search_type",id:"searchType",onChange:y},[(v(),w(W,null,X(l,g=>a("option",{value:g},T(g),9,Qo)),64))],544),Z(a("input",{id:"searchbar",type:"text","onUpdate:modelValue":b[0]||(b[0]=g=>i.value=g),onInput:b[1]||(b[1]=(...g)=>I(p)&&I(p)(...g)),placeholder:"search"},null,544),[[Q,i.value]])])])]),_:1}),a("div",Jo,[a("div",Yo,[x(De,{name:"left-in"},{default:q(()=>[I(n).showTagPanel?(v(),w("div",Xo,[x(Ta,{onOnCheck:b[2]||(b[2]=()=>I(t).updateShownData())})])):z("",!0)]),_:1}),a("div",er,[a("div",tr,[x(jo)]),a("div",{class:"scrollable",id:"fileSelector",onDragover:b[4]||(b[4]=g=>g.preventDefault()),onDrop:u},[I(t).shownDataUIDs.length>0?(v(),j(Ie,{key:0,uids:I(t).shownDataUIDs,unfoldedIds:I(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":b[3]||(b[3]=g=>I(t).unfoldedDataUIDs=g)},null,8,["uids","unfoldedIds"])):(v(),w("div",ar,[I(e).database.initialized?(v(),w("p",nr,[L(" Nothing to show "),a("p",{style:{"font-size":"medium"}},[L(" Add your first enty by clicking the "),a("b",null,[a("a",{onClick:h,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),L(" button above."),sr])])):(v(),j(Me,{key:1}))]))],32)])])])],64))}}),lr=E(rr,[["__scopeId","data-v-b1985dcb"]]),$t=o=>(ae("data-v-c2e08ffb"),o=o(),ne(),o),ir={id:"authorPapers"},ur={id:"feed-main",class:"slideInFast"},cr={class:"articleBlock"},dr={class:"titleBlock"},hr={class:"titleId"},pr={class:"authors"},fr=$t(()=>a("label",null,"[Authors] ",-1)),mr={class:"authorSpan"},vr=["onClick"],gr=["onClick"],yr={key:1},_r={class:"actions"},wr=$t(()=>a("summary",null,"Abstract",-1)),br={id:"relatedArticles"},kr=R({__name:"ArticleBlock",props:{article:{}},setup(o){const t=o,e=K(),n=G().conn,r=_(null);async function s(){var b;(b=r.value)==null||b.show({datapoint:null,bibtex:_t(t.article),tags:[],url:t.article.link})}const l=_({});async function i(){const b=t.article.authors,g=await Promise.all(b.map(c=>e.database.agetByAuthor(c)));l.value={};for(let c=0;c<b.length;c++)l.value[b[c]]=g[c]}i();const d=U(()=>{const b={};for(const g in l.value)l.value[g]?b[g]=l.value[g].length:b[g]=null;return b}),y=_(!1),p=_([]);function f(b){p.value=l.value[b],p.value||(p.value=[]),y.value=!0}const h=_([]),u=_([]),m=U(()=>{const b={};for(let g=0;g<h.value.length;g++)b[h.value[g].summary.uuid]=u.value[g].toPrecision(4);return b});function k(){h.value.length>0||n.search("searchFeature",{pattern:t.article.abstract,n_return:8}).then(b=>{var D;const g=new Array,c=new Array;for(const S of Object.keys(b))g.push((D=b[S])==null?void 0:D.score),c.push(S);const C=mt(c,g);e.database.agetMany(C[0],!1).then(S=>{var A;h.value=S;const $=[];for(const N of S)$.push((A=b[N.summary.uuid])==null?void 0:A.score);u.value=$})})}return(b,g)=>(v(),w(W,null,[x(Qe,{ref_key:"dataEditor",ref:r},null,512),x($e,{show:y.value,"onUpdate:show":g[0]||(g[0]=c=>y.value=c),title:"Publications in the database",onOnClose:g[1]||(g[1]=c=>p.value=[])},{default:q(()=>[a("div",ir,[x(Ie,{uids:p.value.map(c=>c.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),a("div",ur,[a("div",cr,[a("div",dr,[a("h2",null,T(t.article.title),1),a("label",hr,T(t.article.id),1)]),a("div",pr,[fr,(v(!0),w(W,null,X(t.article.authors,(c,C)=>(v(),w("span",mr,[a("a",{onClick:()=>I(Le)(`https://arxiv.org/search/?query=${c}&searchtype=author`)},T(c),9,vr),d.value[c]?(v(),w("a",{key:0,class:"pubCount",onClick:()=>f(c)},T(` (${d.value[c]})`),9,gr)):z("",!0),C<t.article.authors.length-1?(v(),w("span",yr,", ")):z("",!0)]))),256))]),a("div",_r,[a("a",{onClick:g[2]||(g[2]=()=>I(Le)(`https://arxiv.org/abs/${b.article.id}`))},"Arxiv"),L(" | "),a("a",{onClick:g[3]||(g[3]=()=>I(Le)(`https://arxiv.org/pdf/${b.article.id}.pdf`))},"PDF"),L(" | "),a("a",{onClick:s},"Collect")]),a("p",null,"Published: "+T(t.article.publishedTime),1),a("details",null,[wr,a("p",null,T(t.article.abstract),1)]),a("details",null,[a("summary",{onClick:k},"Related articles"),a("div",br,[x(Ie,{uids:h.value.map(c=>c.summary.uuid),scores:m.value},null,8,["uids","scores"])])])])])],64))}}),Sr=E(kr,[["__scopeId","data-v-c2e08ffb"]]),Ae=o=>(ae("data-v-c3be9b41"),o=o(),ne(),o),$r={id:"toolbar"},Cr={id:"main"},xr=["src"],Dr={id:"settings"},Ir=Ae(()=>a("option",{value:"cat:cs.CV OR cat:cs.AI OR stat.ML"},"ALL",-1)),Pr=Ae(()=>a("option",{value:"cat:cs.CV"},"cs.CV",-1)),Tr=Ae(()=>a("option",{value:"cat:cs.AI"},"cs.AI",-1)),Ur=Ae(()=>a("option",{value:"cat:stat.ML"},"stat.ML",-1)),Ar=[Ir,Pr,Tr,Ur],Br={key:0,id:"loadingPlaceholder"},Rr=Ae(()=>a("b",null,"Fetching...",-1)),Lr=R({__name:"Feed",setup(o){const t=G().conn,e=_("cat:cs.CV OR cat:cs.AI OR stat.ML"),n=_(""),r=_(null),s=_([]),l=U(function(){return[...s.value].sort((k,b)=>{if(r.value===null||!k.features||!b.features)return 0;{const g=k.features,c=b.features,C=r.value,D=g.reduce(($,A,N)=>$+(A-C[N])**2,0),S=c.reduce(($,A,N)=>$+(A-C[N])**2,0);return D-S}})});function i(){if(n.value.trim()===""){r.value=null;return}t.featurize(n.value).then(m=>{r.value=new Float32Array(m)},()=>{console.log("failed to featurize")})}const d=pt(i,100),y=ve();let p=parseInt(y.currentRoute.value.query.maxResults)||100;p>200&&(window.alert("maxResults cannot be larger than 200"),p=200);let f=y.currentRoute.value.query.search||"";f!==""&&(n.value=f);const h=_(null);async function u(){s.value=[];const m=await tn(p,e.value);console.log(`Got ${m.length} entries.`);for(const k of m){const b=k;b.features=_(null),s.value.push(b),t.featurize(k.abstract,!0).then(g=>{b.features.value=new Float32Array(g)},()=>{console.log("failed to featurize: ",k.id)})}i()}return me(()=>{u().then(()=>h.value.classList.remove("spin"),()=>{h.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(m,k)=>(v(),w(W,null,[a("div",$r,[x(Ue,{ref:"toolbar"},null,512)]),a("div",Cr,[a("h1",null,[L(" Arxiv daily "),a("img",{ref_key:"refreshButton",ref:h,src:I(St),alt:"",class:"icon spin",title:"refresh the page",onClick:k[0]||(k[0]=b=>{const g=b.target;g.classList.contains("spin")||(g.classList.add("spin"),u().then(()=>g.classList.remove("spin")))})},null,8,xr)]),a("div",Dr,[Z(a("select",{name:"category",id:"category-select","onUpdate:modelValue":k[1]||(k[1]=b=>e.value=b),onChange:u},Ar,544),[[Ze,e.value]]),Z(a("input",{type:"text",placeholder:"Search",onInput:k[2]||(k[2]=(...b)=>I(d)&&I(d)(...b)),"onUpdate:modelValue":k[3]||(k[3]=b=>n.value=b),autocomplete:"off"},null,544),[[Q,n.value]])]),l.value.length===0?(v(),w("div",Br,[Rr,x(Me)])):z("",!0),(v(!0),w(W,null,X(l.value,b=>(v(),j(Sr,{article:b},null,8,["article"]))),256))])],64))}}),qr=E(Lr,[["__scopeId","data-v-c3be9b41"]]),Ct=o=>(ae("data-v-dbb25d40"),o=o(),ne(),o),Er={class:"main"},Mr={id:"login",class:"slideIn"},Or={class:"loginLine"},zr={class:"loginLine"},Fr=["type"],Hr=Ct(()=>a("summary",null,"Settings",-1)),Nr={id:"settings"},Wr=Ct(()=>a("label",{for:"backendHostInput"},"Backend: ",-1)),Zr={class:"options"},jr={key:0,class:"error"},Vr=R({__name:"LoginInput",setup(o){const t=_(""),e=_(""),n=_(""),r=_(!0),s=_(!1),l=U(()=>s.value?"text":"password"),i=_("Login"),d=ve(),y=_(""),p=_("");d.isReady().then(()=>{Rt(()=>{y.value=H().backendHost,p.value=H().backendPort})});function f(){H().setBackendHost(y.value),H().setBackendPort(p.value),i.value="Connecting...";const h=aa(t.value,e.value);G().conn.authUsr(h).then(m=>{je(h,m,r.value),n.value="";const k=d.currentRoute.value.query.from;k?(console.log("Redirecting to",k),d.push(k)):d.push("/"),i.value="Login"},m=>{n.value=m,i.value="Login"})}return(h,u)=>(v(),w("div",Er,[a("div",Mr,[a("form",null,[a("div",Or,[Z(a("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m),placeholder:"Username",autocomplete:"off"},null,512),[[Q,t.value]])]),a("div",zr,[Z(a("input",{class:"key-input",type:l.value,id:"password-input","onUpdate:modelValue":u[1]||(u[1]=m=>e.value=m),placeholder:"Password"},null,8,Fr),[[Lt,e.value]])]),a("details",null,[Hr,a("div",Nr,[Wr,Z(a("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":u[2]||(u[2]=m=>y.value=m)},null,512),[[Q,y.value]]),L(" : "),Z(a("input",{type:"text",id:"port","onUpdate:modelValue":u[3]||(u[3]=m=>p.value=m)},null,512),[[Q,p.value]]),a("div",Zr,[x(de,{checked:r.value,onOnCheck:u[4]||(u[4]=()=>{r.value=!r.value})},{default:q(()=>[L("Stay login")]),_:1},8,["checked"]),x(de,{checked:s.value,onOnCheck:u[5]||(u[5]=()=>{s.value=!s.value})},{default:q(()=>[L("Show key")]),_:1},8,["checked"])])])]),a("button",{type:"submit",onClick:qt(f,["prevent"])},T(i.value),1)]),n.value?(v(),w("p",jr,T(n.value),1)):z("",!0)])]))}}),Kr=E(Vr,[["__scopeId","data-v-dbb25d40"]]),Gr={id:"main"},Qr={id:"container"},Jr={for:"login",id:"info"},Yr=["href"],Xr=R({__name:"Login",setup(o){V.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,n)=>(v(),w("div",Gr,[a("div",Qr,[x(Kr),a("label",Jr,[L(" Need assistant? - "),a("a",{onClick:t},"Register"),L(" | "),a("a",{href:`mailto:${I(Js).email}`},"Contact me",8,Yr)])])]))}}),el=E(Xr,[["__scopeId","data-v-a2e2514f"]]);class tl{constructor(t){J(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const n in e)t[n]=e[n];return t}setURLParam(t,e){const n=this.getURLParams();n[t]=e,this.router.push({query:n})}updateURLWithParam(t,e){const n=this.getURLParams();return n[t]=e,this.router.resolve({query:n}).href}}function al(o,{router:t=null,datapoint:e=null}){const n=t?new tl(t):null;return e&&(o=o.replace(new RegExp("./misc/","g"),`${Pe()}/img/${e.summary.uuid}\\?fname=`),n&&(window.location.href.includes("/reader/")?o=o.replace(new RegExp("\\$\\{doc\\}#","g"),n.updateURLWithParam("docHashMark","")):o=o.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))),o}const nl={id:"noteEditor"},sl=R({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(o,{expose:t}){const e=o,n=ve(),r=_(""),s=U(()=>al(r.value,{router:n,datapoint:e.datapoint})),l=_(null);function i(){e.datapoint.isDummy()||e.datapoint.fetchNote().then(f=>{console.log("Note fetched"),r.value=f,f.trim().length>0&&(p.value=!0)},f=>{console.error(f)})}i(),ee(()=>e.datapoint,()=>{i(),console.log("datapoint changed, fetching note")});function d(){e.datapoint.uploadNote(r.value).then(()=>{console.log("Note saved"),F().showPopup("Note saved","success")},f=>{console.error(f),F().showPopup("Failed to save","warning")})}const y=async f=>{e.datapoint.uploadImages(f).then(h=>{console.log("Images uploaded"),h.map(u=>l.value.insert(()=>({targetValue:`![image](${u})`,select:!1,deviationStart:0,deviationEnd:0}))),d()},h=>{console.error(h)})},p=_(!1);return t({preview:p,fetchNote:i}),(f,h)=>(v(),w("div",nl,[a("div",{class:"editor",onDblclick:h[1]||(h[1]=u=>p.value=!1)},[p.value?(v(),j(I(Wt),{key:1,"model-value":s.value,theme:f.theme},null,8,["model-value","theme"])):(v(),j(I(Nt),{key:0,ref_key:"mdEditor",ref:l,modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=u=>r.value=u),preview:!1,language:"en-US",theme:f.theme,onOnSave:d,onOnUploadImg:y,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"]))],32)]))}}),ol=E(sl,[["__scopeId","data-v-bdd811c7"]]),rl={id:"body"},ll=["src"],il=R({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(o,{expose:t}){const e=o,n=ve(),r=U(()=>{const c=n.currentRoute.value.query.docHashMark;return c||""}),s=_(null),l=_(null),i=_(null),d=_(!1),y=_(null);t({noteEditor:y});function p(g){i.value&&i.value.contains(g.target)&&(d.value=!0)}function f(){d.value=!1}const h=U({get:()=>F().preferredReaderLeftPanelWidthPerc,set:g=>{F().preferredReaderLeftPanelWidthPerc=g}});function u(g){if(d.value&&s.value&&l.value&&i.value){const C=("touches"in g?g.touches[0].clientX:g.clientX)-s.value.getBoundingClientRect().left;s.value.style.width=`${C}px`,l.value.style.width=`calc(100% - ${C}px)`,h.value=C/(C+l.value.getBoundingClientRect().width),h.value=Math.max(.1,Math.min(.9,h.value))}}window.addEventListener("mousedown",p),window.addEventListener("touchstart",p),window.addEventListener("mouseup",f),window.addEventListener("touchend",f),window.addEventListener("mousemove",u),window.addEventListener("touchmove",u);function m(g){g==0?(s.value.style.width="100%",l.value.style.width="0%"):g==1?(s.value.style.width="0%",l.value.style.width="100%"):g==2&&(s.value.style.width=`${h.value*100}%`,l.value.style.width=`${(1-h.value)*100}%`),H().setReaderLayoutType(g)}ee(()=>e.layoutType,(g,c)=>{console.log("layoutType changed:",c,"->",g),m(g)});const k=_(V.isDarkMode()?"dark":"light");V.registerThemeChangeCallback(()=>k.value=V.isDarkMode()?"dark":"light");const b=U(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":k.value},urlHashMark:r.value})}`);return me(()=>{m(e.layoutType)}),(g,c)=>(v(),w("div",rl,[a("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:s},[a("iframe",{src:b.value,title:"doc",frameborder:"0",style:Y({"pointer-events":d.value?"none":"auto"})},null,12,ll)],512),g.layoutType==2?(v(),w("div",{key:0,id:"splitter",ref_key:"splitter",ref:i,onMousedown:p,onTouchstart:p},null,544)):z("",!0),a("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:l},[x(ol,{datapoint:g.datapoint,theme:k.value,ref_key:"noteEditor",ref:y},null,8,["datapoint","theme"])],512)]))}}),ul=E(il,[["__scopeId","data-v-312e7b1f"]]),cl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",dl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",hl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480.118-330Q551-330%20600.5-379.618q49.5-49.617%2049.5-120.5Q650-571%20600.382-620.5q-49.617-49.5-120.5-49.5Q409-670%20359.5-620.382q-49.5%2049.617-49.5%20120.5Q310-429%20359.618-379.5q49.617%2049.5%20120.5%2049.5Zm-.353-58Q433-388%20400.5-420.735q-32.5-32.736-32.5-79.5Q368-547%20400.735-579.5q32.736-32.5%2079.5-32.5Q527-612%20559.5-579.265q32.5%2032.736%2032.5%2079.5Q592-453%20559.265-420.5q-32.736%2032.5-79.5%2032.5ZM480-200q-146%200-264-83T40-500q58-134%20176-217t264-83q146%200%20264%2083t176%20217q-58%20134-176%20217t-264%2083Zm0-300Zm-.169%20240Q601-260%20702.5-325.5%20804-391%20857-500q-53-109-154.331-174.5-101.332-65.5-222.5-65.5Q359-740%20257.5-674.5%20156-609%20102-500q54%20109%20155.331%20174.5%20101.332%2065.5%20222.5%2065.5Z'/%3e%3c/svg%3e",pl={id:"toolbarOps"},fl={id:"recently-read"},ml={id:"main-reader",class:"gradIn"},vl={name:"Reader",inheritAttrs:!1,customOptions:{}},gl=R({...vl,setup(o){const t=K(),e=F(),n=Ot(),r=ve(),s=_(t.database.getDummy());async function l(){const g=await t.database.aget(n.params.id);g&&(s.value=g),e.addRecentlyReadDataUID(g.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(c=>{d(c)}),console.log("Reader: updated datapoint",g.summary.title,"uid",g.uid)}ee(()=>n.params.id,()=>{l()});const i=_([]);function d(g){const c=[];for(const C of g)C.summary.uuid!==n.params.id&&c.push({name:C.authorYear(),action:()=>{r.push("/reader/"+C.summary.uuid)}});console.log("Reader: updated recent read menu items",c),i.value=c}const y=_(H().readerLayoutType);window.innerWidth<800&&(y.value=0);function p(){if(window.innerWidth<800)y.value=(y.value+1)%2;else switch(y.value){case 0:y.value=2;break;case 1:y.value=2;break;case 2:y.value=0;break}}const f=_(null);function h(g){function c(){s.value.uploadDocument(g).then(C=>{s.value.update(C),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}s.value.summary.has_file?s.value.freeDocument().then(C=>{s.value.update(C),c()},()=>e.showPopup("Failed to free document","error")):c()}const u=_(null),m=U(()=>{try{return u.value.noteEditor.preview}catch{return!1}}),k=U(()=>m.value?"edit":"preview");function b(){u.value.noteEditor.preview=!u.value.noteEditor.preview}return me(()=>{console.log("Reader mounted"),l()}),(g,c)=>(v(),w(W,null,[x(I(Te),{action:h,ref_key:"fileSelectionBtn",ref:f,style:{display:"none"}},null,512),x(Ue,null,{default:q(()=>[a("div",pl,[x(he,{iconSrc:I(cl),labelText:"layout",shortcut:"ctrl+r",onOnClick:p,title:"change layout"},null,8,["iconSrc"]),x(he,{iconSrc:I(dl),labelText:"upload",shortcut:"ctrl+u",onOnClick:c[0]||(c[0]=()=>f.value.click()),title:"upload a new document"},null,8,["iconSrc"]),x(he,{iconSrc:I(hl),labelText:k.value,shortcut:"ctrl+p",onOnClick:b,title:"preview or edit markdown note"},null,8,["iconSrc","labelText"]),x(I(wt),{"menu-items":i.value},{default:q(()=>[a("div",fl,T(`${s.value.authorAbbr()} (${s.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),a("div",ml,[x(ul,{datapoint:s.value,layoutType:y.value,ref_key:"readerBody",ref:u},null,8,["datapoint","layoutType"])])],64))}}),yl=E(gl,[["__scopeId","data-v-71034335"]]),le=o=>(ae("data-v-c73462df"),o=o(),ne(),o),_l={class:"toolbar"},wl={id:"about-main",class:"slideIn"},bl=le(()=>a("h1",null,"About",-1)),kl={id:"about-div",class:"content"},Sl=le(()=>a("br",null,null,-1)),$l=le(()=>a("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires",-1)),Cl=le(()=>a("br",null,null,-1)),xl=["href"],Dl=le(()=>a("b",null,"Server status: ",-1)),Il=le(()=>a("b",null,"Backend",-1)),Pl=le(()=>a("b",null,"Version",-1)),Tl=le(()=>a("b",null,"Uptime",-1)),Ul=le(()=>a("b",null,"Number of documents",-1)),Al=le(()=>a("b",null,"Number of connections",-1)),Bl={id:"versionHistory",class:"content"},Rl={class:"block"},Ll={key:0},ql={key:1},El=R({__name:"About",setup(o){const t=_([]),e=_(!1),n=G().conn,r=()=>{n.changelog().then(p=>{t.value=p},p=>{console.error(p)})},s=_(-1),l=U(()=>{if(s.value===-1)return"N/A";const p=Math.floor(s.value/3600),f=Math.floor((s.value-p*3600)/60),h=Math.floor(s.value-p*3600-f*60);return`${p}h ${f}m ${h}s`}),i=_({backend:Pe(),version:"",uptime:l,_uptime:-1,numDocs:-1,numConnections:-1}),d=()=>{n.status().then(p=>{s.value=p.uptime,i.value.version=p.version,i.value.numDocs=p.n_data,i.value.numConnections=p.n_connections},p=>{console.error(p)})},y=U(()=>t.value.slice().reverse());return r(),d(),window.setInterval(()=>s.value++,1e3),re("login",()=>i.value.numConnections++),re("logout",()=>i.value.numConnections--),(p,f)=>(v(),w(W,null,[a("div",_l,[x(Ue)]),a("div",wl,[bl,a("div",kl,[a("p",null,[L(" Lires is a self-hosted web application for research literature management. "),Sl,L(" It is open source and available at "),$l,L(". "),Cl,L(" The user manual is available at "),a("a",{href:I(Qs),target:"_blank"},"here",8,xl),L(". ")]),a("p",null,[Dl,a("ul",null,[a("li",null,[Il,L(": "+T(i.value.backend),1)]),a("li",null,[Pl,L(": "+T(i.value.version),1)]),a("li",null,[Tl,L(": "+T(i.value.uptime),1)]),a("li",null,[Ul,L(": "+T(i.value.numDocs),1)]),a("li",null,[Al,L(": "+T(i.value.numConnections),1)])])]),a("a",{onClick:f[0]||(f[0]=h=>e.value=!0),style:{cursor:"pointer"}},"View change log")]),x($e,{show:e.value,"onUpdate:show":f[1]||(f[1]=h=>e.value=h),title:"Change log"},{default:q(()=>[a("div",Bl,[(v(!0),w(W,null,X(y.value.length,h=>(v(),w("div",Rl,[a("h2",null,T(y.value[h-1][0].toString()),1),a("ul",null,[(v(!0),w(W,null,X(y.value[h-1][1],u=>(v(),w("li",null,[typeof u=="string"?(v(),w("div",Ll,T(u),1)):typeof u=="object"?(v(),w("div",ql,[L(T(Object.keys(u)[0])+" ",1),a("ul",null,[(v(!0),w(W,null,X(u[Object.keys(u)[0]],m=>(v(),w("li",null,T(m),1))),256))])])):z("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),Ml=E(El,[["__scopeId","data-v-c73462df"]]),Ol={},zl={id:"widget-container-main"};function Fl(o,t){return v(),w("div",zl,[pe(o.$slots,"default",{},void 0,!0)])}const Hl=E(Ol,[["render",Fl],["__scopeId","data-v-257ac3c4"]]),Nl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",ie=o=>(ae("data-v-08cedaed"),o=o(),ne(),o),Wl={id:"users-widget-main"},Zl={id:"user-editor-main"},jl={class:"horizontal"},Vl=["src"],Kl={id:"user-editor"},Gl={class:"horizontal"},Ql={class:"horizonal"},Jl={class:"full-width left-align"},Yl=ie(()=>a("b",null,"Mandatory Tags:",-1)),Xl={id:"delete-user-dialog-main"},ei={id:"create-user-table"},ti=ie(()=>a("td",null,"Username:",-1)),ai=ie(()=>a("td",null,"Name:",-1)),ni=ie(()=>a("td",null,"Password:",-1)),si=ie(()=>a("td",null,"Mandatory Tags:",-1)),oi={colspan:"2"},ri={id:"user-widget-header"},li=ie(()=>a("div",null,[a("b",null," Users ")],-1)),ii={key:0},ui=ie(()=>a("th",null," Avatar ",-1)),ci=ie(()=>a("th",null," Username ",-1)),di=ie(()=>a("th",null," Name ",-1)),hi=ie(()=>a("th",null," Accessibility ",-1)),pi={class:"user-line"},fi={key:0},mi=["onClick"],vi=["src"],gi={class:"center full-width full-height"},yi=["src"],_i={class:"username"},wi={key:1,class:"admin_hint"},bi={key:0,colspan:"5"},ki=R({__name:"UsersWidget",setup(o){const t=_([]),e=U(()=>K().user.is_admin),n=G().conn,r=_(!1),s=_({});function l(D){if(!e.value)return;const S=JSON.parse(JSON.stringify(D));s.value=S,r.value=!0}function i(D){const S=D.split(";").map($=>$.trim());S.length===1&&S[0]===""?s.value.mandatory_tags=[]:s.value.mandatory_tags=S}function d(){console.log(s.value),n.setUserAccess(s.value.username,s.value.is_admin,s.value.mandatory_tags).then(D=>{r.value=!1},D=>{console.log(D),F().showPopup(D,"error")})}const y=_(!1),p=_("");function f(){if(p.value!==s.value.username){F().showPopup("Wrong input","error");return}n.deleteUser(s.value.username).then(D=>{F().showPopup(`User ${s.value.username} deleted`,"info"),y.value=!1,r.value=!1},D=>{console.log(D),F().showPopup(D,"error")})}const h=_(!1),u=_(""),m=_(Re[Math.floor(Math.random()*Re.length)]),k=_(""),b=_(!1),g=_("");function c(){h.value=!1,u.value="",m.value=Re[Math.floor(Math.random()*Re.length)],k.value="",b.value=!1,g.value=""}function C(){if(u.value===""){F().showPopup("Please enter the username","error");return}const D=g.value.split(";").map(S=>S.trim());D.length===1&&D[0]===""&&D.splice(0,1),n.createUser(u.value,m.value,k.value,b.value,D).then(S=>{F().showPopup(`User ${u.value} created`,"success"),c()},S=>{console.log(S),F().showPopup(S,"error")})}return me(()=>{n.reqUserList().then(D=>{t.value=D},D=>{console.log(D)})}),re("add_user",D=>{const S=D.user_info;t.value.push(S)}),re("update_user",D=>{const S=D.user_info;t.value.map(($,A)=>{$.id===S.id&&(t.value[A]=S)})}),re("delete_user",D=>{const S=D.username;t.value=t.value.filter($=>$.username!==S)}),(D,S)=>(v(),w("div",Wl,[x(ye,{show:r.value,"onUpdate:show":S[3]||(S[3]=$=>r.value=$),title:"editor",onOnAccept:d,onOnCancel:S[4]||(S[4]=()=>r.value=!1)},{default:q(()=>[a("div",Zl,[a("div",jl,[a("img",{src:`${I(Pe)()}/user-avatar/${s.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,Vl),a("div",Kl,[a("div",Gl,[a("h2",null,T(s.value.name),1),L(" ("+T(s.value.username)+") ",1)]),a("div",Ql,[x(de,{checked:s.value.is_admin,onOnCheck:S[0]||(S[0]=()=>{s.value.is_admin=!s.value.is_admin})},{default:q(()=>[L(" Administrator")]),_:1},8,["checked"])]),a("div",Jl,[Yl,a("div",{id:"mandatory-tag-edit",class:_e(s.value.is_admin?"mute":"")},[x(I(Ge),{style:{width:"100%"},"content-editable":!s.value.is_admin,onFinish:S[1]||(S[1]=$=>i($))},{default:q(()=>[L(T(s.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])],2)])])]),a("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:S[2]||(S[2]=()=>{y.value=!0})})])]),_:1},8,["show"]),x(ye,{show:y.value,"onUpdate:show":S[6]||(S[6]=$=>y.value=$),title:"Delete user",onOnCancel:S[7]||(S[7]=()=>y.value=!1),onOnAccept:f},{default:q(()=>[a("div",Xl,[a("p",null,[L(" Are you sure to delete user "),a("b",null,T(s.value.name)+" ("+T(s.value.username)+")",1),L("? ")]),L(" Type "),a("b",null,T(s.value.username),1),L(" to confirm: "),Z(a("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":S[5]||(S[5]=$=>p.value=$),autocomplete:"off"},null,512),[[Q,p.value]])])]),_:1},8,["show"]),x(ye,{show:h.value,"onUpdate:show":S[13]||(S[13]=$=>h.value=$),onOnCancel:c,onOnAccept:C,onOnClose:c},{default:q(()=>[a("table",ei,[a("tr",null,[ti,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":S[8]||(S[8]=$=>u.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,u.value]])])]),a("tr",null,[ai,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":S[9]||(S[9]=$=>m.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,m.value]])])]),a("tr",null,[ni,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":S[10]||(S[10]=$=>k.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,k.value]])])]),a("tr",null,[si,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":S[11]||(S[11]=$=>g.value=$),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[Q,g.value]])])]),a("tr",null,[a("td",oi,[x(de,{checked:b.value,onOnCheck:S[12]||(S[12]=()=>{b.value=!b.value})},{default:q(()=>[L(" Administrator")]),_:1},8,["checked"])])])])]),_:1},8,["show"]),a("div",ri,[li,e.value?(v(),w("div",{key:0,id:"add-user-div",onClick:S[14]||(S[14]=()=>h.value=!0)},"+")):z("",!0)]),a("table",null,[a("tr",null,[e.value?(v(),w("th",ii)):z("",!0),ui,ci,di,hi]),(v(!0),w(W,null,X(t.value,$=>(v(),w("tr",pi,[e.value?(v(),w("td",fi,[a("div",{class:"edit-button",onClick:()=>l($)},[a("img",{src:I(Nl),alt:"",class:"icon"},null,8,vi)],8,mi)])):z("",!0),a("td",null,[a("div",gi,[a("img",{src:`${I(Pe)()}/user-avatar/${$.username}?size=60`,alt:"",class:"avatar"},null,8,yi)])]),a("td",_i,T($.username),1),a("td",null,T($.name),1),a("td",null,[$.is_admin?(v(),w("label",wi,"ADMIN")):(v(),j(yt,{key:0,tags:$.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),a("tr",null,[t.value.length===0?(v(),w("td",bi," No users ")):z("",!0)])])]))}}),Si=E(ki,[["__scopeId","data-v-08cedaed"]]),$i={id:"main-dashboard",class:"slideIn"},Ci=R({__name:"Dashboard",setup(o){return(t,e)=>(v(),w(W,null,[x(Ue),a("div",$i,[x(Hl,null,{default:q(()=>[x(Si)]),_:1})])],64))}}),xi=E(Ci,[["__scopeId","data-v-34e7789d"]]),Di={class:"editor-block"},Ii={class:"editor-toolbar"},Pi={id:"editor-body"},Ti={key:0,id:"editor-input",class:"body-area"},Ui={key:1,id:"editor-preview",class:"body-area"},Ai=["innerHTML"],Bi=R({__name:"EditorBlock",props:et({preRenderFn:{type:Function,default:o=>o},theme:{default:"light"}},{text:{default:""},textModifiers:{},preview:{type:Boolean,default:!1},previewModifiers:{}}),emits:et(["on-input","on-save","on-upload-images"],["update:text","update:preview"]),setup(o,{expose:t,emit:e}){const n=o,r=tt(o,"text"),s=tt(o,"preview"),l=_(n.preRenderFn(r.value));ee(()=>r.value,f=>{l.value=Zt().render(n.preRenderFn(f))});const i=e;function d(f){i("on-upload-images",[f])}const y=_(null);function p(f){const h=y.value.selectionStart,u=y.value.selectionEnd,m=f.substring(0,h),k=f.substring(u,f.length);f=m+f+k,y.value.value=f}return t({insert:p}),(f,h)=>(v(),w("div",Di,[a("div",Ii,[a("button",{onClick:h[0]||(h[0]=u=>i("on-save",r.value))},"Save"),a("button",{onClick:h[1]||(h[1]=u=>s.value=!s.value)},"Toggle Preview"),x(I(Te),{action:d})]),a("div",Pi,[s.value?(v(),w("div",Ui,[a("div",{innerHTML:l.value},null,8,Ai)])):(v(),w("div",Ti,[Z(a("textarea",{"onUpdate:modelValue":h[2]||(h[2]=u=>r.value=u),onInput:h[3]||(h[3]=u=>i("on-input",r.value)),ref_key:"textarea",ref:y},null,544),[[Q,r.value]])]))])]))}}),Ri=E(Bi,[["__scopeId","data-v-5cb2f3c3"]]),Li={key:0,class:"test"},qi={key:1},Ei=R({__name:"_Test",setup(o){const e=_(""),n=_(!1);function r(){console.log("Note saved")}const s=async l=>{console.log("Images uploaded",l)};return(l,i)=>I(!1)?(v(),w("div",Li,[x(Je,{checked:n.value,"onUpdate:checked":i[0]||(i[0]=d=>n.value=d)},null,8,["checked"]),x(Ri,{text:e.value,"onUpdate:text":i[1]||(i[1]=d=>e.value=d),preview:n.value,"onUpdate:preview":i[2]||(i[2]=d=>n.value=d),onOnSave:r,onOnUploadImages:s},null,8,["text","preview"])])):(v(),w("p",qi," Test is not available in production "))}}),Mi=[{path:"/",component:lr},{path:"/feed",component:qr},{path:"/login",component:el},{path:"/reader/:id",component:yl},{path:"/about",component:Ml},{path:"/dashboard/:username",component:xi},{path:"/_test",component:Ei}],Oi=zt({history:Ft(),routes:Mi}),zi=Mt();Et(ha).use(zi).use(Oi).mount("#app");
