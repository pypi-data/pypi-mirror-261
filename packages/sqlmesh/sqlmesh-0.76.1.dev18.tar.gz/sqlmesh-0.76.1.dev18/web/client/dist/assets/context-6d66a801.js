import{r as E,u as z,a as H,j as J,a8 as $,ac as T,w as y,A as R,ad as C,I as Q,v as x,ae as Z,af as k,i as V,e as ee}from"./index-71398e80.js";import{u as h,M as g}from"./project-1647c629.js";import{M,a as te}from"./file-49f2b60f.js";import{u as ie}from"./editor-7738dbd6.js";const re={Added:1,Modified:2,Deleted:3},j=E.createContext({artifactRename:void 0,setArtifactRename:()=>{},selectArtifactsInRange:()=>new Set,createDirectory:()=>{},createFile:()=>{},renameArtifact:()=>{},removeArtifacts:()=>{},removeArtifactWithConfirmation:()=>{},moveArtifacts:()=>{},isTopGroupInActiveRange:()=>!1,isBottomGroupInActiveRange:()=>!1,isMiddleGroupInActiveRange:()=>!1});function ce({children:G}){const{addError:v}=z(),A=h(e=>e.activeRange),l=h(e=>e.project),_=h(e=>e.files),D=h(e=>e.setActiveRange),b=h(e=>e.setSelectedFile),I=h(e=>e.setFiles),c=h(e=>e.inActiveRange),S=H(e=>e.addConfirmation),f=ie(e=>e.tab),[F,r]=E.useState(!1),[N,w]=E.useState();E.useEffect(()=>{b(f==null?void 0:f.file)},[f==null?void 0:f.id]);function L(e){const n=A.length-1,s=l.allVisibleArtifacts,u=A[0],a=A[n],i=s.indexOf(e),o=u==null?0:s.indexOf(u),d=a==null?n:s.indexOf(a),m=i>o?o:i,p=i>d||i>o&&i<d?i:d;D(s.slice(m,p+1))}function X(e){if(F)return;r(!0);const t=$("new_directory");T(`${e.path}/${t}`,{}).then(n=>{y(n)||e.open()}).catch(n=>v(R.FileExplorer,n)).finally(()=>{r(!1)})}function Y(e,t){if(F)return;y(t)&&(e.isModels?t=".sql":e.isTests?t=".yaml":t=".py"),r(!0);const n=$("new_file",t);C(`${e.path}/${n}`,{content:""}).then(s=>{y(s)||e.open()}).catch(s=>v(R.FileExplorer,s)).finally(()=>{r(!1)})}function q(e,t){var i;t=t==null?void 0:t.trim();const s=(((i=e.parent)==null?void 0:i.artifacts)??[]).some(o=>o.name===t);if(F||Q(t)||s)return;r(!0);const u=e.name,a=e.path;e.rename(t),e instanceof g&&T(a,{new_path:e.path}).catch(o=>{v(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),x(f)&&e.hasFile(f.file)&&b(f.file),I(l.allFiles)}),e instanceof M&&C(a,{new_path:e.path}).then(o=>{e.update(o),_.set(e.path,e),_.delete(a)}).catch(o=>{v(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),I(l.allFiles)})}function P(e){if(F)return;r(!0);const t=e.map(n=>n instanceof M?Z(n.path):k(n.path));Promise.all(t).then(()=>{D([])}).catch(n=>v(R.FileExplorer,n)).finally(()=>{r(!1)})}function B(e){c(e)?S({headline:"Removing Selected Files/Directories",description:`Are you sure you want to remove ${A.length} items?`,yesText:"Yes, Remove",noText:"No, Cancel",details:A.map(t=>t.path),action:()=>{P(A)}}):S({headline:`Removing ${e instanceof g?"Directory":"File"}`,description:`Are you sure you want to remove the ${e instanceof g?"directory":"file"} "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:()=>{x(e.parent)&&P([e])}})}function O(e,t,n=!1){if(F)return;r(!0);const s=[],u=[],a=[];if(e.forEach(i=>{const o=t.containsName(i.name),d=i.path;if(o&&V(n))return a.push(i);n&&i.rename(i.copyName());const m=te.toPath(t.path,i.name);i instanceof g&&(s.push(()=>{var p;(p=i.parent)==null||p.removeDirectory(i),t.addDirectory(i)}),u.push(T(d,{new_path:m})),i.allVisibleArtifacts.forEach(p=>e.splice(e.indexOf(p),1))),i instanceof M&&(s.push(()=>{var p;(p=i.parent)==null||p.removeFile(i),t.addFile(i)}),u.push(C(d,{new_path:m})))}),ee(a)){S({headline:"Moving Duplicates",description:"All duplicated names will be renamed!",yesText:"Yes, Rename",noText:"No, Cancel",details:a.map(i=>i.path),action:()=>{O(e,t,!0)}});return}Promise.all(u).then(i=>{i.forEach((o,d)=>{var m;return(m=s[d])==null?void 0:m.call(s)})}).catch(i=>{console.log(i)}).finally(()=>{r(!1),D([]),I(l.allFiles)})}function W(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&(y(n)||V(c(n)))&&x(s)&&c(s)}function K(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&(y(s)||V(c(s)))&&x(n)&&c(n)}function U(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&x(s)&&c(s)&&x(n)&&c(n)}return J.jsx(j.Provider,{value:{artifactRename:N,setArtifactRename:w,createDirectory:X,createFile:Y,renameArtifact:q,removeArtifacts:P,removeArtifactWithConfirmation:B,moveArtifacts:O,selectArtifactsInRange:L,isTopGroupInActiveRange:W,isBottomGroupInActiveRange:K,isMiddleGroupInActiveRange:U},children:G})}function ae(){return E.useContext(j)}export{re as EnumFileExplorerChange,j as FileExplorerContext,ce as default,ae as useFileExplorer};
