"""
Stream method tests using actual receiver binary outputs for pyrtcm.rtcmReader 

Created on 3 Oct 2020 

*** NB: must be saved in UTF-8 format ***

@author: semuadmin
"""
# pylint: disable=line-too-long, invalid-name, missing-docstring, no-member

import os
import sys
import unittest

from io import StringIO
from src.pyrtcm import (
    RTCMReader,
    RTCMMessage,
    RTCMParseError,
    RTCMMessageError,
)
import pyrtcm.rtcmtypes_core as rtt


class StreamTest(unittest.TestCase):
    def setUp(self):
        self.maxDiff = None
        dirname = os.path.dirname(__file__)
        self._raw1005ex = b"\xD3\x00\x13\x3E\xD7\xD3\x02\x02\x98\x0E\xDE\xEF\x34\xB4\xBD\x62\xAC\x09\x41\x98\x6F\x33\x36\x0B\x98"
        self._raw1005 = (
            b"\xd3\x00\x13>\xd0\x00\x03\x8aX\xd9I<\x87/4\x10\x9d\x07\xd6\xafH Z\xd7\xf7"
        )
        self._raw1007 = b"\xd3\x00\x08>\xf4\xd2\x03ABC\xeapo\xc7"
        # 00111110 11110100 11010010 00000011 01000001 01000010 01000011 11101010
        self._raw1065 = (
            b"\xd3\x00\x12B\x91\x81\xc9\x84\x00\x04B\xb8\x88\x008\x80\t\xd0F\x00(\xf0kf"
        )
        self._raw1023 = b'\xd3\x00I?\xf0\x8c\xa9\x02\xe0\xe0(\x80P\x07\x04\x04\x80P\x00{?\xc0/o\xf0\x0b\xee\xfc\x81\xfd\xbfp\x17\xc4\x04\x04\xf9\x80\x00\xdf?\xe8#\xe7\xfb\x02~\x00`o\xc8\x04\x11\xfa\xff\x82\xbf?\xc07\xfc\n\x08\x00\x00\x81@\x10\x00/\xff\xfe\x0bz"\x00\xc1\x16\x92'
        self._payload1007 = self._raw1007[3:-3]

    def tearDown(self):
        pass

    def catchio(self):
        """
        Capture stdout as string.
        """

        self._saved_stdout = sys.stdout
        self._strout = StringIO()
        sys.stdout = self._strout

    def restoreio(self) -> str:
        """
        Return captured output and restore stdout.
        """

        sys.stdout = self._saved_stdout
        return self._strout.getvalue().strip()

    def test1005example(
        self,
    ):  # test sample 1005 given in RTCM standard (with scaling applied)
        EXPECTED_RESULT = "<RTCM(1005, DF002=1005, DF003=2003, DF021=0, DF022=1, DF023=0, DF024=0, DF141=0, DF025=1114104.5999, DF142=0, DF001_1=0, DF026=-4850729.7108000005, DF364=0, DF027=3975521.4643)>"
        msg = RTCMReader.parse(self._raw1005ex)
        self.assertEqual(str(msg), EXPECTED_RESULT)
        self.assertEqual(msg.DF025, 1114104.5999)
        self.assertEqual(msg.DF026, -4850729.7108000005)
        self.assertEqual(msg.DF027, 3975521.4643)

    def test1023(
        self,
    ):  # test sample 1023 given in RTCM standard
        EXPECTED_RESULT = "<RTCM(1023, DF002=1023, DF147=8, DF190=1, DF191=1, DF192=173067.5, DF193=57384.5, DF194=5.0, DF195=7.0, DF196=0.008, DF197=0.009000000000000001, DF198=0.8, DF199_01=0.0, DF200_01=-0.0006000000000000001, DF201_01=-0.002, DF199_02=6e-05, DF200_02=-0.00057, DF201_02=-0.004, DF199_03=0.00015000000000000001, DF200_03=-0.00054, DF201_03=-0.007, DF199_04=0.00021, DF200_04=-0.00057, DF201_04=-0.009000000000000001, DF199_05=6e-05, DF200_05=-0.00045, DF201_05=0.002, DF199_06=0.00012, DF200_06=-0.00039, DF201_06=0.0, DF199_07=0.00018, DF200_07=-0.00039, DF201_07=-0.003, DF199_08=0.00024, DF200_08=-0.00039, DF201_08=-0.005, DF199_09=0.00012, DF200_09=-0.00024, DF201_09=0.003, DF199_10=0.00018, DF200_10=-0.00021, DF201_10=0.001, DF199_11=0.00024, DF200_11=-0.00018, DF201_11=-0.001, DF199_12=0.00030000000000000003, DF200_12=-0.00021, DF201_12=-0.004, DF199_13=0.00018, DF200_13=-3e-05, DF201_13=0.005, DF199_14=0.00024, DF200_14=0.0, DF201_14=0.002, DF199_15=0.00030000000000000003, DF200_15=3e-05, DF201_15=0.0, DF199_16=0.00033, DF200_16=-3e-05, DF201_16=-0.002, DF212=0, DF213=0, DF216=5, DF217=5, DF051=59528)>"
        msg = RTCMReader.parse(self._raw1023)
        self.assertEqual(str(msg), EXPECTED_RESULT)

    def test1230(
        self,
    ):  # test sample 1230
        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-1230.bin"), "rb") as stream:
            EXPECTED_RESULT = [
                "<RTCM(1230, DF002=1230, DF003=0, DF421=0, DF001_3=0, DF422_1=1, DF422_2=1, DF422_3=1, DF422_4=1, DF423=0.0, DF424=0.0, DF425=0.0, DF426=0.0)>",
                "<RTCM(1230, DF002=1230, DF003=0, DF421=0, DF001_3=0, DF422_1=1, DF422_2=1, DF422_3=1, DF422_4=1, DF423=0.0, DF424=0.0, DF425=0.0, DF426=0.0)>",
                "<RTCM(1230, DF002=1230, DF003=0, DF421=0, DF001_3=0, DF422_1=1, DF422_2=1, DF422_3=1, DF422_4=1, DF423=0.0, DF424=0.0, DF425=0.0, DF426=0.0)>",
                "<RTCM(1230, DF002=1230, DF003=0, DF421=0, DF001_3=0, DF422_1=1, DF422_2=1, DF422_3=1, DF422_4=1, DF423=0.0, DF424=0.0, DF425=0.0, DF426=0.0)>",
                "<RTCM(1230, DF002=1230, DF003=0, DF421=0, DF001_3=0, DF422_1=1, DF422_2=0, DF422_3=1, DF422_4=1, DF423=0.0, DF425=0.0, DF426=0.0)>",
            ]
            rtr = RTCMReader(stream, quitonerror=2)
            i = 0
            for raw, parsed in rtr:
                # print(f"{parsed},")
                self.assertEqual(str(parsed), EXPECTED_RESULT[i])
                i += 1
            self.assertEqual(i, 5)

    def testMSM3(
        self,
    ):  # test sample MSM3 output
        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-RTCMMSM3.log"), "rb") as stream:
            EXPECTED_RESULT = (
                "<RTCM(1073, DF002=1073, DF003=11, DF004=84967000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=301936338347753472, NSat=8, DF395=1077969152, NSig=4, DF396=3148532923, NCell=20, DF398_01(006)=0.5908203125, DF398_02(011)=0.9345703125, DF398_03(012)=0.705078125, DF398_04(017)=0.8779296875, DF398_05(019)=0.5947265625, DF398_06(020)=0.5322265625, DF398_07(024)=0.5146484375, DF398_08(025)=0.974609375, DF400_01(006,1C)=-0.00019592046737670898, DF400_02(006,2X)=-0.00015676021575927734, DF400_03(006,5X)=-0.00015121698379516602, DF400_04(011,1C)=-0.00035965442657470703, DF400_05(011,2X)=-0.0003299713134765625, DF400_06(011,5X)=-0.0003161430358886719, DF400_07(012,1C)=-0.00033777952194213867, DF400_08(012,2X)=-0.00030922889709472656, DF400_09(017,1C)=-1.3649463653564453e-05, DF400_10(017,2X)=3.707408905029297e-05, DF400_11(019,1C)=-0.00016617774963378906, DF400_12(019,2W)=-0.00013810396194458008, DF400_13(020,1C)=0.00023931264877319336, DF400_14(020,2W)=0.00028312206268310547, DF400_15(024,1C)=-0.0002028346061706543, DF400_16(024,2X)=-0.00014156103134155273, DF400_17(024,5X)=-0.00013011693954467773, DF400_18(025,1C)=-0.000519096851348877, DF400_19(025,2X)=-0.0004698038101196289, DF400_20(025,5X)=-0.0004578232765197754, DF401_01(006,1C)=-2.4491921067237854e-05, DF401_02(006,2X)=0.0002934858202934265, DF401_03(006,5X)=0.00013548694550991058, DF401_04(011,1C)=-0.00017477944493293762, DF401_05(011,2X)=-5.480460822582245e-05, DF401_06(011,5X)=-1.714937388896942e-05, DF401_07(012,1C)=-0.00022045522928237915, DF401_08(012,2X)=-0.00045765936374664307, DF401_09(017,1C)=-4.125945270061493e-05, DF401_10(017,2X)=0.0002892687916755676, DF401_11(019,1C)=-4.3375417590141296e-05, DF401_12(019,2W)=-3.8215890526771545e-05, DF401_13(020,1C)=0.00035588257014751434, DF401_14(020,2W)=0.00048608891665935516, DF401_15(024,1C)=-0.0001531168818473816, DF401_16(024,2X)=-5.9857964515686035e-05, DF401_17(024,5X)=-5.963258445262909e-05, DF401_18(025,1C)=-0.0004779081791639328, DF401_19(025,2X)=-0.0004279632121324539, DF401_20(025,5X)=-0.0003839787095785141, DF402_01(006,1C)=15, DF402_02(006,2X)=15, DF402_03(006,5X)=15, DF402_04(011,1C)=15, DF402_05(011,2X)=15, DF402_06(011,5X)=15, DF402_07(012,1C)=15, DF402_08(012,2X)=15, DF402_09(017,1C)=15, DF402_10(017,2X)=15, DF402_11(019,1C)=15, DF402_12(019,2W)=15, DF402_13(020,1C)=15, DF402_14(020,2W)=15, DF402_15(024,1C)=15, DF402_16(024,2X)=15, DF402_17(024,5X)=15, DF402_18(025,1C)=15, DF402_19(025,2X)=15, DF402_20(025,5X)=15, DF420_01(006,1C)=0, DF420_02(006,2X)=0, DF420_03(006,5X)=0, DF420_04(011,1C)=0, DF420_05(011,2X)=0, DF420_06(011,5X)=0, DF420_07(012,1C)=0, DF420_08(012,2X)=0, DF420_09(017,1C)=0, DF420_10(017,2X)=0, DF420_11(019,1C)=0, DF420_12(019,2W)=0, DF420_13(020,1C)=0, DF420_14(020,2W)=0, DF420_15(024,1C)=0, DF420_16(024,2X)=0, DF420_17(024,5X)=0, DF420_18(025,1C)=0, DF420_19(025,2X)=0, DF420_20(025,5X)=0)>",
                "<RTCM(1083, DF002=1083, DF003=11, DF416=1, DF034=9349000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=4648805530981105664, NSat=7, DF395=1090519040, NSig=2, DF396=16383, NCell=14, DF398_01(002)=0.109375, DF398_02(009)=0.0654296875, DF398_03(015)=0.7080078125, DF398_04(016)=0.49609375, DF398_05(017)=0.1494140625, DF398_06(018)=0.572265625, DF398_07(019)=0.9384765625, DF400_01(002,1C)=4.8160552978515625e-05, DF400_02(002,2C)=9.763240814208984e-05, DF400_03(009,1C)=-0.00029778480529785156, DF400_04(009,2C)=-0.00025451183319091797, DF400_05(015,1C)=0.00029659271240234375, DF400_06(015,2C)=0.0003286004066467285, DF400_07(016,1C)=-0.0003834962844848633, DF400_08(016,2C)=-0.0003559589385986328, DF400_09(017,1C)=-9.435415267944336e-05, DF400_10(017,2C)=-6.389617919921875e-05, DF400_11(018,1C)=0.00026482343673706055, DF400_12(018,2C)=0.00029337406158447266, DF400_13(019,1C)=0.00018155574798583984, DF400_14(019,2C)=0.00021916627883911133, DF401_01(002,1C)=6.616860628128052e-05, DF401_02(002,2C)=-4.974938929080963e-05, DF401_03(009,1C)=-0.0002772025763988495, DF401_04(009,2C)=-0.00024692341685295105, DF401_05(015,1C)=0.000372542068362236, DF401_06(015,2C)=0.0004738159477710724, DF401_07(016,1C)=-0.00028068386018276215, DF401_08(016,2C)=-0.00020503997802734375, DF401_09(017,1C)=5.776435136795044e-05, DF401_10(017,2C)=9.675323963165283e-05, DF401_11(018,1C)=0.00043816305696964264, DF401_12(018,2C)=0.0005486086010932922, DF401_13(019,1C)=0.00024857930839061737, DF401_14(019,2C)=0.00035401806235313416, DF402_01(002,1C)=12, DF402_02(002,2C)=12, DF402_03(009,1C)=15, DF402_04(009,2C)=15, DF402_05(015,1C)=15, DF402_06(015,2C)=15, DF402_07(016,1C)=15, DF402_08(016,2C)=15, DF402_09(017,1C)=15, DF402_10(017,2C)=15, DF402_11(018,1C)=15, DF402_12(018,2C)=15, DF402_13(019,1C)=15, DF402_14(019,2C)=15, DF420_01(002,1C)=0, DF420_02(002,2C)=0, DF420_03(009,1C)=0, DF420_04(009,2C)=0, DF420_05(015,1C)=0, DF420_06(015,2C)=0, DF420_07(016,1C)=0, DF420_08(016,2C)=0, DF420_09(017,1C)=0, DF420_10(017,2C)=0, DF420_11(018,1C)=0, DF420_12(018,2C)=0, DF420_13(019,1C)=0, DF420_14(019,2C)=0)>",
                "<RTCM(1093, DF002=1093, DF003=11, DF248=84967000, DF393=0, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=4643212865354858496, NSat=7, DF395=136318976, NSig=3, DF396=2097151, NCell=21, DF398_01(002)=0.90625, DF398_02(010)=0.681640625, DF398_03(011)=0.5947265625, DF398_04(012)=0.978515625, DF398_05(024)=0.1435546875, DF398_06(025)=0.69140625, DF398_07(036)=0.0966796875, DF400_01(002,1X)=0.0004801750183105469, DF400_02(002,6X)=0.0004673600196838379, DF400_03(002,8X)=0.0005109310150146484, DF400_04(010,1X)=-0.00032961368560791016, DF400_05(010,6X)=-0.0003273487091064453, DF400_06(010,8X)=-0.00029224157333374023, DF400_07(011,1X)=-0.0004706382751464844, DF400_08(011,6X)=-0.0004949569702148438, DF400_09(011,8X)=-0.00045502185821533203, DF400_10(012,1X)=-0.00025582313537597656, DF400_11(012,6X)=-0.0002620220184326172, DF400_12(012,8X)=-0.0002136826515197754, DF400_13(024,1X)=-0.00032019615173339844, DF400_14(024,6X)=-0.0003135204315185547, DF400_15(024,8X)=-0.00026530027389526367, DF400_16(025,1X)=-0.000273287296295166, DF400_17(025,6X)=-0.00028705596923828125, DF400_18(025,8X)=-0.00024384260177612305, DF400_19(036,1X)=-0.0003002285957336426, DF400_20(036,6X)=-0.00031071901321411133, DF400_21(036,8X)=-0.00026482343673706055, DF401_01(002,1X)=0.0005859378725290298, DF401_02(002,6X)=0.0006353985518217087, DF401_03(002,8X)=0.0006924550980329514, DF401_04(010,1X)=-0.00018913671374320984, DF401_05(010,6X)=-0.0001242123544216156, DF401_06(010,8X)=-0.00010369531810283661, DF401_07(011,1X)=-0.0003564227372407913, DF401_08(011,6X)=-0.00030716508626937866, DF401_09(011,8X)=-0.00023801438510417938, DF401_10(012,1X)=-0.0001758616417646408, DF401_11(012,6X)=-0.00015475042164325714, DF401_12(012,8X)=-7.56438821554184e-05, DF401_13(024,1X)=-0.0003506764769554138, DF401_14(024,6X)=-0.00036552175879478455, DF401_15(024,8X)=-0.00033131055533885956, DF401_16(025,1X)=-0.0001549702137708664, DF401_17(025,6X)=-0.00010699406266212463, DF401_18(025,8X)=-3.882870078086853e-05, DF401_19(036,1X)=-0.00012858770787715912, DF401_20(036,6X)=-7.558800280094147e-05, DF401_21(036,8X)=-4.972890019416809e-05, DF402_01(002,1X)=15, DF402_02(002,6X)=15, DF402_03(002,8X)=15, DF402_04(010,1X)=15, DF402_05(010,6X)=15, DF402_06(010,8X)=15, DF402_07(011,1X)=15, DF402_08(011,6X)=15, DF402_09(011,8X)=15, DF402_10(012,1X)=15, DF402_11(012,6X)=15, DF402_12(012,8X)=15, DF402_13(024,1X)=15, DF402_14(024,6X)=15, DF402_15(024,8X)=15, DF402_16(025,1X)=15, DF402_17(025,6X)=15, DF402_18(025,8X)=15, DF402_19(036,1X)=15, DF402_20(036,6X)=15, DF402_21(036,8X)=15, DF420_01(002,1X)=0, DF420_02(002,6X)=0, DF420_03(002,8X)=0, DF420_04(010,1X)=0, DF420_05(010,6X)=0, DF420_06(010,8X)=0, DF420_07(011,1X)=0, DF420_08(011,6X)=0, DF420_09(011,8X)=0, DF420_10(012,1X)=0, DF420_11(012,6X)=0, DF420_12(012,8X)=0, DF420_13(024,1X)=0, DF420_14(024,6X)=0, DF420_15(024,8X)=0, DF420_16(025,1X)=0, DF420_17(025,6X)=0, DF420_18(025,8X)=0, DF420_19(036,1X)=0, DF420_20(036,6X)=0, DF420_21(036,8X)=0)>",
            )
            rtr = RTCMReader(stream, quitonerror=2)
            i = 0
            for raw, parsed in rtr:
                # print(f'"{parsed}",')
                self.assertEqual(str(parsed), EXPECTED_RESULT[i])
                i += 1
            self.assertEqual(i, 3)

    def testMIXEDRTCM_NOSCALE(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with no scaling applied
        EXPECTED_RESULTS = (
            "<RTCM(1005, DF002=1005, DF003=0, DF021=0, DF022=1, DF023=1, DF024=1, DF141=0, DF025=44440308028, DF142=1, DF001_1=0, DF026=30856712349, DF364=0, DF027=33666582560)>",
            "<RTCM(4072, DF002=4072, Not_Yet_Implemented)>",
            "<RTCM(1077, DF002=1077, DF003=0, DF004=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=760738918298550272, NSat=10, DF395=1073807360, NSig=2, DF396=1044459, NCell=17, DF397_01=75, DF397_02=75, DF397_03=81, DF397_04=72, DF397_05=67, DF397_06=80, DF397_07=75, DF397_08=82, DF397_09=75, DF397_10=71, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, ExtSatInfo_06=0, ExtSatInfo_07=0, ExtSatInfo_08=0, ExtSatInfo_09=0, ExtSatInfo_10=0, DF398_01=6, DF398_02=547, DF398_03=781, DF398_04=142, DF398_05=563, DF398_06=116, DF398_07=823, DF398_08=105, DF398_09=534, DF398_10=354, DF399_01=-178, DF399_02=-304, DF399_03=-643, DF399_04=477, DF399_05=-52, DF399_06=645, DF399_07=529, DF399_08=643, DF399_09=-428, DF399_10=-181, DF405_01=76821, DF405_02=76146, DF405_03=208482, DF405_04=207990, DF405_05=-259757, DF405_06=-251705, DF405_07=186759, DF405_08=117947, DF405_09=115540, DF405_10=-101213, DF405_11=-98350, DF405_12=-54158, DF405_13=-52852, DF405_14=257029, DF405_15=234424, DF405_16=-166735, DF405_17=-165708, DF406_01=304801, DF406_02=307946, DF406_03=838384, DF406_04=832000, DF406_05=-1040227, DF406_06=-1005568, DF406_07=745973, DF406_08=467269, DF406_09=463801, DF406_10=-400680, DF406_11=-394066, DF406_12=-214602, DF406_13=-208840, DF406_14=886532, DF406_15=935439, DF406_16=-668448, DF406_17=-663545, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF407_12=341, DF407_13=341, DF407_14=295, DF407_15=341, DF407_16=341, DF407_17=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF420_13=0, DF420_14=0, DF420_15=0, DF420_16=0, DF420_17=0, DF408_01=720, DF408_02=608, DF408_03=688, DF408_04=624, DF408_05=624, DF408_06=592, DF408_07=720, DF408_08=736, DF408_09=736, DF408_10=624, DF408_11=544, DF408_12=720, DF408_13=608, DF408_14=496, DF408_15=720, DF408_16=736, DF408_17=656, DF404_01=-9231, DF404_02=-9194, DF404_03=-8321, DF404_04=-8326, DF404_05=-4107, DF404_06=-4072, DF404_07=2451, DF404_08=-693, DF404_09=-684, DF404_10=9390, DF404_11=9417, DF404_12=2384, DF404_13=2416, DF404_14=6636, DF404_15=-9556, DF404_16=-2148, DF404_17=-2174)>",
            "<RTCM(1087, DF002=1087, DF003=0, DF416=2, DF034=42119001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=4039168114821169152, NSat=7, DF395=1090519040, NSig=2, DF396=16382, NCell=13, DF397_01=69, DF397_02=64, DF397_03=73, DF397_04=76, DF397_05=66, DF397_06=70, DF397_07=78, DF419_01=12, DF419_02=13, DF419_03=8, DF419_04=5, DF419_05=0, DF419_06=7, DF419_07=10, DF398_01=649, DF398_02=351, DF398_03=260, DF398_04=318, DF398_05=525, DF398_06=847, DF398_07=905, DF399_01=-665, DF399_02=29, DF399_03=672, DF399_04=-573, DF399_05=-211, DF399_06=312, DF399_07=317, DF405_01=133875, DF405_02=134842, DF405_03=-25120, DF405_04=-27605, DF405_05=5983, DF405_06=11545, DF405_07=252755, DF405_08=257427, DF405_09=-208262, DF405_10=-201884, DF405_11=148812, DF405_12=154159, DF405_13=-126765, DF406_01=535524, DF406_02=538534, DF406_03=-103820, DF406_04=-110050, DF406_05=23943, DF406_06=46822, DF406_07=1009883, DF406_08=1041159, DF406_09=-832392, DF406_10=-807014, DF406_11=596748, DF406_12=618626, DF406_13=-508918, DF407_01=341, DF407_02=341, DF407_03=340, DF407_04=340, DF407_05=341, DF407_06=341, DF407_07=340, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF407_12=341, DF407_13=340, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF420_13=0, DF408_01=752, DF408_02=640, DF408_03=752, DF408_04=672, DF408_05=752, DF408_06=624, DF408_07=576, DF408_08=528, DF408_09=768, DF408_10=688, DF408_11=768, DF408_12=640, DF408_13=656, DF404_01=-8193, DF404_02=-8173, DF404_03=8539, DF404_04=8501, DF404_05=7333, DF404_06=7311, DF404_07=-2493, DF404_08=-2543, DF404_09=-2158, DF404_10=-2178, DF404_11=3924, DF404_12=3947, DF404_13=6146)>",
            "<RTCM(1097, DF002=1097, DF003=0, DF248=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=216181732825628672, NSat=5, DF395=1073872896, NSig=2, DF396=1023, NCell=10, DF397_01=79, DF397_02=84, DF397_03=89, DF397_04=78, DF397_05=83, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, DF398_01=160, DF398_02=257, DF398_03=363, DF398_04=380, DF398_05=266, DF399_01=-198, DF399_02=-516, DF399_03=423, DF399_04=63, DF399_05=-384, DF405_01=-24373, DF405_02=-15168, DF405_03=-185743, DF405_04=-175463, DF405_05=258219, DF405_06=269106, DF405_07=-73530, DF405_08=-67668, DF405_09=-9900, DF405_10=-1633, DF406_01=-95448, DF406_02=-60891, DF406_03=-757091, DF406_04=-700882, DF406_05=1035170, DF406_06=1075556, DF406_07=-295430, DF406_08=-271348, DF406_09=-38736, DF406_10=-7071, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF408_01=736, DF408_02=784, DF408_03=656, DF408_04=688, DF408_05=688, DF408_06=688, DF408_07=720, DF408_08=784, DF408_09=688, DF408_10=752, DF404_01=-5806, DF404_02=-5831, DF404_03=-7947, DF404_04=-7943, DF404_05=7243, DF404_06=7174, DF404_07=5534, DF404_08=5545, DF404_09=-7726, DF404_10=-7733)>",
            "<RTCM(1127, DF002=1127, DF003=0, DF427=204123001, DF393=0, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=198178247981137920, NSat=10, DF395=1074003968, NSig=2, DF396=387754, NCell=11, DF397_01=129, DF397_02=132, DF397_03=126, DF397_04=75, DF397_05=81, DF397_06=84, DF397_07=78, DF397_08=74, DF397_09=130, DF397_10=86, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, ExtSatInfo_06=0, ExtSatInfo_07=0, ExtSatInfo_08=0, ExtSatInfo_09=0, ExtSatInfo_10=0, DF398_01=120, DF398_02=493, DF398_03=317, DF398_04=743, DF398_05=420, DF398_06=584, DF398_07=573, DF398_08=330, DF398_09=592, DF398_10=690, DF399_01=-130, DF399_02=-58, DF399_03=-81, DF399_04=32, DF399_05=-398, DF399_06=436, DF399_07=-523, DF399_08=-65, DF399_09=-182, DF399_10=79, DF405_01=-208596, DF405_02=122033, DF405_03=216714, DF405_04=212638, DF405_05=-89572, DF405_06=-25529, DF405_07=197283, DF405_08=142968, DF405_09=-134357, DF405_10=-63371, DF405_11=-157715, DF406_01=-833669, DF406_02=486390, DF406_03=865861, DF406_04=851310, DF406_05=-358508, DF406_06=-104126, DF406_07=793957, DF406_08=569965, DF406_09=-539350, DF406_10=-254868, DF406_11=-633415, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF408_01=720, DF408_02=656, DF408_03=672, DF408_04=720, DF408_05=768, DF408_06=736, DF408_07=672, DF408_08=752, DF408_09=768, DF408_10=704, DF408_11=688, DF404_01=-5674, DF404_02=-6120, DF404_03=-1384, DF404_04=-1332, DF404_05=5992, DF404_06=-7312, DF404_07=1732, DF404_08=-4308, DF404_09=-5975, DF404_10=-6733, DF404_11=6122)>",
            "<RTCM(1230, DF002=1230, DF003=0, DF421=1, DF001_3=0, DF422_1=0, DF422_2=0, DF422_3=0, DF422_4=0)>",
            "<RTCM(1007, DF002=1007, DF003=1234, DF029=3, DF030_01=A, DF030_02=B, DF030_03=C, DF031=234)>",
            "<RTCM(1117, DF002=1117, DF003=0, DF428=385820000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=7061644215716937728, NSat=3, DF395=1073774849, NSig=4, DF396=4095, NCell=12, DF397_01=140, DF397_02=112, DF397_03=133, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, DF398_01=176, DF398_02=128, DF398_03=893, DF399_01=481, DF399_02=-28, DF399_03=1, DF405_01=121518, DF405_02=141210, DF405_03=131740, DF405_04=123624, DF405_05=-20668, DF405_06=-4471, DF405_07=-12126, DF405_08=-17656, DF405_09=-52645, DF405_10=-38454, DF405_11=-46050, DF405_12=-51391, DF406_01=-471984, DF406_02=1075651, DF406_03=-8483, DF406_04=476711, DF406_05=837780, DF406_06=-367061, DF406_07=-358394, DF406_08=-404031, DF406_09=610251, DF406_10=-420698, DF406_11=441746, DF406_12=381254, DF407_01=516, DF407_02=462, DF407_03=684, DF407_04=365, DF407_05=648, DF407_06=649, DF407_07=649, DF407_08=649, DF407_09=568, DF407_10=704, DF407_11=704, DF407_12=704, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF408_01=485, DF408_02=574, DF408_03=552, DF408_04=552, DF408_05=778, DF408_06=808, DF408_07=842, DF408_08=819, DF408_09=613, DF408_10=699, DF408_11=733, DF408_12=645, DF404_01=-1064, DF404_02=-16384, DF404_03=-16384, DF404_04=-16384, DF404_05=-5875, DF404_06=-16384, DF404_07=-16384, DF404_08=-16384, DF404_09=-4130, DF404_10=-16384, DF404_11=-16384, DF404_12=-16384)>",
        )

        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-RTCM3.log"), "rb") as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(stream, scaling=False, labelmsm=False)
            for raw, parsed in rtr:
                if raw is not None:
                    # print(f'"{parsed}",')
                    self.assertEqual(str(parsed), EXPECTED_RESULTS[i])
                    i += 1

    def testMIXEDRTCM_SCALE(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with scaling applied
        EXPECTED_RESULTS = (
            "<RTCM(1005, DF002=1005, DF003=0, DF021=0, DF022=1, DF023=1, DF024=1, DF141=0, DF025=4444030.802800001, DF142=1, DF001_1=0, DF026=3085671.2349, DF364=0, DF027=3366658.256)>",
            "<RTCM(4072, DF002=4072, Not_Yet_Implemented)>",
            "<RTCM(1077, DF002=1077, DF003=0, DF004=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=760738918298550272, NSat=10, DF395=1073807360, NSig=2, DF396=1044459, NCell=17, DF397_01=75, DF397_02=75, DF397_03=81, DF397_04=72, DF397_05=67, DF397_06=80, DF397_07=75, DF397_08=82, DF397_09=75, DF397_10=71, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, ExtSatInfo_06=0, ExtSatInfo_07=0, ExtSatInfo_08=0, ExtSatInfo_09=0, ExtSatInfo_10=0, DF398_01=0.005859375, DF398_02=0.5341796875, DF398_03=0.7626953125, DF398_04=0.138671875, DF398_05=0.5498046875, DF398_06=0.11328125, DF398_07=0.8037109375, DF398_08=0.1025390625, DF398_09=0.521484375, DF398_10=0.345703125, DF399_01=-178, DF399_02=-304, DF399_03=-643, DF399_04=477, DF399_05=-52, DF399_06=645, DF399_07=529, DF399_08=643, DF399_09=-428, DF399_10=-181, DF405_01=0.00014309026300907135, DF405_02=0.00014183297753334045, DF405_03=0.0003883279860019684, DF405_04=0.00038741156458854675, DF405_05=-0.0004838351160287857, DF405_06=-0.00046883709728717804, DF405_07=0.0003478657454252243, DF405_08=0.0002196934074163437, DF405_09=0.00021521002054214478, DF405_10=-0.00018852390348911285, DF405_11=-0.00018319115042686462, DF405_12=-0.00010087713599205017, DF405_13=-9.844452142715454e-05, DF405_14=0.00047875382006168365, DF405_15=0.00043664872646331787, DF405_16=-0.0003105681389570236, DF405_17=-0.00030865520238876343, DF406_01=0.00014193402603268623, DF406_02=0.00014339853078126907, DF406_03=0.00039040297269821167, DF406_04=0.00038743019104003906, DF406_05=-0.0004843934439122677, DF406_06=-0.00046825408935546875, DF406_07=0.0003473707474768162, DF406_08=0.00021758908405900002, DF406_09=0.00021597417071461678, DF406_10=-0.00018658116459846497, DF406_11=-0.00018350128084421158, DF406_12=-9.993184357881546e-05, DF406_13=-9.724870324134827e-05, DF406_14=0.0004128236323595047, DF406_15=0.0004355977289378643, DF406_16=-0.0003112703561782837, DF406_17=-0.00030898721888661385, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF407_12=341, DF407_13=341, DF407_14=295, DF407_15=341, DF407_16=341, DF407_17=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF420_13=0, DF420_14=0, DF420_15=0, DF420_16=0, DF420_17=0, DF408_01=45.0, DF408_02=38.0, DF408_03=43.0, DF408_04=39.0, DF408_05=39.0, DF408_06=37.0, DF408_07=45.0, DF408_08=46.0, DF408_09=46.0, DF408_10=39.0, DF408_11=34.0, DF408_12=45.0, DF408_13=38.0, DF408_14=31.0, DF408_15=45.0, DF408_16=46.0, DF408_17=41.0, DF404_01=-0.9231, DF404_02=-0.9194, DF404_03=-0.8321000000000001, DF404_04=-0.8326, DF404_05=-0.4107, DF404_06=-0.4072, DF404_07=0.2451, DF404_08=-0.0693, DF404_09=-0.0684, DF404_10=0.9390000000000001, DF404_11=0.9417000000000001, DF404_12=0.2384, DF404_13=0.2416, DF404_14=0.6636000000000001, DF404_15=-0.9556, DF404_16=-0.21480000000000002, DF404_17=-0.2174)>",
            "<RTCM(1087, DF002=1087, DF003=0, DF416=2, DF034=42119001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=4039168114821169152, NSat=7, DF395=1090519040, NSig=2, DF396=16382, NCell=13, DF397_01=69, DF397_02=64, DF397_03=73, DF397_04=76, DF397_05=66, DF397_06=70, DF397_07=78, DF419_01=12, DF419_02=13, DF419_03=8, DF419_04=5, DF419_05=0, DF419_06=7, DF419_07=10, DF398_01=0.6337890625, DF398_02=0.3427734375, DF398_03=0.25390625, DF398_04=0.310546875, DF398_05=0.5126953125, DF398_06=0.8271484375, DF398_07=0.8837890625, DF399_01=-665, DF399_02=29, DF399_03=672, DF399_04=-573, DF399_05=-211, DF399_06=312, DF399_07=317, DF405_01=0.00024936161935329437, DF405_02=0.0002511627972126007, DF405_03=-4.678964614868164e-05, DF405_04=-5.141831934452057e-05, DF405_05=1.1144205927848816e-05, DF405_06=2.15042382478714e-05, DF405_07=0.00047079287469387054, DF405_08=0.0004794951528310776, DF405_09=-0.0003879182040691376, DF405_10=-0.00037603825330734253, DF405_11=0.0002771839499473572, DF405_12=0.0002871435135602951, DF405_13=-0.00023611821234226227, DF406_01=0.00024937279522418976, DF406_02=0.00025077443569898605, DF406_03=-4.834495484828949e-05, DF406_04=-5.1246024668216705e-05, DF406_05=1.1149328202009201e-05, DF406_06=2.1803192794322968e-05, DF406_07=0.00047026341781020164, DF406_08=0.0004848274402320385, DF406_09=-0.0003876127302646637, DF406_10=-0.0003757951781153679, DF406_11=0.0002778824418783188, DF406_12=0.0002880701795220375, DF406_13=-0.00023698341101408005, DF407_01=341, DF407_02=341, DF407_03=340, DF407_04=340, DF407_05=341, DF407_06=341, DF407_07=340, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF407_12=341, DF407_13=340, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF420_13=0, DF408_01=47.0, DF408_02=40.0, DF408_03=47.0, DF408_04=42.0, DF408_05=47.0, DF408_06=39.0, DF408_07=36.0, DF408_08=33.0, DF408_09=48.0, DF408_10=43.0, DF408_11=48.0, DF408_12=40.0, DF408_13=41.0, DF404_01=-0.8193, DF404_02=-0.8173, DF404_03=0.8539, DF404_04=0.8501000000000001, DF404_05=0.7333000000000001, DF404_06=0.7311000000000001, DF404_07=-0.24930000000000002, DF404_08=-0.2543, DF404_09=-0.21580000000000002, DF404_10=-0.21780000000000002, DF404_11=0.3924, DF404_12=0.3947, DF404_13=0.6146)>",
            "<RTCM(1097, DF002=1097, DF003=0, DF248=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=216181732825628672, NSat=5, DF395=1073872896, NSig=2, DF396=1023, NCell=10, DF397_01=79, DF397_02=84, DF397_03=89, DF397_04=78, DF397_05=83, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, DF398_01=0.15625, DF398_02=0.2509765625, DF398_03=0.3544921875, DF398_04=0.37109375, DF398_05=0.259765625, DF399_01=-198, DF399_02=-516, DF399_03=423, DF399_04=63, DF399_05=-384, DF405_01=-4.5398250222206116e-05, DF405_02=-2.8252601623535156e-05, DF405_03=-0.00034597329795360565, DF405_04=-0.0003268253058195114, DF405_05=0.0004809703677892685, DF405_06=0.0005012489855289459, DF405_07=-0.00013696029782295227, DF405_08=-0.0001260414719581604, DF405_09=-1.8440186977386475e-05, DF405_10=-3.041699528694153e-06, DF406_01=-4.44464385509491e-05, DF406_02=-2.835458144545555e-05, DF406_03=-0.0003525479696691036, DF406_04=-0.0003263736143708229, DF406_05=0.00048203859478235245, DF406_06=0.0005008447915315628, DF406_07=-0.0001375703141093254, DF406_08=-0.00012635625898838043, DF406_09=-1.8037855625152588e-05, DF406_10=-3.2926909625530243e-06, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF408_01=46.0, DF408_02=49.0, DF408_03=41.0, DF408_04=43.0, DF408_05=43.0, DF408_06=43.0, DF408_07=45.0, DF408_08=49.0, DF408_09=43.0, DF408_10=47.0, DF404_01=-0.5806, DF404_02=-0.5831000000000001, DF404_03=-0.7947000000000001, DF404_04=-0.7943, DF404_05=0.7243, DF404_06=0.7174, DF404_07=0.5534, DF404_08=0.5545, DF404_09=-0.7726000000000001, DF404_10=-0.7733)>",
            "<RTCM(1127, DF002=1127, DF003=0, DF427=204123001, DF393=0, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=198178247981137920, NSat=10, DF395=1074003968, NSig=2, DF396=387754, NCell=11, DF397_01=129, DF397_02=132, DF397_03=126, DF397_04=75, DF397_05=81, DF397_06=84, DF397_07=78, DF397_08=74, DF397_09=130, DF397_10=86, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, ExtSatInfo_04=0, ExtSatInfo_05=0, ExtSatInfo_06=0, ExtSatInfo_07=0, ExtSatInfo_08=0, ExtSatInfo_09=0, ExtSatInfo_10=0, DF398_01=0.1171875, DF398_02=0.4814453125, DF398_03=0.3095703125, DF398_04=0.7255859375, DF398_05=0.41015625, DF398_06=0.5703125, DF398_07=0.5595703125, DF398_08=0.322265625, DF398_09=0.578125, DF398_10=0.673828125, DF399_01=-130, DF399_02=-58, DF399_03=-81, DF399_04=32, DF399_05=-398, DF399_06=436, DF399_07=-523, DF399_08=-65, DF399_09=-182, DF399_10=79, DF405_01=-0.0003885403275489807, DF405_02=0.00022730417549610138, DF405_03=0.0004036612808704376, DF405_04=0.00039606913924217224, DF405_05=-0.00016684085130691528, DF405_06=-4.75514680147171e-05, DF405_07=0.0003674682229757309, DF405_08=0.00026629865169525146, DF405_09=-0.0002502594143152237, DF405_10=-0.00011803768575191498, DF405_11=-0.0002937670797109604, DF406_01=-0.0003882073797285557, DF406_02=0.0002264929935336113, DF406_03=0.0004031979478895664, DF406_04=0.0003964221104979515, DF406_05=-0.00016694329679012299, DF406_06=-4.848744720220566e-05, DF406_07=0.00036971503868699074, DF406_08=0.0002654106356203556, DF406_09=-0.00025115441530942917, DF406_10=-0.00011868216097354889, DF406_11=-0.00029495684430003166, DF407_01=341, DF407_02=341, DF407_03=341, DF407_04=341, DF407_05=341, DF407_06=341, DF407_07=341, DF407_08=341, DF407_09=341, DF407_10=341, DF407_11=341, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF408_01=45.0, DF408_02=41.0, DF408_03=42.0, DF408_04=45.0, DF408_05=48.0, DF408_06=46.0, DF408_07=42.0, DF408_08=47.0, DF408_09=48.0, DF408_10=44.0, DF408_11=43.0, DF404_01=-0.5674, DF404_02=-0.612, DF404_03=-0.1384, DF404_04=-0.1332, DF404_05=0.5992000000000001, DF404_06=-0.7312000000000001, DF404_07=0.17320000000000002, DF404_08=-0.4308, DF404_09=-0.5975, DF404_10=-0.6733, DF404_11=0.6122000000000001)>",
            "<RTCM(1230, DF002=1230, DF003=0, DF421=1, DF001_3=0, DF422_1=0, DF422_2=0, DF422_3=0, DF422_4=0)>",
            "<RTCM(1007, DF002=1007, DF003=1234, DF029=3, DF030_01=A, DF030_02=B, DF030_03=C, DF031=234)>",
            "<RTCM(1117, DF002=1117, DF003=0, DF428=385820000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=7061644215716937728, NSat=3, DF395=1073774849, NSig=4, DF396=4095, NCell=12, DF397_01=140, DF397_02=112, DF397_03=133, ExtSatInfo_01=0, ExtSatInfo_02=0, ExtSatInfo_03=0, DF398_01=0.171875, DF398_02=0.125, DF398_03=0.8720703125, DF399_01=481, DF399_02=-28, DF399_03=1, DF405_01=0.00022634491324424744, DF405_02=0.00026302412152290344, DF405_03=0.0002453848719596863, DF405_04=0.00023026764392852783, DF405_05=-3.849714994430542e-05, DF405_06=-8.327886462211609e-06, DF405_07=-2.2586435079574585e-05, DF405_08=-3.288686275482178e-05, DF405_09=-9.805895388126373e-05, DF405_10=-7.162615656852722e-05, DF405_11=-8.577480912208557e-05, DF405_12=-9.572319686412811e-05, DF406_01=-0.000219784677028656, DF406_02=0.000500889029353857, DF406_03=-3.950204700231552e-06, DF406_04=0.0002219858579337597, DF406_05=0.0003901217132806778, DF406_06=-0.00017092609778046608, DF406_07=-0.0001668902114033699, DF406_08=-0.0001881415955722332, DF406_09=0.0002841702662408352, DF406_10=-0.0001959027722477913, DF406_11=0.00020570401102304459, DF406_12=0.00017753522843122482, DF407_01=516, DF407_02=462, DF407_03=684, DF407_04=365, DF407_05=648, DF407_06=649, DF407_07=649, DF407_08=649, DF407_09=568, DF407_10=704, DF407_11=704, DF407_12=704, DF420_01=0, DF420_02=0, DF420_03=0, DF420_04=0, DF420_05=0, DF420_06=0, DF420_07=0, DF420_08=0, DF420_09=0, DF420_10=0, DF420_11=0, DF420_12=0, DF408_01=30.3125, DF408_02=35.875, DF408_03=34.5, DF408_04=34.5, DF408_05=48.625, DF408_06=50.5, DF408_07=52.625, DF408_08=51.1875, DF408_09=38.3125, DF408_10=43.6875, DF408_11=45.8125, DF408_12=40.3125, DF404_01=-0.10640000000000001, DF404_02=-1.6384, DF404_03=-1.6384, DF404_04=-1.6384, DF404_05=-0.5875, DF404_06=-1.6384, DF404_07=-1.6384, DF404_08=-1.6384, DF404_09=-0.41300000000000003, DF404_10=-1.6384, DF404_11=-1.6384, DF404_12=-1.6384)>",
        )
        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-RTCM3.log"), "rb") as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(stream, scaling=True, labelmsm=False)
            for raw, parsed in rtr:
                if raw is not None:
                    # print(f'"{parsed}",')
                    self.assertEqual(str(parsed), EXPECTED_RESULTS[i])
                    i += 1

    def testMIXEDRTCM_SCALE_LABELMSM_RINEX(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with scaling and RINEX labelmsm applied
        EXPECTED_RESULTS = (
            "<RTCM(1005, DF002=1005, DF003=0, DF021=0, DF022=1, DF023=1, DF024=1, DF141=0, DF025=4444030.802800001, DF142=1, DF001_1=0, DF026=3085671.2349, DF364=0, DF027=3366658.256)>",
            "<RTCM(4072, DF002=4072, Not_Yet_Implemented)>",
            "<RTCM(1077, DF002=1077, DF003=0, DF004=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=760738918298550272, NSat=10, DF395=1073807360, NSig=2, DF396=1044459, NCell=17, DF397_01(005)=75, DF397_02(007)=75, DF397_03(009)=81, DF397_04(013)=72, DF397_05(014)=67, DF397_06(015)=80, DF397_07(017)=75, DF397_08(019)=82, DF397_09(020)=75, DF397_10(030)=71, ExtSatInfo_01(005)=0, ExtSatInfo_02(007)=0, ExtSatInfo_03(009)=0, ExtSatInfo_04(013)=0, ExtSatInfo_05(014)=0, ExtSatInfo_06(015)=0, ExtSatInfo_07(017)=0, ExtSatInfo_08(019)=0, ExtSatInfo_09(020)=0, ExtSatInfo_10(030)=0, DF398_01(005)=0.005859375, DF398_02(007)=0.5341796875, DF398_03(009)=0.7626953125, DF398_04(013)=0.138671875, DF398_05(014)=0.5498046875, DF398_06(015)=0.11328125, DF398_07(017)=0.8037109375, DF398_08(019)=0.1025390625, DF398_09(020)=0.521484375, DF398_10(030)=0.345703125, DF399_01(005)=-178, DF399_02(007)=-304, DF399_03(009)=-643, DF399_04(013)=477, DF399_05(014)=-52, DF399_06(015)=645, DF399_07(017)=529, DF399_08(019)=643, DF399_09(020)=-428, DF399_10(030)=-181, DF405_01(005,1C)=0.00014309026300907135, DF405_02(005,2L)=0.00014183297753334045, DF405_03(007,1C)=0.0003883279860019684, DF405_04(007,2L)=0.00038741156458854675, DF405_05(009,1C)=-0.0004838351160287857, DF405_06(009,2L)=-0.00046883709728717804, DF405_07(013,1C)=0.0003478657454252243, DF405_08(014,1C)=0.0002196934074163437, DF405_09(014,2L)=0.00021521002054214478, DF405_10(015,1C)=-0.00018852390348911285, DF405_11(015,2L)=-0.00018319115042686462, DF405_12(017,1C)=-0.00010087713599205017, DF405_13(017,2L)=-9.844452142715454e-05, DF405_14(019,1C)=0.00047875382006168365, DF405_15(020,1C)=0.00043664872646331787, DF405_16(030,1C)=-0.0003105681389570236, DF405_17(030,2L)=-0.00030865520238876343, DF406_01(005,1C)=0.00014193402603268623, DF406_02(005,2L)=0.00014339853078126907, DF406_03(007,1C)=0.00039040297269821167, DF406_04(007,2L)=0.00038743019104003906, DF406_05(009,1C)=-0.0004843934439122677, DF406_06(009,2L)=-0.00046825408935546875, DF406_07(013,1C)=0.0003473707474768162, DF406_08(014,1C)=0.00021758908405900002, DF406_09(014,2L)=0.00021597417071461678, DF406_10(015,1C)=-0.00018658116459846497, DF406_11(015,2L)=-0.00018350128084421158, DF406_12(017,1C)=-9.993184357881546e-05, DF406_13(017,2L)=-9.724870324134827e-05, DF406_14(019,1C)=0.0004128236323595047, DF406_15(020,1C)=0.0004355977289378643, DF406_16(030,1C)=-0.0003112703561782837, DF406_17(030,2L)=-0.00030898721888661385, DF407_01(005,1C)=341, DF407_02(005,2L)=341, DF407_03(007,1C)=341, DF407_04(007,2L)=341, DF407_05(009,1C)=341, DF407_06(009,2L)=341, DF407_07(013,1C)=341, DF407_08(014,1C)=341, DF407_09(014,2L)=341, DF407_10(015,1C)=341, DF407_11(015,2L)=341, DF407_12(017,1C)=341, DF407_13(017,2L)=341, DF407_14(019,1C)=295, DF407_15(020,1C)=341, DF407_16(030,1C)=341, DF407_17(030,2L)=341, DF420_01(005,1C)=0, DF420_02(005,2L)=0, DF420_03(007,1C)=0, DF420_04(007,2L)=0, DF420_05(009,1C)=0, DF420_06(009,2L)=0, DF420_07(013,1C)=0, DF420_08(014,1C)=0, DF420_09(014,2L)=0, DF420_10(015,1C)=0, DF420_11(015,2L)=0, DF420_12(017,1C)=0, DF420_13(017,2L)=0, DF420_14(019,1C)=0, DF420_15(020,1C)=0, DF420_16(030,1C)=0, DF420_17(030,2L)=0, DF408_01(005,1C)=45.0, DF408_02(005,2L)=38.0, DF408_03(007,1C)=43.0, DF408_04(007,2L)=39.0, DF408_05(009,1C)=39.0, DF408_06(009,2L)=37.0, DF408_07(013,1C)=45.0, DF408_08(014,1C)=46.0, DF408_09(014,2L)=46.0, DF408_10(015,1C)=39.0, DF408_11(015,2L)=34.0, DF408_12(017,1C)=45.0, DF408_13(017,2L)=38.0, DF408_14(019,1C)=31.0, DF408_15(020,1C)=45.0, DF408_16(030,1C)=46.0, DF408_17(030,2L)=41.0, DF404_01(005,1C)=-0.9231, DF404_02(005,2L)=-0.9194, DF404_03(007,1C)=-0.8321000000000001, DF404_04(007,2L)=-0.8326, DF404_05(009,1C)=-0.4107, DF404_06(009,2L)=-0.4072, DF404_07(013,1C)=0.2451, DF404_08(014,1C)=-0.0693, DF404_09(014,2L)=-0.0684, DF404_10(015,1C)=0.9390000000000001, DF404_11(015,2L)=0.9417000000000001, DF404_12(017,1C)=0.2384, DF404_13(017,2L)=0.2416, DF404_14(019,1C)=0.6636000000000001, DF404_15(020,1C)=-0.9556, DF404_16(030,1C)=-0.21480000000000002, DF404_17(030,2L)=-0.2174)>",
            "<RTCM(1087, DF002=1087, DF003=0, DF416=2, DF034=42119001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=4039168114821169152, NSat=7, DF395=1090519040, NSig=2, DF396=16382, NCell=13, DF397_01(003)=69, DF397_02(004)=64, DF397_03(005)=73, DF397_04(013)=76, DF397_05(014)=66, DF397_06(015)=70, DF397_07(023)=78, DF419_01(003)=12, DF419_02(004)=13, DF419_03(005)=8, DF419_04(013)=5, DF419_05(014)=0, DF419_06(015)=7, DF419_07(023)=10, DF398_01(003)=0.6337890625, DF398_02(004)=0.3427734375, DF398_03(005)=0.25390625, DF398_04(013)=0.310546875, DF398_05(014)=0.5126953125, DF398_06(015)=0.8271484375, DF398_07(023)=0.8837890625, DF399_01(003)=-665, DF399_02(004)=29, DF399_03(005)=672, DF399_04(013)=-573, DF399_05(014)=-211, DF399_06(015)=312, DF399_07(023)=317, DF405_01(003,1C)=0.00024936161935329437, DF405_02(003,2C)=0.0002511627972126007, DF405_03(004,1C)=-4.678964614868164e-05, DF405_04(004,2C)=-5.141831934452057e-05, DF405_05(005,1C)=1.1144205927848816e-05, DF405_06(005,2C)=2.15042382478714e-05, DF405_07(013,1C)=0.00047079287469387054, DF405_08(013,2C)=0.0004794951528310776, DF405_09(014,1C)=-0.0003879182040691376, DF405_10(014,2C)=-0.00037603825330734253, DF405_11(015,1C)=0.0002771839499473572, DF405_12(015,2C)=0.0002871435135602951, DF405_13(023,1C)=-0.00023611821234226227, DF406_01(003,1C)=0.00024937279522418976, DF406_02(003,2C)=0.00025077443569898605, DF406_03(004,1C)=-4.834495484828949e-05, DF406_04(004,2C)=-5.1246024668216705e-05, DF406_05(005,1C)=1.1149328202009201e-05, DF406_06(005,2C)=2.1803192794322968e-05, DF406_07(013,1C)=0.00047026341781020164, DF406_08(013,2C)=0.0004848274402320385, DF406_09(014,1C)=-0.0003876127302646637, DF406_10(014,2C)=-0.0003757951781153679, DF406_11(015,1C)=0.0002778824418783188, DF406_12(015,2C)=0.0002880701795220375, DF406_13(023,1C)=-0.00023698341101408005, DF407_01(003,1C)=341, DF407_02(003,2C)=341, DF407_03(004,1C)=340, DF407_04(004,2C)=340, DF407_05(005,1C)=341, DF407_06(005,2C)=341, DF407_07(013,1C)=340, DF407_08(013,2C)=341, DF407_09(014,1C)=341, DF407_10(014,2C)=341, DF407_11(015,1C)=341, DF407_12(015,2C)=341, DF407_13(023,1C)=340, DF420_01(003,1C)=0, DF420_02(003,2C)=0, DF420_03(004,1C)=0, DF420_04(004,2C)=0, DF420_05(005,1C)=0, DF420_06(005,2C)=0, DF420_07(013,1C)=0, DF420_08(013,2C)=0, DF420_09(014,1C)=0, DF420_10(014,2C)=0, DF420_11(015,1C)=0, DF420_12(015,2C)=0, DF420_13(023,1C)=0, DF408_01(003,1C)=47.0, DF408_02(003,2C)=40.0, DF408_03(004,1C)=47.0, DF408_04(004,2C)=42.0, DF408_05(005,1C)=47.0, DF408_06(005,2C)=39.0, DF408_07(013,1C)=36.0, DF408_08(013,2C)=33.0, DF408_09(014,1C)=48.0, DF408_10(014,2C)=43.0, DF408_11(015,1C)=48.0, DF408_12(015,2C)=40.0, DF408_13(023,1C)=41.0, DF404_01(003,1C)=-0.8193, DF404_02(003,2C)=-0.8173, DF404_03(004,1C)=0.8539, DF404_04(004,2C)=0.8501000000000001, DF404_05(005,1C)=0.7333000000000001, DF404_06(005,2C)=0.7311000000000001, DF404_07(013,1C)=-0.24930000000000002, DF404_08(013,2C)=-0.2543, DF404_09(014,1C)=-0.21580000000000002, DF404_10(014,2C)=-0.21780000000000002, DF404_11(015,1C)=0.3924, DF404_12(015,2C)=0.3947, DF404_13(023,1C)=0.6146)>",
            "<RTCM(1097, DF002=1097, DF003=0, DF248=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=216181732825628672, NSat=5, DF395=1073872896, NSig=2, DF396=1023, NCell=10, DF397_01(007)=79, DF397_02(008)=84, DF397_03(021)=89, DF397_04(027)=78, DF397_05(030)=83, ExtSatInfo_01(007)=0, ExtSatInfo_02(008)=0, ExtSatInfo_03(021)=0, ExtSatInfo_04(027)=0, ExtSatInfo_05(030)=0, DF398_01(007)=0.15625, DF398_02(008)=0.2509765625, DF398_03(021)=0.3544921875, DF398_04(027)=0.37109375, DF398_05(030)=0.259765625, DF399_01(007)=-198, DF399_02(008)=-516, DF399_03(021)=423, DF399_04(027)=63, DF399_05(030)=-384, DF405_01(007,1C)=-4.5398250222206116e-05, DF405_02(007,7Q)=-2.8252601623535156e-05, DF405_03(008,1C)=-0.00034597329795360565, DF405_04(008,7Q)=-0.0003268253058195114, DF405_05(021,1C)=0.0004809703677892685, DF405_06(021,7Q)=0.0005012489855289459, DF405_07(027,1C)=-0.00013696029782295227, DF405_08(027,7Q)=-0.0001260414719581604, DF405_09(030,1C)=-1.8440186977386475e-05, DF405_10(030,7Q)=-3.041699528694153e-06, DF406_01(007,1C)=-4.44464385509491e-05, DF406_02(007,7Q)=-2.835458144545555e-05, DF406_03(008,1C)=-0.0003525479696691036, DF406_04(008,7Q)=-0.0003263736143708229, DF406_05(021,1C)=0.00048203859478235245, DF406_06(021,7Q)=0.0005008447915315628, DF406_07(027,1C)=-0.0001375703141093254, DF406_08(027,7Q)=-0.00012635625898838043, DF406_09(030,1C)=-1.8037855625152588e-05, DF406_10(030,7Q)=-3.2926909625530243e-06, DF407_01(007,1C)=341, DF407_02(007,7Q)=341, DF407_03(008,1C)=341, DF407_04(008,7Q)=341, DF407_05(021,1C)=341, DF407_06(021,7Q)=341, DF407_07(027,1C)=341, DF407_08(027,7Q)=341, DF407_09(030,1C)=341, DF407_10(030,7Q)=341, DF420_01(007,1C)=0, DF420_02(007,7Q)=0, DF420_03(008,1C)=0, DF420_04(008,7Q)=0, DF420_05(021,1C)=0, DF420_06(021,7Q)=0, DF420_07(027,1C)=0, DF420_08(027,7Q)=0, DF420_09(030,1C)=0, DF420_10(030,7Q)=0, DF408_01(007,1C)=46.0, DF408_02(007,7Q)=49.0, DF408_03(008,1C)=41.0, DF408_04(008,7Q)=43.0, DF408_05(021,1C)=43.0, DF408_06(021,7Q)=43.0, DF408_07(027,1C)=45.0, DF408_08(027,7Q)=49.0, DF408_09(030,1C)=43.0, DF408_10(030,7Q)=47.0, DF404_01(007,1C)=-0.5806, DF404_02(007,7Q)=-0.5831000000000001, DF404_03(008,1C)=-0.7947000000000001, DF404_04(008,7Q)=-0.7943, DF404_05(021,1C)=0.7243, DF404_06(021,7Q)=0.7174, DF404_07(027,1C)=0.5534, DF404_08(027,7Q)=0.5545, DF404_09(030,1C)=-0.7726000000000001, DF404_10(030,7Q)=-0.7733)>",
            "<RTCM(1127, DF002=1127, DF003=0, DF427=204123001, DF393=0, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=198178247981137920, NSat=10, DF395=1074003968, NSig=2, DF396=387754, NCell=11, DF397_01(007)=129, DF397_02(009)=132, DF397_03(010)=126, DF397_04(020)=75, DF397_05(023)=81, DF397_06(028)=84, DF397_07(032)=78, DF397_08(037)=74, DF397_09(040)=130, DF397_10(043)=86, ExtSatInfo_01(007)=0, ExtSatInfo_02(009)=0, ExtSatInfo_03(010)=0, ExtSatInfo_04(020)=0, ExtSatInfo_05(023)=0, ExtSatInfo_06(028)=0, ExtSatInfo_07(032)=0, ExtSatInfo_08(037)=0, ExtSatInfo_09(040)=0, ExtSatInfo_10(043)=0, DF398_01(007)=0.1171875, DF398_02(009)=0.4814453125, DF398_03(010)=0.3095703125, DF398_04(020)=0.7255859375, DF398_05(023)=0.41015625, DF398_06(028)=0.5703125, DF398_07(032)=0.5595703125, DF398_08(037)=0.322265625, DF398_09(040)=0.578125, DF398_10(043)=0.673828125, DF399_01(007)=-130, DF399_02(009)=-58, DF399_03(010)=-81, DF399_04(020)=32, DF399_05(023)=-398, DF399_06(028)=436, DF399_07(032)=-523, DF399_08(037)=-65, DF399_09(040)=-182, DF399_10(043)=79, DF405_01(007,7I)=-0.0003885403275489807, DF405_02(009,7I)=0.00022730417549610138, DF405_03(010,2I)=0.0004036612808704376, DF405_04(010,7I)=0.00039606913924217224, DF405_05(020,2I)=-0.00016684085130691528, DF405_06(023,2I)=-4.75514680147171e-05, DF405_07(028,2I)=0.0003674682229757309, DF405_08(032,2I)=0.00026629865169525146, DF405_09(037,2I)=-0.0002502594143152237, DF405_10(040,2I)=-0.00011803768575191498, DF405_11(043,2I)=-0.0002937670797109604, DF406_01(007,7I)=-0.0003882073797285557, DF406_02(009,7I)=0.0002264929935336113, DF406_03(010,2I)=0.0004031979478895664, DF406_04(010,7I)=0.0003964221104979515, DF406_05(020,2I)=-0.00016694329679012299, DF406_06(023,2I)=-4.848744720220566e-05, DF406_07(028,2I)=0.00036971503868699074, DF406_08(032,2I)=0.0002654106356203556, DF406_09(037,2I)=-0.00025115441530942917, DF406_10(040,2I)=-0.00011868216097354889, DF406_11(043,2I)=-0.00029495684430003166, DF407_01(007,7I)=341, DF407_02(009,7I)=341, DF407_03(010,2I)=341, DF407_04(010,7I)=341, DF407_05(020,2I)=341, DF407_06(023,2I)=341, DF407_07(028,2I)=341, DF407_08(032,2I)=341, DF407_09(037,2I)=341, DF407_10(040,2I)=341, DF407_11(043,2I)=341, DF420_01(007,7I)=0, DF420_02(009,7I)=0, DF420_03(010,2I)=0, DF420_04(010,7I)=0, DF420_05(020,2I)=0, DF420_06(023,2I)=0, DF420_07(028,2I)=0, DF420_08(032,2I)=0, DF420_09(037,2I)=0, DF420_10(040,2I)=0, DF420_11(043,2I)=0, DF408_01(007,7I)=45.0, DF408_02(009,7I)=41.0, DF408_03(010,2I)=42.0, DF408_04(010,7I)=45.0, DF408_05(020,2I)=48.0, DF408_06(023,2I)=46.0, DF408_07(028,2I)=42.0, DF408_08(032,2I)=47.0, DF408_09(037,2I)=48.0, DF408_10(040,2I)=44.0, DF408_11(043,2I)=43.0, DF404_01(007,7I)=-0.5674, DF404_02(009,7I)=-0.612, DF404_03(010,2I)=-0.1384, DF404_04(010,7I)=-0.1332, DF404_05(020,2I)=0.5992000000000001, DF404_06(023,2I)=-0.7312000000000001, DF404_07(028,2I)=0.17320000000000002, DF404_08(032,2I)=-0.4308, DF404_09(037,2I)=-0.5975, DF404_10(040,2I)=-0.6733, DF404_11(043,2I)=0.6122000000000001)>",
            "<RTCM(1230, DF002=1230, DF003=0, DF421=1, DF001_3=0, DF422_1=0, DF422_2=0, DF422_3=0, DF422_4=0)>",
            "<RTCM(1007, DF002=1007, DF003=1234, DF029=3, DF030_01=A, DF030_02=B, DF030_03=C, DF031=234)>",
            "<RTCM(1117, DF002=1117, DF003=0, DF428=385820000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=7061644215716937728, NSat=3, DF395=1073774849, NSig=4, DF396=4095, NCell=12, DF397_01(194)=140, DF397_02(195)=112, DF397_03(199)=133, ExtSatInfo_01(194)=0, ExtSatInfo_02(195)=0, ExtSatInfo_03(199)=0, DF398_01(194)=0.171875, DF398_02(195)=0.125, DF398_03(199)=0.8720703125, DF399_01(194)=481, DF399_02(195)=-28, DF399_03(199)=1, DF405_01(194,1C)=0.00022634491324424744, DF405_02(194,2X)=0.00026302412152290344, DF405_03(194,5X)=0.0002453848719596863, DF405_04(194,1X)=0.00023026764392852783, DF405_05(195,1C)=-3.849714994430542e-05, DF405_06(195,2X)=-8.327886462211609e-06, DF405_07(195,5X)=-2.2586435079574585e-05, DF405_08(195,1X)=-3.288686275482178e-05, DF405_09(199,1C)=-9.805895388126373e-05, DF405_10(199,2X)=-7.162615656852722e-05, DF405_11(199,5X)=-8.577480912208557e-05, DF405_12(199,1X)=-9.572319686412811e-05, DF406_01(194,1C)=-0.000219784677028656, DF406_02(194,2X)=0.000500889029353857, DF406_03(194,5X)=-3.950204700231552e-06, DF406_04(194,1X)=0.0002219858579337597, DF406_05(195,1C)=0.0003901217132806778, DF406_06(195,2X)=-0.00017092609778046608, DF406_07(195,5X)=-0.0001668902114033699, DF406_08(195,1X)=-0.0001881415955722332, DF406_09(199,1C)=0.0002841702662408352, DF406_10(199,2X)=-0.0001959027722477913, DF406_11(199,5X)=0.00020570401102304459, DF406_12(199,1X)=0.00017753522843122482, DF407_01(194,1C)=516, DF407_02(194,2X)=462, DF407_03(194,5X)=684, DF407_04(194,1X)=365, DF407_05(195,1C)=648, DF407_06(195,2X)=649, DF407_07(195,5X)=649, DF407_08(195,1X)=649, DF407_09(199,1C)=568, DF407_10(199,2X)=704, DF407_11(199,5X)=704, DF407_12(199,1X)=704, DF420_01(194,1C)=0, DF420_02(194,2X)=0, DF420_03(194,5X)=0, DF420_04(194,1X)=0, DF420_05(195,1C)=0, DF420_06(195,2X)=0, DF420_07(195,5X)=0, DF420_08(195,1X)=0, DF420_09(199,1C)=0, DF420_10(199,2X)=0, DF420_11(199,5X)=0, DF420_12(199,1X)=0, DF408_01(194,1C)=30.3125, DF408_02(194,2X)=35.875, DF408_03(194,5X)=34.5, DF408_04(194,1X)=34.5, DF408_05(195,1C)=48.625, DF408_06(195,2X)=50.5, DF408_07(195,5X)=52.625, DF408_08(195,1X)=51.1875, DF408_09(199,1C)=38.3125, DF408_10(199,2X)=43.6875, DF408_11(199,5X)=45.8125, DF408_12(199,1X)=40.3125, DF404_01(194,1C)=-0.10640000000000001, DF404_02(194,2X)=-1.6384, DF404_03(194,5X)=-1.6384, DF404_04(194,1X)=-1.6384, DF404_05(195,1C)=-0.5875, DF404_06(195,2X)=-1.6384, DF404_07(195,5X)=-1.6384, DF404_08(195,1X)=-1.6384, DF404_09(199,1C)=-0.41300000000000003, DF404_10(199,2X)=-1.6384, DF404_11(199,5X)=-1.6384, DF404_12(199,1X)=-1.6384)>",
        )

        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-RTCM3.log"), "rb") as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(
                stream, scaling=True, labelmsm=True, quitonerror=rtt.ERR_RAISE
            )
            for raw, parsed in rtr:
                if raw is not None:
                    # print(f'"{parsed}",')
                    self.assertEqual(str(parsed), EXPECTED_RESULTS[i])
                    i += 1

    def testMIXEDRTCM_SCALE_LABELMSM_FREQ(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with scaling and Frequency Band labelmsm applied
        EXPECTED_RESULTS = (
            "<RTCM(1005, DF002=1005, DF003=0, DF021=0, DF022=1, DF023=1, DF024=1, DF141=0, DF025=4444030.802800001, DF142=1, DF001_1=0, DF026=3085671.2349, DF364=0, DF027=3366658.256)>",
            "<RTCM(4072, DF002=4072, Not_Yet_Implemented)>",
            "<RTCM(1077, DF002=1077, DF003=0, DF004=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=760738918298550272, NSat=10, DF395=1073807360, NSig=2, DF396=1044459, NCell=17, DF397_01(005)=75, DF397_02(007)=75, DF397_03(009)=81, DF397_04(013)=72, DF397_05(014)=67, DF397_06(015)=80, DF397_07(017)=75, DF397_08(019)=82, DF397_09(020)=75, DF397_10(030)=71, ExtSatInfo_01(005)=0, ExtSatInfo_02(007)=0, ExtSatInfo_03(009)=0, ExtSatInfo_04(013)=0, ExtSatInfo_05(014)=0, ExtSatInfo_06(015)=0, ExtSatInfo_07(017)=0, ExtSatInfo_08(019)=0, ExtSatInfo_09(020)=0, ExtSatInfo_10(030)=0, DF398_01(005)=0.005859375, DF398_02(007)=0.5341796875, DF398_03(009)=0.7626953125, DF398_04(013)=0.138671875, DF398_05(014)=0.5498046875, DF398_06(015)=0.11328125, DF398_07(017)=0.8037109375, DF398_08(019)=0.1025390625, DF398_09(020)=0.521484375, DF398_10(030)=0.345703125, DF399_01(005)=-178, DF399_02(007)=-304, DF399_03(009)=-643, DF399_04(013)=477, DF399_05(014)=-52, DF399_06(015)=645, DF399_07(017)=529, DF399_08(019)=643, DF399_09(020)=-428, DF399_10(030)=-181, DF405_01(005,L1)=0.00014309026300907135, DF405_02(005,L2)=0.00014183297753334045, DF405_03(007,L1)=0.0003883279860019684, DF405_04(007,L2)=0.00038741156458854675, DF405_05(009,L1)=-0.0004838351160287857, DF405_06(009,L2)=-0.00046883709728717804, DF405_07(013,L1)=0.0003478657454252243, DF405_08(014,L1)=0.0002196934074163437, DF405_09(014,L2)=0.00021521002054214478, DF405_10(015,L1)=-0.00018852390348911285, DF405_11(015,L2)=-0.00018319115042686462, DF405_12(017,L1)=-0.00010087713599205017, DF405_13(017,L2)=-9.844452142715454e-05, DF405_14(019,L1)=0.00047875382006168365, DF405_15(020,L1)=0.00043664872646331787, DF405_16(030,L1)=-0.0003105681389570236, DF405_17(030,L2)=-0.00030865520238876343, DF406_01(005,L1)=0.00014193402603268623, DF406_02(005,L2)=0.00014339853078126907, DF406_03(007,L1)=0.00039040297269821167, DF406_04(007,L2)=0.00038743019104003906, DF406_05(009,L1)=-0.0004843934439122677, DF406_06(009,L2)=-0.00046825408935546875, DF406_07(013,L1)=0.0003473707474768162, DF406_08(014,L1)=0.00021758908405900002, DF406_09(014,L2)=0.00021597417071461678, DF406_10(015,L1)=-0.00018658116459846497, DF406_11(015,L2)=-0.00018350128084421158, DF406_12(017,L1)=-9.993184357881546e-05, DF406_13(017,L2)=-9.724870324134827e-05, DF406_14(019,L1)=0.0004128236323595047, DF406_15(020,L1)=0.0004355977289378643, DF406_16(030,L1)=-0.0003112703561782837, DF406_17(030,L2)=-0.00030898721888661385, DF407_01(005,L1)=341, DF407_02(005,L2)=341, DF407_03(007,L1)=341, DF407_04(007,L2)=341, DF407_05(009,L1)=341, DF407_06(009,L2)=341, DF407_07(013,L1)=341, DF407_08(014,L1)=341, DF407_09(014,L2)=341, DF407_10(015,L1)=341, DF407_11(015,L2)=341, DF407_12(017,L1)=341, DF407_13(017,L2)=341, DF407_14(019,L1)=295, DF407_15(020,L1)=341, DF407_16(030,L1)=341, DF407_17(030,L2)=341, DF420_01(005,L1)=0, DF420_02(005,L2)=0, DF420_03(007,L1)=0, DF420_04(007,L2)=0, DF420_05(009,L1)=0, DF420_06(009,L2)=0, DF420_07(013,L1)=0, DF420_08(014,L1)=0, DF420_09(014,L2)=0, DF420_10(015,L1)=0, DF420_11(015,L2)=0, DF420_12(017,L1)=0, DF420_13(017,L2)=0, DF420_14(019,L1)=0, DF420_15(020,L1)=0, DF420_16(030,L1)=0, DF420_17(030,L2)=0, DF408_01(005,L1)=45.0, DF408_02(005,L2)=38.0, DF408_03(007,L1)=43.0, DF408_04(007,L2)=39.0, DF408_05(009,L1)=39.0, DF408_06(009,L2)=37.0, DF408_07(013,L1)=45.0, DF408_08(014,L1)=46.0, DF408_09(014,L2)=46.0, DF408_10(015,L1)=39.0, DF408_11(015,L2)=34.0, DF408_12(017,L1)=45.0, DF408_13(017,L2)=38.0, DF408_14(019,L1)=31.0, DF408_15(020,L1)=45.0, DF408_16(030,L1)=46.0, DF408_17(030,L2)=41.0, DF404_01(005,L1)=-0.9231, DF404_02(005,L2)=-0.9194, DF404_03(007,L1)=-0.8321000000000001, DF404_04(007,L2)=-0.8326, DF404_05(009,L1)=-0.4107, DF404_06(009,L2)=-0.4072, DF404_07(013,L1)=0.2451, DF404_08(014,L1)=-0.0693, DF404_09(014,L2)=-0.0684, DF404_10(015,L1)=0.9390000000000001, DF404_11(015,L2)=0.9417000000000001, DF404_12(017,L1)=0.2384, DF404_13(017,L2)=0.2416, DF404_14(019,L1)=0.6636000000000001, DF404_15(020,L1)=-0.9556, DF404_16(030,L1)=-0.21480000000000002, DF404_17(030,L2)=-0.2174)>",
            "<RTCM(1087, DF002=1087, DF003=0, DF416=2, DF034=42119001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=4039168114821169152, NSat=7, DF395=1090519040, NSig=2, DF396=16382, NCell=13, DF397_01(003)=69, DF397_02(004)=64, DF397_03(005)=73, DF397_04(013)=76, DF397_05(014)=66, DF397_06(015)=70, DF397_07(023)=78, DF419_01(003)=12, DF419_02(004)=13, DF419_03(005)=8, DF419_04(013)=5, DF419_05(014)=0, DF419_06(015)=7, DF419_07(023)=10, DF398_01(003)=0.6337890625, DF398_02(004)=0.3427734375, DF398_03(005)=0.25390625, DF398_04(013)=0.310546875, DF398_05(014)=0.5126953125, DF398_06(015)=0.8271484375, DF398_07(023)=0.8837890625, DF399_01(003)=-665, DF399_02(004)=29, DF399_03(005)=672, DF399_04(013)=-573, DF399_05(014)=-211, DF399_06(015)=312, DF399_07(023)=317, DF405_01(003,G1)=0.00024936161935329437, DF405_02(003,G2)=0.0002511627972126007, DF405_03(004,G1)=-4.678964614868164e-05, DF405_04(004,G2)=-5.141831934452057e-05, DF405_05(005,G1)=1.1144205927848816e-05, DF405_06(005,G2)=2.15042382478714e-05, DF405_07(013,G1)=0.00047079287469387054, DF405_08(013,G2)=0.0004794951528310776, DF405_09(014,G1)=-0.0003879182040691376, DF405_10(014,G2)=-0.00037603825330734253, DF405_11(015,G1)=0.0002771839499473572, DF405_12(015,G2)=0.0002871435135602951, DF405_13(023,G1)=-0.00023611821234226227, DF406_01(003,G1)=0.00024937279522418976, DF406_02(003,G2)=0.00025077443569898605, DF406_03(004,G1)=-4.834495484828949e-05, DF406_04(004,G2)=-5.1246024668216705e-05, DF406_05(005,G1)=1.1149328202009201e-05, DF406_06(005,G2)=2.1803192794322968e-05, DF406_07(013,G1)=0.00047026341781020164, DF406_08(013,G2)=0.0004848274402320385, DF406_09(014,G1)=-0.0003876127302646637, DF406_10(014,G2)=-0.0003757951781153679, DF406_11(015,G1)=0.0002778824418783188, DF406_12(015,G2)=0.0002880701795220375, DF406_13(023,G1)=-0.00023698341101408005, DF407_01(003,G1)=341, DF407_02(003,G2)=341, DF407_03(004,G1)=340, DF407_04(004,G2)=340, DF407_05(005,G1)=341, DF407_06(005,G2)=341, DF407_07(013,G1)=340, DF407_08(013,G2)=341, DF407_09(014,G1)=341, DF407_10(014,G2)=341, DF407_11(015,G1)=341, DF407_12(015,G2)=341, DF407_13(023,G1)=340, DF420_01(003,G1)=0, DF420_02(003,G2)=0, DF420_03(004,G1)=0, DF420_04(004,G2)=0, DF420_05(005,G1)=0, DF420_06(005,G2)=0, DF420_07(013,G1)=0, DF420_08(013,G2)=0, DF420_09(014,G1)=0, DF420_10(014,G2)=0, DF420_11(015,G1)=0, DF420_12(015,G2)=0, DF420_13(023,G1)=0, DF408_01(003,G1)=47.0, DF408_02(003,G2)=40.0, DF408_03(004,G1)=47.0, DF408_04(004,G2)=42.0, DF408_05(005,G1)=47.0, DF408_06(005,G2)=39.0, DF408_07(013,G1)=36.0, DF408_08(013,G2)=33.0, DF408_09(014,G1)=48.0, DF408_10(014,G2)=43.0, DF408_11(015,G1)=48.0, DF408_12(015,G2)=40.0, DF408_13(023,G1)=41.0, DF404_01(003,G1)=-0.8193, DF404_02(003,G2)=-0.8173, DF404_03(004,G1)=0.8539, DF404_04(004,G2)=0.8501000000000001, DF404_05(005,G1)=0.7333000000000001, DF404_06(005,G2)=0.7311000000000001, DF404_07(013,G1)=-0.24930000000000002, DF404_08(013,G2)=-0.2543, DF404_09(014,G1)=-0.21580000000000002, DF404_10(014,G2)=-0.21780000000000002, DF404_11(015,G1)=0.3924, DF404_12(015,G2)=0.3947, DF404_13(023,G1)=0.6146)>",
            "<RTCM(1097, DF002=1097, DF003=0, DF248=204137001, DF393=1, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=216181732825628672, NSat=5, DF395=1073872896, NSig=2, DF396=1023, NCell=10, DF397_01(007)=79, DF397_02(008)=84, DF397_03(021)=89, DF397_04(027)=78, DF397_05(030)=83, ExtSatInfo_01(007)=0, ExtSatInfo_02(008)=0, ExtSatInfo_03(021)=0, ExtSatInfo_04(027)=0, ExtSatInfo_05(030)=0, DF398_01(007)=0.15625, DF398_02(008)=0.2509765625, DF398_03(021)=0.3544921875, DF398_04(027)=0.37109375, DF398_05(030)=0.259765625, DF399_01(007)=-198, DF399_02(008)=-516, DF399_03(021)=423, DF399_04(027)=63, DF399_05(030)=-384, DF405_01(007,E1)=-4.5398250222206116e-05, DF405_02(007,E5B)=-2.8252601623535156e-05, DF405_03(008,E1)=-0.00034597329795360565, DF405_04(008,E5B)=-0.0003268253058195114, DF405_05(021,E1)=0.0004809703677892685, DF405_06(021,E5B)=0.0005012489855289459, DF405_07(027,E1)=-0.00013696029782295227, DF405_08(027,E5B)=-0.0001260414719581604, DF405_09(030,E1)=-1.8440186977386475e-05, DF405_10(030,E5B)=-3.041699528694153e-06, DF406_01(007,E1)=-4.44464385509491e-05, DF406_02(007,E5B)=-2.835458144545555e-05, DF406_03(008,E1)=-0.0003525479696691036, DF406_04(008,E5B)=-0.0003263736143708229, DF406_05(021,E1)=0.00048203859478235245, DF406_06(021,E5B)=0.0005008447915315628, DF406_07(027,E1)=-0.0001375703141093254, DF406_08(027,E5B)=-0.00012635625898838043, DF406_09(030,E1)=-1.8037855625152588e-05, DF406_10(030,E5B)=-3.2926909625530243e-06, DF407_01(007,E1)=341, DF407_02(007,E5B)=341, DF407_03(008,E1)=341, DF407_04(008,E5B)=341, DF407_05(021,E1)=341, DF407_06(021,E5B)=341, DF407_07(027,E1)=341, DF407_08(027,E5B)=341, DF407_09(030,E1)=341, DF407_10(030,E5B)=341, DF420_01(007,E1)=0, DF420_02(007,E5B)=0, DF420_03(008,E1)=0, DF420_04(008,E5B)=0, DF420_05(021,E1)=0, DF420_06(021,E5B)=0, DF420_07(027,E1)=0, DF420_08(027,E5B)=0, DF420_09(030,E1)=0, DF420_10(030,E5B)=0, DF408_01(007,E1)=46.0, DF408_02(007,E5B)=49.0, DF408_03(008,E1)=41.0, DF408_04(008,E5B)=43.0, DF408_05(021,E1)=43.0, DF408_06(021,E5B)=43.0, DF408_07(027,E1)=45.0, DF408_08(027,E5B)=49.0, DF408_09(030,E1)=43.0, DF408_10(030,E5B)=47.0, DF404_01(007,E1)=-0.5806, DF404_02(007,E5B)=-0.5831000000000001, DF404_03(008,E1)=-0.7947000000000001, DF404_04(008,E5B)=-0.7943, DF404_05(021,E1)=0.7243, DF404_06(021,E5B)=0.7174, DF404_07(027,E1)=0.5534, DF404_08(027,E5B)=0.5545, DF404_09(030,E1)=-0.7726000000000001, DF404_10(030,E5B)=-0.7733)>",
            "<RTCM(1127, DF002=1127, DF003=0, DF427=204123001, DF393=0, DF409=0, DF001_7=0, DF411=0, DF412=0, DF417=0, DF418=0, DF394=198178247981137920, NSat=10, DF395=1074003968, NSig=2, DF396=387754, NCell=11, DF397_01(007)=129, DF397_02(009)=132, DF397_03(010)=126, DF397_04(020)=75, DF397_05(023)=81, DF397_06(028)=84, DF397_07(032)=78, DF397_08(037)=74, DF397_09(040)=130, DF397_10(043)=86, ExtSatInfo_01(007)=0, ExtSatInfo_02(009)=0, ExtSatInfo_03(010)=0, ExtSatInfo_04(020)=0, ExtSatInfo_05(023)=0, ExtSatInfo_06(028)=0, ExtSatInfo_07(032)=0, ExtSatInfo_08(037)=0, ExtSatInfo_09(040)=0, ExtSatInfo_10(043)=0, DF398_01(007)=0.1171875, DF398_02(009)=0.4814453125, DF398_03(010)=0.3095703125, DF398_04(020)=0.7255859375, DF398_05(023)=0.41015625, DF398_06(028)=0.5703125, DF398_07(032)=0.5595703125, DF398_08(037)=0.322265625, DF398_09(040)=0.578125, DF398_10(043)=0.673828125, DF399_01(007)=-130, DF399_02(009)=-58, DF399_03(010)=-81, DF399_04(020)=32, DF399_05(023)=-398, DF399_06(028)=436, DF399_07(032)=-523, DF399_08(037)=-65, DF399_09(040)=-182, DF399_10(043)=79, DF405_01(007,B2)=-0.0003885403275489807, DF405_02(009,B2)=0.00022730417549610138, DF405_03(010,B1)=0.0004036612808704376, DF405_04(010,B2)=0.00039606913924217224, DF405_05(020,B1)=-0.00016684085130691528, DF405_06(023,B1)=-4.75514680147171e-05, DF405_07(028,B1)=0.0003674682229757309, DF405_08(032,B1)=0.00026629865169525146, DF405_09(037,B1)=-0.0002502594143152237, DF405_10(040,B1)=-0.00011803768575191498, DF405_11(043,B1)=-0.0002937670797109604, DF406_01(007,B2)=-0.0003882073797285557, DF406_02(009,B2)=0.0002264929935336113, DF406_03(010,B1)=0.0004031979478895664, DF406_04(010,B2)=0.0003964221104979515, DF406_05(020,B1)=-0.00016694329679012299, DF406_06(023,B1)=-4.848744720220566e-05, DF406_07(028,B1)=0.00036971503868699074, DF406_08(032,B1)=0.0002654106356203556, DF406_09(037,B1)=-0.00025115441530942917, DF406_10(040,B1)=-0.00011868216097354889, DF406_11(043,B1)=-0.00029495684430003166, DF407_01(007,B2)=341, DF407_02(009,B2)=341, DF407_03(010,B1)=341, DF407_04(010,B2)=341, DF407_05(020,B1)=341, DF407_06(023,B1)=341, DF407_07(028,B1)=341, DF407_08(032,B1)=341, DF407_09(037,B1)=341, DF407_10(040,B1)=341, DF407_11(043,B1)=341, DF420_01(007,B2)=0, DF420_02(009,B2)=0, DF420_03(010,B1)=0, DF420_04(010,B2)=0, DF420_05(020,B1)=0, DF420_06(023,B1)=0, DF420_07(028,B1)=0, DF420_08(032,B1)=0, DF420_09(037,B1)=0, DF420_10(040,B1)=0, DF420_11(043,B1)=0, DF408_01(007,B2)=45.0, DF408_02(009,B2)=41.0, DF408_03(010,B1)=42.0, DF408_04(010,B2)=45.0, DF408_05(020,B1)=48.0, DF408_06(023,B1)=46.0, DF408_07(028,B1)=42.0, DF408_08(032,B1)=47.0, DF408_09(037,B1)=48.0, DF408_10(040,B1)=44.0, DF408_11(043,B1)=43.0, DF404_01(007,B2)=-0.5674, DF404_02(009,B2)=-0.612, DF404_03(010,B1)=-0.1384, DF404_04(010,B2)=-0.1332, DF404_05(020,B1)=0.5992000000000001, DF404_06(023,B1)=-0.7312000000000001, DF404_07(028,B1)=0.17320000000000002, DF404_08(032,B1)=-0.4308, DF404_09(037,B1)=-0.5975, DF404_10(040,B1)=-0.6733, DF404_11(043,B1)=0.6122000000000001)>",
            "<RTCM(1230, DF002=1230, DF003=0, DF421=1, DF001_3=0, DF422_1=0, DF422_2=0, DF422_3=0, DF422_4=0)>",
            "<RTCM(1007, DF002=1007, DF003=1234, DF029=3, DF030_01=A, DF030_02=B, DF030_03=C, DF031=234)>",
            "<RTCM(1117, DF002=1117, DF003=0, DF428=385820000, DF393=1, DF409=0, DF001_7=0, DF411=1, DF412=0, DF417=0, DF418=0, DF394=7061644215716937728, NSat=3, DF395=1073774849, NSig=4, DF396=4095, NCell=12, DF397_01(194)=140, DF397_02(195)=112, DF397_03(199)=133, ExtSatInfo_01(194)=0, ExtSatInfo_02(195)=0, ExtSatInfo_03(199)=0, DF398_01(194)=0.171875, DF398_02(195)=0.125, DF398_03(199)=0.8720703125, DF399_01(194)=481, DF399_02(195)=-28, DF399_03(199)=1, DF405_01(194,L1)=0.00022634491324424744, DF405_02(194,L2)=0.00026302412152290344, DF405_03(194,L5)=0.0002453848719596863, DF405_04(194,L1)=0.00023026764392852783, DF405_05(195,L1)=-3.849714994430542e-05, DF405_06(195,L2)=-8.327886462211609e-06, DF405_07(195,L5)=-2.2586435079574585e-05, DF405_08(195,L1)=-3.288686275482178e-05, DF405_09(199,L1)=-9.805895388126373e-05, DF405_10(199,L2)=-7.162615656852722e-05, DF405_11(199,L5)=-8.577480912208557e-05, DF405_12(199,L1)=-9.572319686412811e-05, DF406_01(194,L1)=-0.000219784677028656, DF406_02(194,L2)=0.000500889029353857, DF406_03(194,L5)=-3.950204700231552e-06, DF406_04(194,L1)=0.0002219858579337597, DF406_05(195,L1)=0.0003901217132806778, DF406_06(195,L2)=-0.00017092609778046608, DF406_07(195,L5)=-0.0001668902114033699, DF406_08(195,L1)=-0.0001881415955722332, DF406_09(199,L1)=0.0002841702662408352, DF406_10(199,L2)=-0.0001959027722477913, DF406_11(199,L5)=0.00020570401102304459, DF406_12(199,L1)=0.00017753522843122482, DF407_01(194,L1)=516, DF407_02(194,L2)=462, DF407_03(194,L5)=684, DF407_04(194,L1)=365, DF407_05(195,L1)=648, DF407_06(195,L2)=649, DF407_07(195,L5)=649, DF407_08(195,L1)=649, DF407_09(199,L1)=568, DF407_10(199,L2)=704, DF407_11(199,L5)=704, DF407_12(199,L1)=704, DF420_01(194,L1)=0, DF420_02(194,L2)=0, DF420_03(194,L5)=0, DF420_04(194,L1)=0, DF420_05(195,L1)=0, DF420_06(195,L2)=0, DF420_07(195,L5)=0, DF420_08(195,L1)=0, DF420_09(199,L1)=0, DF420_10(199,L2)=0, DF420_11(199,L5)=0, DF420_12(199,L1)=0, DF408_01(194,L1)=30.3125, DF408_02(194,L2)=35.875, DF408_03(194,L5)=34.5, DF408_04(194,L1)=34.5, DF408_05(195,L1)=48.625, DF408_06(195,L2)=50.5, DF408_07(195,L5)=52.625, DF408_08(195,L1)=51.1875, DF408_09(199,L1)=38.3125, DF408_10(199,L2)=43.6875, DF408_11(199,L5)=45.8125, DF408_12(199,L1)=40.3125, DF404_01(194,L1)=-0.10640000000000001, DF404_02(194,L2)=-1.6384, DF404_03(194,L5)=-1.6384, DF404_04(194,L1)=-1.6384, DF404_05(195,L1)=-0.5875, DF404_06(195,L2)=-1.6384, DF404_07(195,L5)=-1.6384, DF404_08(195,L1)=-1.6384, DF404_09(199,L1)=-0.41300000000000003, DF404_10(199,L2)=-1.6384, DF404_11(199,L5)=-1.6384, DF404_12(199,L1)=-1.6384)>",
        )

        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-RTCM3.log"), "rb") as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(
                stream, scaling=True, labelmsm=2, quitonerror=rtt.ERR_RAISE
            )
            for raw, parsed in rtr:
                if raw is not None:
                    # print(f'"{parsed}",')
                    self.assertEqual(str(parsed), EXPECTED_RESULTS[i])
                    i += 1

    def testNTRIP(
        self,
    ):  # test NTRIP output stream
        EXPECTED_RESULTS = (
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
            "1085",
            "1125",
            "1095",
            "1230",
            "1006",
            "1008",
            "1033",
            "1230",
            "1075",
        )
        dirname = os.path.dirname(__file__)
        with open(os.path.join(dirname, "pygpsdata-NTRIP.log"), "rb") as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(stream, scaling=True, labelmsm=True)
            for raw, parsed in rtr:
                if raw is not None:
                    # print(parsed)
                    self.assertEqual(f"{parsed.identity}", EXPECTED_RESULTS[i])
                    i += 1

    def testSerialize(self):  # test serialize()
        payload = self._raw1005[3:-3]
        msg1 = RTCMReader.parse(self._raw1005)
        msg2 = RTCMMessage(payload=payload)
        res = msg1.serialize()
        self.assertEqual(res, self._raw1005)
        res1 = msg2.serialize()
        self.assertEqual(res, self._raw1005)

    def testsetattr(self):  # test immutability
        EXPECTED_ERROR = (
            "Object is immutable. Updates to DF002 not permitted after initialisation."
        )
        with self.assertRaisesRegex(RTCMMessageError, EXPECTED_ERROR):
            msg = RTCMReader.parse(self._raw1005)
            msg.DF002 = 9999

    def testrepr(self):  # test repr, check eval recreates original object
        EXPECTED_RESULT = "RTCMMessage(payload=b'>\\xd0\\x00\\x03\\x8aX\\xd9I<\\x87/4\\x10\\x9d\\x07\\xd6\\xafH ')"
        msg1 = RTCMReader.parse(self._raw1005)
        self.assertEqual(repr(msg1), EXPECTED_RESULT)
        msg2 = eval(repr(msg1))
        self.assertEqual(str(msg1), str(msg2))

    def testpayload(self):  # test payload getter
        msg = RTCMReader.parse(self._raw1005)
        payload = self._raw1005[3:-3]
        self.assertEqual(msg.payload, payload)

    def testnopayload(self):  # test null payload
        EXPECTED_ERROR = "Payload must be specified"
        with self.assertRaisesRegex(RTCMMessageError, EXPECTED_ERROR):
            msg = RTCMMessage()

    def testgroups(self):  # test message with repeating group (1007)
        EXPECTED_RESULT = "<RTCM(1007, DF002=1007, DF003=1234, DF029=3, DF030_01=A, DF030_02=B, DF030_03=C, DF031=234)>"
        msg1 = RTCMMessage(payload=self._payload1007)
        msg2 = RTCMReader.parse(self._raw1007)
        self.assertEqual(str(msg1), EXPECTED_RESULT)
        self.assertEqual(str(msg2), EXPECTED_RESULT)

    def testnestedgroups(self):  # test message with nested repeating group (1059, 1065)
        EXPECTED_RESULT = "<RTCM(1065, DF002=1065, DF386=12345, DF391=3, DF388=0, DF413=1, DF414=1, DF415=1, DF387=2, DF384_01=23, DF379_01=2, DF381_01_01=4, DF383_01_01=0.07, DF381_01_02=2, DF383_01_02=0.09, DF384_02=26, DF379_02=1, DF381_02_01=3, DF383_02_01=0.05)>"
        msg = RTCMReader.parse(self._raw1065, scaling=True)
        self.assertEqual(str(msg), EXPECTED_RESULT)

    def testbadCRC(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with invalid RTCM CRC
        EXPECTED_ERROR = "RTCM3 message invalid - failed CRC: (.*)"
        dirname = os.path.dirname(__file__)
        with open(
            os.path.join(dirname, "pygpsdata-MIXED-RTCM3BADCRC.log"), "rb"
        ) as stream:
            i = 0
            raw = 0
            rtr = RTCMReader(stream, quitonerror=rtt.ERR_RAISE)
            with self.assertRaisesRegex(RTCMParseError, EXPECTED_ERROR):
                for raw, parsed in rtr:
                    if raw is not None:
                        print(parsed)
                        i += 1

    def testbadCRC2(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with invalid RTCM CRC
        EXPECTED_ERROR = "I ignored the following error: RTCM3 message invalid - failed CRC: b'Z\\xd7\\xf7'"
        dirname = os.path.dirname(__file__)
        with open(
            os.path.join(dirname, "pygpsdata-MIXED-RTCM3BADCRC.log"), "rb"
        ) as stream:
            self.catchio()
            rtr = RTCMReader(
                stream,
                quitonerror=rtt.ERR_LOG,
                errorhandler=lambda e: print(f"I ignored the following error: {e}"),
            )
            for raw, parsed in rtr:
                if raw is not None:
                    pass
            stream.close()
            output = self.restoreio()
            self.assertEqual(output, EXPECTED_ERROR)

    def testbadCRC3(
        self,
    ):  # test mixed stream of NMEA, UBX & RTCM messages with invalid RTCM CRC
        EXPECTED_ERROR = "RTCM3 message invalid - failed CRC: b'Z\\xd7\\xf7'"
        dirname = os.path.dirname(__file__)
        with open(
            os.path.join(dirname, "pygpsdata-MIXED-RTCM3BADCRC.log"), "rb"
        ) as stream:
            self.catchio()
            rtr = RTCMReader(
                stream,
                quitonerror=rtt.ERR_LOG,
                errorhandler=None,
            )
            for raw, parsed in rtr:
                if raw is not None:
                    pass
            stream.close()
            output = self.restoreio()
            self.assertEqual(output, EXPECTED_ERROR)


if __name__ == "__main__":
    # import sys;sys.argv = ['', 'Test.testName']
    unittest.main()
