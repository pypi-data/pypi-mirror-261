#
# author: Jungtaek Kim (jtkim@postech.ac.kr)
# last updated: December 20, 2022
#

import numpy as np
import pytest

from bayeso_benchmarks.inf_dim_rastrigin import *

class_fun = Rastrigin
str_name = 'rastrigin'

TEST_EPSILON = 1e-5
SCALE_NOISE = 2.0
SEED = 42


def test_init():
    obj_fun = class_fun(16)

    with pytest.raises(AssertionError) as error:
        class_fun(1.0)
    with pytest.raises(AssertionError) as error:
        class_fun('abc')
    with pytest.raises(AssertionError) as error:
        class_fun(4, seed=1.0)
    with pytest.raises(AssertionError) as error:
        class_fun(4, seed='abc')

def test_validate_properties():
    obj_fun = class_fun(8)
    obj_fun.validate_properties()

def test_output():
    obj_fun = class_fun(4)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [28.92471373],
        [0.00000000],
        [28.92471373],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
    ])
    outputs = obj_fun.output(grids)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_call():
    obj_fun = class_fun(6)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [28.92471373],
        [0.00000000],
        [28.92471373],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
    ])
    outputs = obj_fun(grids)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_constant_noise():
    obj_fun = class_fun(2)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [59.84942745],
        [30.92471373],
        [59.84942745],
        [30.92471373],
        [2.0],
        [30.92471373],
        [59.84942745],
        [30.92471373],
        [59.84942745],
    ])

    print(grids)
    print(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE))
    print(np.abs(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE) - truths_grids) < TEST_EPSILON + SCALE_NOISE)
    assert np.all(np.abs(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE) - truths_grids) < TEST_EPSILON + SCALE_NOISE)

def test_output_gaussian_noise():
    obj_fun = class_fun(4, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [116.69228321],
        [86.49761258],
        [116.99423198],
        [89.82020089],
        [57.38112070],
        [86.30586726],
        [118.85728053],
        [88.30901064],
        [114.75990613],
        [87.85926126],
        [56.92259207],
        [85.84268167],
        [58.33335199],
        [25.09815324],
        [54.39959179],
        [85.64956612],
        [55.82376521],
        [87.40263584],
        [113.88280675],
        [83.94953377],
        [118.63015244],
        [86.32258858],
        [57.98448386],
        [83.92464480],
        [114.61008945],
        [86.99598636],
        [113.39686775],
        [87.52553721],
        [56.64815007],
        [86.19075368],
        [56.64601423],
        [32.62927009],
        [57.82243300],
        [84.65871932],
        [59.49451728],
        [84.33245388],
        [58.26715464],
        [25.00537348],
        [55.19305535],
        [29.31843620],
        [1.47693316],
        [29.26745029],
        [57.61813089],
        [28.32250633],
        [54.89238347],
        [85.33445276],
        [56.92814991],
        [88.88838563],
        [58.53666403],
        [25.39863342],
        [58.49759539],
        [86.00397662],
        [56.49558345],
        [87.99749376],
        [117.76085395],
        [88.63670142],
        [114.02041986],
        [86.15571643],
        [58.51195431],
        [88.72523143],
        [114.74050643],
        [86.40282322],
        [113.48618496],
        [84.38172793],
        [59.47447910],
        [89.48662123],
        [57.70540721],
        [30.93177952],
        [58.57269950],
        [85.48390167],
        [58.57221866],
        [89.85021431],
        [115.62720282],
        [89.90342849],
        [110.45936469],
        [88.41794619],
        [58.02352159],
        [86.17612648],
        [115.88237646],
        [82.79900335],
        [115.25951113],
    ])
    outputs = obj_fun.output_gaussian_noise(grids, scale_noise=SCALE_NOISE)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_sparse_gaussian_noise():
    obj_fun = class_fun(6, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [174.54171066],
        [144.62356863],
        [174.84365943],
        [144.62356863],
        [115.23054815],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [172.60933358],
        [145.70868872],
        [114.77201952],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [113.67319266],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.17201603],
        [115.83391131],
        [144.62356863],
        [172.45951691],
        [144.62356863],
        [171.24629520],
        [144.62356863],
        [114.49757752],
        [144.62356863],
        [115.69885490],
        [90.47869755],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [82.85480093],
        [113.04248281],
        [87.16786365],
        [57.84942745],
        [87.11687774],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [114.77757736],
        [146.73781308],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [114.34501090],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [171.86984731],
        [144.62356863],
        [115.69885490],
        [146.57465888],
        [173.54828235],
        [144.25225068],
        [173.54828235],
        [144.62356863],
        [117.32390655],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.47663028],
        [144.62356863],
        [168.30879215],
        [144.62356863],
        [115.69885490],
        [144.02555393],
        [173.54828235],
        [144.62356863],
        [173.10893858],
        [144.62356863],
        [115.69885490],
        [143.58702819],
        [115.69885490],
        [85.77062709],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.06521115],
        [86.77414118],
        [116.29109546],
        [87.29625172],
        [115.70908182],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.01342587],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [111.86131247],
        [86.72111343],
        [57.84942745],
        [91.70062540],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [54.74810059],
        [86.91126713],
        [115.69885490],
        [87.72132604],
        [113.86000643],
        [147.72343744],
        [114.13234832],
        [143.97944560],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [112.48388843],
        [144.62356863],
        [115.69885490],
        [88.33778692],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [87.46703760],
        [115.69885490],
        [145.08807602],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [113.31624791],
        [145.93667585],
        [113.74949156],
        [146.19773784],
        [173.54828235],
        [144.62356863],
        [175.47503461],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [143.11609630],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [145.30587258],
        [115.69885490],
        [88.42850768],
        [115.72485869],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [174.79961705],
        [144.62356863],
        [171.40649736],
        [145.58851346],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [114.80582500],
        [144.62356863],
        [115.69885490],
        [84.28266362],
        [115.69885490],
        [144.62356863],
        [113.93114003],
        [144.93101884],
        [115.69885490],
        [84.48820058],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [116.72895028],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [120.32817204],
        [144.62356863],
        [173.54828235],
        [141.39813689],
        [173.54828235],
        [146.80146982],
        [115.69885490],
        [144.62356863],
        [114.26824748],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.78999858],
        [143.32036793],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.99647726],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.39409575],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [119.22976338],
        [144.62356863],
        [115.69885490],
        [146.45929252],
        [115.69885490],
        [86.77414118],
        [112.66011497],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [116.58649376],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [142.57479335],
        [115.69885490],
        [84.27857481],
        [118.96367751],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [118.02518241],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [116.09697429],
        [86.77414118],
        [115.69885490],
        [86.00351398],
        [58.07646214],
        [86.77414118],
        [57.84942745],
        [26.44908273],
        [57.84942745],
        [82.86996558],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [85.78813931],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [85.38832199],
        [117.49805465],
        [145.23816767],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [145.84430916],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.41406505],
        [88.97169488],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [117.06276085],
        [144.00303512],
        [115.69885490],
        [86.77414118],
        [115.89284683],
        [144.62356863],
        [114.06241354],
        [144.62356863],
        [113.68682014],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [59.09766709],
        [88.03083220],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [85.41981775],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.28194204],
        [57.84942745],
        [85.64669207],
        [56.20498666],
        [86.77414118],
        [116.18878805],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [83.95921363],
        [115.69885490],
        [86.77414118],
        [116.32067003],
        [86.77414118],
        [59.56474670],
        [86.45426412],
        [57.84942745],
        [26.91965500],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [85.11967929],
        [58.88812048],
        [31.99019155],
        [57.84942745],
        [28.92471373],
        [1.38028798],
        [28.92471373],
        [58.29761242],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [28.92471373],
        [62.15579237],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [53.60163600],
        [85.72263113],
        [114.18058958],
        [87.07492875],
        [115.69885490],
        [90.52648286],
        [57.84942745],
        [86.77414118],
        [56.05259811],
        [28.92471373],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [112.27258584],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [54.66057213],
        [86.77414118],
        [115.70934230],
        [86.86810236],
        [114.79872396],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [147.17892227],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [115.20092661],
        [144.62356863],
        [115.69885490],
        [147.36083174],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [141.10608966],
        [115.69885490],
        [144.62356863],
        [115.16004123],
        [88.20922569],
        [115.69885490],
        [86.92233074],
        [57.84942745],
        [86.77414118],
        [112.29209002],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [55.24048845],
        [28.92471373],
        [57.84942745],
        [84.89438160],
        [57.84942745],
        [86.77414118],
        [115.69885490],
        [88.68442582],
        [115.69885490],
        [86.77414118],
        [56.78891221],
        [85.18839551],
        [115.48479418],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.69409573],
        [115.69885490],
        [86.77414118],
        [115.47419880],
        [144.18162943],
        [116.92718830],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [118.98879033],
        [86.27606910],
        [116.85196883],
        [145.24606894],
        [115.69885490],
        [144.62356863],
        [115.44301972],
        [84.86306030],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [172.25513659],
        [142.46047262],
        [173.54828235],
        [144.62356863],
        [115.68290962],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [113.94761840],
        [84.00854172],
        [115.69885490],
        [144.62356863],
        [112.90171976],
        [144.62356863],
        [173.54828235],
        [143.64931786],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [142.96166840],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.89751951],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [114.37360739],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [54.59434258],
        [86.77414118],
        [115.69885490],
        [84.96550793],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [143.02977812],
        [173.54828235],
        [144.21747786],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [116.37406023],
        [144.62356863],
        [114.72364245],
        [143.75845225],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [169.47203328],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [88.31587157],
        [112.74168241],
        [89.06164926],
        [57.84942745],
        [86.77414118],
        [116.96441864],
        [86.77414118],
        [116.06258741],
        [144.62356863],
        [115.69885490],
        [142.92387989],
        [115.69885490],
        [85.06197353],
        [115.84198738],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [84.81661375],
        [57.84942745],
        [87.52874216],
        [117.21283214],
        [86.77414118],
        [117.43806674],
        [86.77414118],
        [57.84942745],
        [90.52773280],
        [57.84942745],
        [26.43540432],
        [57.84942745],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [116.25879216],
        [86.77414118],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [86.77414118],
        [116.66087337],
        [87.22190923],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [85.75170982],
        [115.69885490],
        [144.37199479],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [89.83324182],
        [115.69885490],
        [86.77414118],
        [57.84942745],
        [83.46442783],
        [115.69885490],
        [86.77414118],
        [113.11893310],
        [142.03341108],
        [115.02728550],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.20736877],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [146.01598136],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.57614094],
        [144.57531845],
        [115.69885490],
        [144.62356863],
        [114.55153089],
        [85.68042329],
        [115.63334836],
        [144.62356863],
        [114.27316334],
        [144.62356863],
        [173.03832792],
        [144.62356863],
        [168.24634274],
        [144.62356863],
        [118.19102529],
        [144.62356863],
        [172.86290717],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [88.20013804],
        [115.69885490],
        [86.77414118],
        [59.27134739],
        [86.77414118],
        [114.97692257],
        [86.77414118],
        [113.53672825],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.69885490],
        [86.77414118],
        [115.69885490],
        [144.25376436],
        [115.69885490],
        [146.72158708],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [169.38442354],
        [144.62356863],
        [173.97031729],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [115.62358550],
        [86.77414118],
        [115.92731020],
        [144.62356863],
        [114.97163048],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [115.69885490],
        [144.62356863],
        [173.54828235],
        [144.62356863],
        [173.54828235],
    ])
    outputs = obj_fun.output_sparse_gaussian_noise(grids, scale_noise=SCALE_NOISE, sparsity=0.3)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_student_t_noise():
    obj_fun = class_fun(1, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [30.07394833],
        [-2.16338047],
        [31.56283076],
    ])
    outputs = obj_fun.output_student_t_noise(grids, scale_noise=SCALE_NOISE, dof=4.0)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_sparse_student_t_noise():
    obj_fun = class_fun(2, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [58.99866205],
        [26.76133325],
        [57.84942745],
        [28.92471373],
        [0.0],
        [28.92471373],
        [53.92113501],
        [28.92471373],
        [57.84942745],
    ])
    outputs = obj_fun.output_sparse_student_t_noise(grids, scale_noise=SCALE_NOISE, dof=4.0, sparsity=0.3)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_name():
    obj_fun = class_fun(2)
    assert obj_fun.name == str_name + '_2'

    obj_fun = class_fun(4)
    assert obj_fun.name == str_name + '_4'

    obj_fun = class_fun(16)
    assert obj_fun.name == str_name + '_16'

    assert obj_fun.__class__.__name__.lower() == str_name
    assert obj_fun.__class__.__qualname__.lower() == str_name
