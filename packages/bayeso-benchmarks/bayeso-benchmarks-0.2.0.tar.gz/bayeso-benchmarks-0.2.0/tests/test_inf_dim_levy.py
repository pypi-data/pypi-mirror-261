#
# author: Jungtaek Kim (jtkim@postech.ac.kr)
# last updated: December 29, 2022
#

import numpy as np
import pytest

from bayeso_benchmarks.inf_dim_levy import *

class_fun = Levy
str_name = 'levy'

TEST_EPSILON = 1e-5
SCALE_NOISE = 2.0
SEED = 42


def test_init():
    obj_fun = class_fun(16)

    with pytest.raises(AssertionError) as error:
        class_fun(1.0)
    with pytest.raises(AssertionError) as error:
        class_fun('abc')
    with pytest.raises(AssertionError) as error:
        class_fun(4, seed=1.0)
    with pytest.raises(AssertionError) as error:
        class_fun(4, seed='abc')

def test_validate_properties():
    obj_fun = class_fun(8)
    obj_fun.validate_properties()

def test_output():
    obj_fun = class_fun(4)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [254.89842686],
        [239.89842686],
        [249.89842686],
        [175.23146246],
        [160.23146246],
        [170.23146246],
        [228.53220902],
        [213.53220902],
        [223.53220902],
        [175.23146246],
        [160.23146246],
        [170.23146246],
        [95.56449806],
        [80.56449806],
        [90.56449806],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [228.53220902],
        [213.53220902],
        [223.53220902],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [202.16599118],
        [187.16599118],
        [197.16599118],
        [175.23146246],
        [160.23146246],
        [170.23146246],
        [95.56449806],
        [80.56449806],
        [90.56449806],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [95.56449806],
        [80.56449806],
        [90.56449806],
        [15.89753366],
        [0.89753366],
        [10.89753366],
        [69.19828022],
        [54.19828022],
        [64.19828022],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [69.19828022],
        [54.19828022],
        [64.19828022],
        [122.49902679],
        [107.49902679],
        [117.49902679],
        [228.53220902],
        [213.53220902],
        [223.53220902],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [202.16599118],
        [187.16599118],
        [197.16599118],
        [148.86524462],
        [133.86524462],
        [143.86524462],
        [69.19828022],
        [54.19828022],
        [64.19828022],
        [122.49902679],
        [107.49902679],
        [117.49902679],
        [202.16599118],
        [187.16599118],
        [197.16599118],
        [122.49902679],
        [107.49902679],
        [117.49902679],
        [175.79977335],
        [160.79977335],
        [170.79977335],
    ])
    outputs = obj_fun.output(grids)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_call():
    obj_fun = class_fun(6)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [414.41404476],
        [399.41404476],
        [409.41404476],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [16.07922277],
        [1.07922277],
        [11.07922277],
        [69.37996933],
        [54.37996933],
        [64.37996933],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [69.37996933],
        [54.37996933],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [69.37996933],
        [54.37996933],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [69.37996933],
        [54.37996933],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [69.37996933],
        [54.37996933],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [282.58295558],
        [267.58295558],
        [277.58295558],
    ])
    outputs = obj_fun(grids)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_constant_noise():
    obj_fun = class_fun(2)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [97.38280895],
        [17.71584455],
        [71.01659112],
        [82.38280895],
        [2.71584455],
        [56.01659112],
        [92.38280895],
        [12.71584455],
        [66.01659112],
    ])

    print(grids)
    print(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE))
    print(np.abs(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE) - truths_grids) < TEST_EPSILON + SCALE_NOISE)
    assert np.all(np.abs(obj_fun.output_constant_noise(grids, scale_noise=SCALE_NOISE) - truths_grids) < TEST_EPSILON + SCALE_NOISE)

def test_output_gaussian_noise():
    obj_fun = class_fun(4, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [255.89185516],
        [239.62189825],
        [251.19380393],
        [178.27752217],
        [159.76315571],
        [169.76318854],
        [231.69063465],
        [215.06707848],
        [222.59326025],
        [176.31658254],
        [159.30462707],
        [169.30000295],
        [96.0484226],
        [76.73793757],
        [87.1146624],
        [147.74066956],
        [131.83958238],
        [144.49373929],
        [226.71616087],
        [210.70760162],
        [226.46350656],
        [148.41369202],
        [134.00030103],
        [141.01574825],
        [201.07722574],
        [187.38783636],
        [194.86400403],
        [175.98285849],
        [159.03018508],
        [169.64807496],
        [94.36108484],
        [84.26905443],
        [90.53750361],
        [146.74982276],
        [135.51033445],
        [141.42355732],
        [95.98222525],
        [76.64515781],
        [87.90812596],
        [16.29125613],
        [2.37446682],
        [11.24027022],
        [68.96698366],
        [53.59607283],
        [61.24123624],
        [147.42555621],
        [132.94396708],
        [145.97948907],
        [69.8855168],
        [50.67219991],
        [64.84644816],
        [121.72886223],
        [106.14518279],
        [118.72237936],
        [230.59420807],
        [215.39476926],
        [221.85377397],
        [148.24681987],
        [134.52777149],
        [145.81633488],
        [201.20764271],
        [186.79467323],
        [194.95332124],
        [146.47283137],
        [135.49029627],
        [146.57772468],
        [69.05425998],
        [56.20534602],
        [64.92155227],
        [121.20878728],
        [108.221818],
        [120.57509992],
        [202.09433911],
        [190.2952785],
        [191.92650098],
        [124.1428318],
        [107.67312092],
        [116.90101209],
        [175.9832949],
        [156.82463552],
        [170.36042957],
    ])
    outputs = obj_fun.output_gaussian_noise(grids, scale_noise=SCALE_NOISE)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_sparse_gaussian_noise():
    obj_fun = class_fun(6, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [415.40747307],
        [399.41404476],
        [410.70942184],
        [334.74708036],
        [319.27877361],
        [329.74708036],
        [388.04782692],
        [373.04782692],
        [382.10887815],
        [335.83220045],
        [318.82024498],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [308.38086253],
        [291.35520029],
        [303.38086253],
        [388.04782692],
        [373.04782692],
        [383.04782692],
        [307.92930993],
        [293.51591894],
        [303.38086253],
        [360.59284364],
        [346.68160909],
        [354.37962193],
        [334.74708036],
        [318.54580298],
        [329.74708036],
        [255.08011596],
        [243.78467233],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [255.08011596],
        [236.16077572],
        [247.42374387],
        [175.80687404],
        [160.41315157],
        [170.75588813],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [308.38086253],
        [292.45958498],
        [305.49510698],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [265.66080069],
        [277.01464469],
        [388.04782692],
        [373.04782692],
        [381.36939188],
        [308.38086253],
        [293.38086253],
        [305.33195278],
        [361.68160909],
        [346.31029114],
        [356.68160909],
        [308.38086253],
        [295.00591417],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [361.60995701],
        [346.68160909],
        [351.44211888],
        [282.01464469],
        [267.01464469],
        [276.41662999],
        [335.31539125],
        [320.31539125],
        [329.87604748],
        [334.74708036],
        [319.74708036],
        [328.71053992],
        [255.08011596],
        [239.07660188],
        [250.08011596],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [255.08011596],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [159.62893526],
        [170.41315157],
        [229.30613868],
        [214.23600867],
        [223.72412504],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.0284691],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [255.08011596],
        [240.08011596],
        [246.24257353],
        [175.36012382],
        [160.41315157],
        [175.33963579],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.74618717],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [130.94560687],
        [144.18405968],
        [202.34768029],
        [188.29486515],
        [195.50883182],
        [311.48073134],
        [291.81435594],
        [302.73673949],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [263.79967822],
        [277.01464469],
        [228.71389813],
        [215.27754387],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [188.04057671],
        [197.34768029],
        [282.47915209],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [194.9650733],
        [256.96153407],
        [238.69906352],
        [252.22259606],
        [388.04782692],
        [373.04782692],
        [384.97457918],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [361.68160909],
        [345.17413676],
        [356.68160909],
        [308.38086253],
        [293.38086253],
        [304.06316648],
        [228.71389813],
        [215.36826463],
        [223.73990191],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [362.93294378],
        [346.68160909],
        [354.53982409],
        [282.97958952],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [308.38086253],
        [292.48783262],
        [303.38086253],
        [228.71389813],
        [211.22242057],
        [223.71389813],
        [282.01464469],
        [265.24692982],
        [277.3220949],
        [228.71389813],
        [211.42795753],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [268.04474006],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [271.64396182],
        [277.01464469],
        [335.31539125],
        [317.08995951],
        [330.31539125],
        [284.19254588],
        [267.01464469],
        [277.01464469],
        [200.91707287],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.73957054],
        [249.34522616],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [256.02133549],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.71970054],
        [303.94917342],
        [334.74708036],
        [319.74708036],
        [329.74708036],
        [255.08011596],
        [240.08011596],
        [253.61102444],
        [308.38086253],
        [293.38086253],
        [305.21658642],
        [255.08011596],
        [240.08011596],
        [247.04137603],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [229.60153698],
        [213.71389813],
        [223.71389813],
        [308.38086253],
        [293.38086253],
        [301.33208724],
        [228.71389813],
        [211.21833176],
        [226.97872074],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [255.08011596],
        [240.08011596],
        [252.40644347],
        [175.41315157],
        [160.41315157],
        [170.41315157],
        [229.11201752],
        [213.71389813],
        [223.71389813],
        [174.64252437],
        [160.64018626],
        [170.41315157],
        [95.74618717],
        [78.27055617],
        [90.74618717],
        [145.14275813],
        [134.04693373],
        [144.04693373],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [148.06093186],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [185.9618611],
        [199.14688004],
        [308.99546157],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [283.23538522],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [133.61157132],
        [146.24448743],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [282.01464469],
        [268.37855063],
        [276.39411118],
        [202.34768029],
        [187.34768029],
        [197.54167222],
        [255.64842686],
        [239.01198549],
        [250.64842686],
        [253.0680812],
        [240.08011596],
        [250.08011596],
        [175.41315157],
        [161.6613912],
        [171.66984258],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [174.05882814],
        [160.41315157],
        [170.41315157],
        [95.74618717],
        [80.10341549],
        [90.74618717],
        [147.91948463],
        [132.40249294],
        [144.04693373],
        [229.20383127],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [141.23200618],
        [202.34768029],
        [187.34768029],
        [197.96949542],
        [175.41315157],
        [162.12847081],
        [170.09327451],
        [95.74618717],
        [78.74112844],
        [90.74618717],
        [149.04693373],
        [134.04693373],
        [142.39247184],
        [96.7848802],
        [83.81166499],
        [90.74618717],
        [16.07922277],
        [2.45951075],
        [11.07922277],
        [69.8281543],
        [54.37996933],
        [64.37996933],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [69.37996933],
        [54.37996933],
        [68.68633425],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [129.79914228],
        [142.99542369],
        [200.82941497],
        [187.64846787],
        [197.34768029],
        [152.79927541],
        [134.04693373],
        [144.04693373],
        [67.58313999],
        [54.37996933],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [198.92141123],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [104.49186058],
        [117.6807159],
        [175.99194986],
        [161.07542365],
        [170.08133151],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [279.56999833],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [202.34768029],
        [187.34768029],
        [196.849752],
        [282.01464469],
        [267.01464469],
        [279.75190781],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [252.13094788],
        [240.64842686],
        [250.64842686],
        [228.17508446],
        [215.14898264],
        [223.71389813],
        [149.19512329],
        [134.04693373],
        [144.04693373],
        [198.94091541],
        [187.34768029],
        [197.34768029],
        [149.04693373],
        [134.04693373],
        [144.04693373],
        [66.77103033],
        [54.37996933],
        [64.37996933],
        [120.80095632],
        [107.6807159],
        [117.6807159],
        [202.34768029],
        [189.25796493],
        [197.34768029],
        [122.6807159],
        [106.62020066],
        [116.09497023],
        [175.76740174],
        [160.98146246],
        [170.98146246],
        [282.01464469],
        [267.01464469],
        [277.08517179],
        [202.34768029],
        [187.34768029],
        [197.12302419],
        [255.20648766],
        [241.87676026],
        [250.64842686],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [179.27139788],
        [160.48339038],
        [172.13457638],
        [256.27092716],
        [240.64842686],
        [250.64842686],
        [175.72562727],
        [159.07038158],
        [170.98146246],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [386.75468116],
        [370.88473092],
        [383.04782692],
        [308.38086253],
        [293.36491724],
        [303.38086253],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [226.96266162],
        [210.94829867],
        [223.71389813],
        [282.01464469],
        [264.21750954],
        [277.01464469],
        [361.68160909],
        [345.70735832],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [275.35274446],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.91256274],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [227.38865061],
        [213.71389813],
        [223.71389813],
        [149.04693373],
        [130.79184885],
        [144.04693373],
        [202.34768029],
        [185.53904704],
        [197.34768029],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [361.68160909],
        [346.68160909],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [275.42085418],
        [335.31539125],
        [319.90930048],
        [330.31539125],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [198.02288562],
        [255.64842686],
        [239.67321441],
        [249.78331048],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [308.94917342],
        [293.94917342],
        [299.87292435],
        [308.38086253],
        [293.38086253],
        [303.38086253],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [228.71389813],
        [215.25562852],
        [220.75672564],
        [151.33444182],
        [134.04693373],
        [144.04693373],
        [203.61324403],
        [187.34768029],
        [197.7114128],
        [282.01464469],
        [267.01464469],
        [275.31495595],
        [202.34768029],
        [185.63551264],
        [197.49081277],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [228.71389813],
        [213.71389813],
        [223.71389813],
        [147.0894063],
        [134.04693373],
        [144.80153472],
        [203.86165753],
        [187.34768029],
        [199.08689213],
        [149.04693373],
        [134.04693373],
        [147.80052536],
        [69.37996933],
        [51.89065993],
        [64.37996933],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [202.90761755],
        [187.34768029],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [117.6807159],
        [176.94348092],
        [161.42923051],
        [170.98146246],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [186.32524894],
        [197.34768029],
        [255.39685302],
        [240.64842686],
        [250.64842686],
        [202.34768029],
        [190.40678093],
        [197.34768029],
        [122.6807159],
        [107.6807159],
        [114.37100255],
        [175.98146246],
        [160.98146246],
        [168.40154066],
        [253.05826931],
        [239.97685746],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.48997633],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [361.68160909],
        [348.07402182],
        [356.68160909],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [335.31539125],
        [320.31539125],
        [330.34324984],
        [281.96639452],
        [267.01464469],
        [277.01464469],
        [201.20035628],
        [186.25396241],
        [197.28217375],
        [255.64842686],
        [239.22273529],
        [250.64842686],
        [334.80543682],
        [320.31539125],
        [325.01345164],
        [255.64842686],
        [243.14059724],
        [250.64842686],
        [308.26379823],
        [293.94917342],
        [303.94917342],
        [282.01464469],
        [267.01464469],
        [277.01464469],
        [202.34768029],
        [187.34768029],
        [197.34768029],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [202.34768029],
        [188.77367715],
        [197.34768029],
        [122.6807159],
        [109.10263583],
        [117.6807159],
        [175.25953013],
        [160.98146246],
        [168.8193358],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.98146246],
        [160.98146246],
        [170.98146246],
        [228.91240475],
        [214.28220902],
        [226.38022747],
        [335.31539125],
        [320.31539125],
        [330.31539125],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [304.7853146],
        [293.94917342],
        [304.37120835],
        [255.64842686],
        [240.64842686],
        [250.64842686],
        [175.90619305],
        [160.98146246],
        [171.20991776],
        [229.28220902],
        [213.5549846],
        [224.28220902],
        [308.94917342],
        [293.94917342],
        [303.94917342],
        [229.28220902],
        [214.28220902],
        [224.28220902],
        [282.58295558],
        [267.58295558],
        [277.58295558],
    ])
    outputs = obj_fun.output_sparse_gaussian_noise(grids, scale_noise=SCALE_NOISE, sparsity=0.3)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_student_t_noise():
    obj_fun = class_fun(1, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [16.7742346],
        [-1.53838047],
        [13.26311703],
    ])
    outputs = obj_fun.output_student_t_noise(grids, scale_noise=SCALE_NOISE, dof=4.0)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_output_sparse_student_t_noise():
    obj_fun = class_fun(2, seed=SEED)
    bounds = obj_fun.get_bounds()

    grids = obj_fun.sample_grids(3)
    truths_grids = np.array([
        [96.53204355],
        [13.55246408],
        [69.01659112],
        [80.38280895],
        [0.71584455],
        [54.01659112],
        [86.45451651],
        [10.71584455],
        [64.01659112],
    ])
    outputs = obj_fun.output_sparse_student_t_noise(grids, scale_noise=SCALE_NOISE, dof=4.0, sparsity=0.3)

    print(grids)
    print(outputs)
    print(np.abs(outputs - truths_grids) < TEST_EPSILON)
    assert np.all(np.abs(outputs - truths_grids) < TEST_EPSILON)

def test_name():
    obj_fun = class_fun(2)
    assert obj_fun.name == str_name + '_2'

    obj_fun = class_fun(4)
    assert obj_fun.name == str_name + '_4'

    obj_fun = class_fun(16)
    assert obj_fun.name == str_name + '_16'

    assert obj_fun.__class__.__name__.lower() == str_name
    assert obj_fun.__class__.__qualname__.lower() == str_name
