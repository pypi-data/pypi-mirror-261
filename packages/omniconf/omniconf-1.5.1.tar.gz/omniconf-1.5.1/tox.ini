[tox]
envlist = py,coverage

[testenv]
deps =
    -r dev-requirements.txt
commands =
    pytest {posargs}
allowlist_externals =
    pytest

[testenv:coverage]
deps =
    coverage
skip_install = true
commands =
    coverage xml
    coverage html
allowlist_externals =
    coverage

[testenv:sphinx]
deps =
    -r docs-requirements.txt
    -e .[configobj,toml,yaml]
changedir = docs
commands = python -m sphinx -E -T -W --keep-going -b html -d _build/doctrees . _build/html
allowlist_externals =
    python

[pytest]
minversion = 7.0
testpaths =
    omniconf
addopts =
    -vv
    --ruff
    --ruff-format
    --mypy
    --junitxml=cover/junit.xml
    --cov-report term-missing
    --cov-config tox.ini
    --cov omniconf
filterwarnings =
    ignore:::_pytest.nodes

[coverage:run]
data_file = cover/datafile
branch = True

[coverage:xml]
output = cover/cobertura.xml

[coverage:html]
directory = cover/html
