(()=>{"use strict";var e,t,s,r,o={213:(e,t,s)=>{s.a(e,(async(e,t)=>{try{const e=await import("https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.2");class s{constructor(){this._sharedArray=null,this._completionModels=new Map}async handleMessage(e){const t=e.data;switch(t.action){case"generate":return this._generate(t);case"configure":return this._configure(t);case"initializeBuffer":return this._initializeBuffer(t);case"initializeModel":return this._initializeModel(t);case"disposeModel":return this._disposeModel(t);default:console.error("Unhandled message",e)}}async _generate(e){const{model:t,text:s,idTokens:r,counter:o}=e,n=this._sharedArray;if(null===n)throw Error("Cannot generate before `initializeBuffer` message got processed");const a=this._initializeModel({model:t}),i=await a.instance;if(n[0]!==o)return void console.log("Skipping generation because new request was sent since");let l=[];try{l=await i(s,{max_new_tokens:e.maxNewTokens,temperature:e.temperature,top_k:e.topK,do_sample:e.doSample,num_beams:e.generateN,num_return_sequences:e.generateN,repetition_penalty:e.repetitionPenalty,diversity_penalty:e.diversityPenalty,num_beam_groups:e.generateN,callback_function:e=>{if(n[0]!==o)throw Error("Execution interrupted");for(let t=0;t<e.length;t++){const o=i.tokenizer.decode(e[t].output_token_ids,{skip_special_tokens:!0});self.postMessage({status:"update",output:o.substring(s.length),idToken:r[t]})}}})}catch(e){const t={error:{message:e.message},idTokens:r};"Execution interrupted"===e.message?self.postMessage({status:"interrupted",...t}):self.postMessage({status:"exception",...t})}for(let e=0;e<l.length;e++)self.postMessage({status:"complete",output:l[e].generated_text.substring(s.length),idToken:r[e]})}_initializeModel(e){let t=this._completionModels.get(e.model);return t||(t=new r({model:e.model,onLoadingProgress:t=>{self.postMessage({...t,model:e.model})}}),this._completionModels.set(e.model,t),t)}_configure(t){e.env.allowLocalModels=t.allowLocalModels}_initializeBuffer(e){this._sharedArray=new Int32Array(e.buffer)}_disposeModel(e){const t=this._completionModels.get(e.model);if(t)return this._completionModels.delete(e.model),t.dispose()}}class r{constructor(t){this._task="text-generation",this._model=t.model,this._instance=e.pipeline(this._task,this._model,{progress_callback:e=>{t.onLoadingProgress(e)}})}get instance(){return this._instance}async dispose(){(await this._instance).dispose()}}const o=new s;self.addEventListener("message",o.handleMessage.bind(o)),self.postMessage({status:"worker-started"}),t()}catch(e){t(e)}}),1)}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return o[e](s,s.exports,a),s.exports}a.m=o,a.c=n,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(o,n,a)=>{var i;a&&((i=[]).d=-1);var l,c,d,p=new Set,u=o.exports,_=new Promise(((e,t)=>{d=t,c=e}));_[t]=u,_[e]=e=>(i&&e(i),p.forEach(e),_.catch((e=>{}))),o.exports=_,n((o=>{var n;l=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var n=[];n.d=0,o.then((e=>{a[t]=e,r(n)}),(e=>{a[s]=e,r(n)}));var a={};return a[e]=e=>e(n),a}}var i={};return i[e]=e=>{},i[t]=o,i})))(o);var a=()=>l.map((e=>{if(e[s])throw e[s];return e[t]})),c=new Promise((t=>{(n=()=>t(a)).r=0;var s=e=>e!==i&&!p.has(e)&&(p.add(e),e&&!e.d&&(n.r++,e.push(n)));l.map((t=>t[e](s)))}));return n.r?c:a()}),(e=>(e?d(_[s]=e):c(u),r(i)))),i&&i.d<0&&(i.d=0)},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{a.S={};var e={},t={};a.I=(s,r)=>{r||(r=[]);var o=t[s];if(o||(o=t[s]={}),!(r.indexOf(o)>=0)){if(r.push(o),e[s])return e[s];a.o(a.S,s)||(a.S[s]={}),a.S[s];var n=[];return e[s]=n.length?Promise.all(n).then((()=>e[s]=1)):1}}})(),a(213)})();